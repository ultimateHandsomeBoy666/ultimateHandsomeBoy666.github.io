<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ultimateHandsomeBoy666.github.io/</id>
    <title>ç‰›è›™çš„åšå®¢</title>
    <updated>2021-07-26T16:09:04.633Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ultimateHandsomeBoy666.github.io/"/>
    <link rel="self" href="https://ultimateHandsomeBoy666.github.io/atom.xml"/>
    <subtitle>Hello!</subtitle>
    <logo>https://ultimateHandsomeBoy666.github.io/images/avatar.png</logo>
    <icon>https://ultimateHandsomeBoy666.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, ç‰›è›™çš„åšå®¢</rights>
    <entry>
        <title type="html"><![CDATA[ä¸€ä¸ªé…·ç‚«çš„ android ç²’å­åŠ¨ç”»åº“]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/yi-ge-ku-xuan-de-android-li-zi-dong-hua-ku/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/yi-ge-ku-xuan-de-android-li-zi-dong-hua-ku/">
        </link>
        <updated>2021-07-26T16:06:26.000Z</updated>
        <content type="html"><![CDATA[<h3 id="ä¸€-çµæ„Ÿ">ä¸€ã€çµæ„Ÿ</h3>
<p>åšè¿™ä¸ªç²’å­åŠ¨ç”»åº“çš„çµæ„Ÿæ¥è‡ªäº MIUI å¸è½½åº”ç”¨æ—¶çš„åŠ¨ç”»ï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a5d408b323a4b1c97c57d1cb180f659~tplv-k3u1fbpfcp-watermark.image" 
width = "180" height = "400"/></p>
<p>è¿™ä¸ªçˆ†ç‚¸çš„ç²’å­æ•ˆæœçœ‹èµ·æ¥å¾ˆé…·ç‚«ï¼Œè€Œä¸”ç²’å­é¢œè‰²æ˜¯ä» icon ä¸­æ‹¿åˆ°çš„ã€‚</p>
<p>æœ€å¼€å§‹æˆ‘ç®€å•å®ç°äº†ç±»ä¼¼çˆ†ç‚¸çš„æ•ˆæœï¼Œåæ¥æƒ³åˆ°å¯ä»¥ç›´æ¥æ‰©å±•ä¸€ä¸‹ï¼Œå†™ä¸€ä¸ªé€šç”¨çš„ç²’å­åŠ¨ç”»åº“ã€‚</p>
<h3 id="äºŒ-ä½¿ç”¨">äºŒã€ä½¿ç”¨</h3>
<p>é¡¹ç›®åœ°å€ï¼šhttps://github.com/ultimateHandsomeBoy666/Particle</p>
<p>Particle æ˜¯ä¸€ä¸ªä½¿ç”¨ kotlin ç¼–å†™çš„ç²’å­åŠ¨ç”»åº“ï¼Œå¯ä»¥ç”¨å‡ è¡Œä»£ç è½»æ¾æå®šä¸€ä¸ªç²’å­åŠ¨ç”»ã€‚åŒæ—¶ä¹Ÿæ”¯æŒé«˜åº¦è‡ªå®šä¹‰çš„ç²’å­åŠ¨ç”»è½¨è¿¹ï¼Œå¯ä»¥æ‰“é€ å‡ºéå¸¸ç‚«é…·çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚è¿™ä¸ªé¡¹ç›®å‘å¸ƒäº† 0.1 ç‰ˆæœ¬åœ¨ JitPack ä¸Šï¼ŒæŒ‰å¦‚ä¸‹æ“ä½œå¼•å…¥ï¼š</p>
<p>åœ¨æ ¹ç›®å½•çš„ <code>build.gradle</code> ä¸­çš„ <code>allprojects</code> ä¸­æ·»åŠ (æ³¨æ„ä¸æ˜¯ <code>buildScript</code>)ï¼š</p>
<pre><code class="language-groovy">allprojects {
	repositories {
		...
		maven { url 'https://jitpack.io' }
	}
}
</code></pre>
<p>ç„¶ååœ¨ä½ çš„é¡¹ç›®ä¸­å¼•å…¥ä¾èµ–å³å¯ã€‚</p>
<pre><code class="language-gr">implementation 'com.github.ultimateHandsomeBoy666:Particle:0.1'
</code></pre>
<p>åœ¨å¼•å…¥äº† Particle ä¹‹åï¼Œåªéœ€è¦ä¸‹é¢å‡ è¡Œç®€å•çš„ä»£ç ï¼Œå°±å¯ä»¥å®ç°ä¸Šé¢çš„ç²’å­çˆ†ç‚¸æ•ˆæœï¼š</p>
<pre><code class="language-kotlin">Particles.with(context, container) // container æ˜¯ç²’å­åŠ¨ç”»çš„å®¿ä¸»çˆ¶ ViewGroup
		.colorFromView(button)// ä» button ä¸­é‡‡æ ·é¢œè‰²
		.particleNum(200)// ä¸€å…± 200 ä¸ªç²’å­
		.anchor(button)// æŠŠ button ä½œä¸ºåŠ¨ç”»çš„é”šç‚¹
		.shape(Shape.CIRCLE)// ç²’å­å½¢çŠ¶æ˜¯åœ†å½¢
		.radius(2, 6)// ç²’å­éšæœºåŠå¾„ 2~6
		.anim(ParticleAnimation.EXPLOSION)// ä½¿ç”¨çˆ†ç‚¸åŠ¨ç”»
		.start()
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da7082f52a674bafb5eeb86eb25de7c4~tplv-k3u1fbpfcp-watermark.image" 
width = "180" height = "400"/></p>
<h3 id="ä¸‰-ç²’å­å½¢çŠ¶">ä¸‰ã€ç²’å­å½¢çŠ¶</h3>
<p>ç²’å­çš„å½¢çŠ¶æ”¯æŒ<strong>åœ†å½¢ã€ä¸‰è§’å½¢ã€çŸ©å½¢ã€äº”è§’æ˜Ÿä»¥åŠçŸ¢é‡å›¾å½¢åŠä½å›¾ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§å›¾å½¢ç²’å­æ··åˆ</strong>ã€‚</p>
<p>ä¸‹é¢è¯¦ç»†è¯´æ˜ã€‚</p>
<h4 id="shapecircle-å’Œ-shapehollowcircle"><code>Shape.CIRCLE</code> å’Œ <code>Shape.HOLLOWCIRCLE</code></h4>
<ul>
<li>
<p>åœ†å½¢å’Œç©ºå¿ƒåœ†</p>
</li>
<li>
<p>ä½¿ç”¨ <code>radius</code>  å®šä¹‰åœ†çš„å¤§å°ã€‚ç©ºå¿ƒåœ†ä½¿ç”¨ <code>strokeWidth</code> å®šä¹‰ç²—ç»†ã€‚</p>
</li>
</ul>
<h4 id="shapetriangle-å’Œ-shapehollowtriangle"><code>Shape.TRIANGLE</code> å’Œ <code>Shape.HOLLOWTRIANGLE</code></h4>
<ul>
<li>
<p>å®å¿ƒä¸‰è§’å½¢å’Œç©ºå¿ƒä¸‰è§’å½¢</p>
</li>
<li>
<p>ä½¿ç”¨ <code>width</code> å’Œ <code>height</code>  å®šä¹‰ä¸‰è§’å½¢çš„å¤§å°ã€‚ç©ºå¿ƒä¸‰è§’å½¢ä½¿ç”¨ <code>strokeWidth</code> å®šä¹‰ç²—ç»†ã€‚</p>
</li>
</ul>
<h4 id="shaperectangle-å’Œ-shapehollowrectangle"><code>Shape.RECTANGLE</code> å’Œ <code>Shape.HOLLOWRECTANGLE</code></h4>
<ul>
<li>
<p>å®å¿ƒçŸ©å½¢å’Œç©ºå¿ƒçŸ©å½¢ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>width</code> å’Œ <code>height</code>  å®šä¹‰çŸ©å½¢çš„å¤§å°ã€‚ç©ºå¿ƒçŸ©å½¢ä½¿ç”¨ <code>strokeWidth</code> å®šä¹‰ç²—ç»†ã€‚</p>
</li>
</ul>
<h4 id="shapepentacle-å’Œ-shapehollowpentacle"><code>Shape.PENTACLE</code> å’Œ <code>Shape.HOLLOWPENTACLE</code></h4>
<ul>
<li>
<p>å®å¿ƒäº”è§’æ˜Ÿå’Œç©ºå¿ƒäº”è§’æ˜Ÿ</p>
</li>
<li>
<p>ä½¿ç”¨ <code>radius</code>  å®šä¹‰äº”è§’æ˜Ÿå¤–æ¥åœ†çš„å¤§å°ã€‚ç©ºå¿ƒäº”è§’æ˜Ÿä½¿ç”¨ <code>strokeWidth</code> å®šä¹‰ç²—ç»†ã€‚</p>
</li>
</ul>
<h4 id="shapebitmap"><code>Shape.BITMAP</code></h4>
<ul>
<li>
<p>æ”¯æŒä½å›¾ã€‚</p>
</li>
<li>
<p>æ”¯æŒçŸ¢é‡å›¾ï¼Œåªéœ€è¦æŠŠçŸ¢é‡å›¾ xml çš„èµ„æº id ä¼ å…¥å³å¯ã€‚</p>
</li>
<li>
<p>å›¾ç‰‡ç²’å­ä¸å— color è®¾ç½®çš„å½±å“ã€‚</p>
</li>
</ul>
<p>é™¤äº†ä¸Šè¿°å•ç§å›¾å½¢ä»¥å¤–ï¼Œè¿˜æ”¯æŒå¤šç§å›¾å½¢çš„æ··åˆç²’å­ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85bcaf99629243aaa897d3069b698e25~tplv-k3u1fbpfcp-watermark.image" 
width = "180" height = "400"/></p>
<h3 id="å››-ç²’å­åŠ¨ç”»">å››ã€ç²’å­åŠ¨ç”»</h3>
<h4 id="åŠ¨ç”»æ§åˆ¶">åŠ¨ç”»æ§åˆ¶</h4>
<p>ç²’å­çš„åŠ¨ç”»ä½¿ç”¨ <code>ValueAnimator</code> æ¥æ§åˆ¶ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰ animator æ¥æ§åˆ¶åŠ¨ç”»çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬åŠ¨ç”»æ—¶é•¿ã€Interpolaterã€é‡å¤ã€å¼€å§‹ç»“æŸçš„ç›‘å¬ç­‰ç­‰ã€‚</p>
<h4 id="ç²’å­ç‰¹æ•ˆ">ç²’å­ç‰¹æ•ˆ</h4>
<p>ç›®å‰ä»…æ”¯æŒç²’å­åœ¨è¿åŠ¨è¿‡ç¨‹ä¸­çš„æ—‹è½¬ï¼Œå¦‚ä¸‹ã€‚åç»­ä¼šå¢åŠ æ›´å¤šæ•ˆæœ</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e965bcfd21a42a7ab9fc23dedae21ef~tplv-k3u1fbpfcp-watermark.image" 
width = "180" height = "400"/></p>
<h4 id="ç²’å­è½¨è¿¹">ç²’å­è½¨è¿¹</h4>
<p>ç²’å­è½¨è¿¹çš„æ§åˆ¶ä½¿ç”¨ <code>IPathGenerator</code> æ¥å£çš„æ´¾ç”Ÿç±»æ¥å®Œæˆã€‚åº“ä¸­è‡ªå¸¦å››ç§è½¨è¿¹åŠ¨ç”»ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>ParticleAnimation.EXPLOSION</code>  çˆ†ç‚¸ğŸ’¥æ•ˆæœ</li>
<li><code>ParticleAnimation.RISE</code> ç²’å­ä¸Šå‡</li>
<li><code>ParticleAnimation.FALL</code> ç²’å­ä¸‹é™</li>
<li><code>ParticleAnimation.FIREWORK</code> çƒŸèŠ±ğŸ‡æ•ˆæœ</li>
</ul>
<p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰ç²’å­è¿åŠ¨è½¨è¿¹çš„è¯ï¼Œå¯ä»¥ç»§æ‰¿  <code>IPathGenerator</code>  æ¥å£ï¼Œå¤å†™ç”Ÿæˆç²’å­åæ ‡çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-kotlin">private fun createPathGenerator(): IPathGenerator {
  // LinearPathGenerator åº“ä¸­è‡ªå¸¦
        return object : LinearPathGenerator() {
            val cos = Random.nextDouble(-1.0, 1.0)
            val sin = Random.nextDouble(-1.0, 1.0)

            override fun getCurrentCoord(progress: Float, duration: Long): Pair&lt;Int, Int&gt; {
              // åœ¨è¿™é‡Œå†™ä½ æƒ³è¦çš„ç²’å­è½¨è¿¹
                val originalX = distance * progress
                val originalY = 100 * sin(originalX / 50)
                val x = originalX * cos - originalY * sin
                val y = originalX * sin + originalY * cos
                return Pair((0.01 * x * originalY).toInt(), (0.008 * y * originalX).toInt())
            }
        }
    }
</code></pre>
<p>ç„¶åæŠŠè¿™ä¸ªè¿”å› <code>IPathGenerator</code> çš„æ–¹æ³•é€šè¿‡é«˜é˜¶å‡½æ•°çš„å½¢å¼ä¼ å…¥å³å¯ï¼š</p>
<pre><code class="language-kotlin">particleManager!!.colorFromView(button)
                .particleNum(300)
                .anchor(it)
                .shape(Shape.CIRCLE, Shape.BITMAP)
                .radius(8, 12)
                .strokeWidth(10f)
                .size(20, 20)
                .rotation(Rotation(600))
                .bitmap(R.drawable.ic_thumbs_up)
                .anim(ParticleAnimation.with({
                  // æ§åˆ¶åŠ¨ç”»çš„animator
                    createAnimator()
                }, {
                  // ç²’å­è¿åŠ¨çš„è½¨è¿¹
                    createPathGenerator()
                })).start()
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­çš„ <code>ParticleAnimation.with</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªé«˜é˜¶å‡½æ•°åˆ†åˆ«ç”ŸæˆåŠ¨ç”»æ§åˆ¶å’Œç²’å­è½¨è¿¹ã€‚</p>
<pre><code class="language-kotlin">fun with(animator: () -&gt; ValueAnimator = DEFAULT_ANIMATOR_LAMBDA,
        generator: () -&gt; IPathGenerator): ParticleAnimation {
    return ParticleAnimation(generator, animator)
}
</code></pre>
<p>ç»ˆäºï¼Œç»è¿‡ä¸Šé¢çš„æŠ˜è…¾ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„é…·ç‚«åŠ¨ç”»ï¼š</p>
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db9e8ec14de64b2796154a634936ce06~tplv-k3u1fbpfcp-watermark.image" width="360" height="800"/>
<p>å½“ç„¶ï¼Œåªè¦ä½ æƒ³è¦ï¼Œå¯ä»¥æ„é€ å‡ºæ— é™å¤šçš„ç²’å­åŠ¨ç”»è½¨è¿¹ï¼Œä¸è¿‡è¿™å¯èƒ½è¦æ±‚ä¸€ç‚¹æ•°å­¦åŠŸåº•ğŸ¶ã€‚</p>
<p>åœ¨ https://github.com/ultimateHandsomeBoy666/Particle ç›®å½•ä¸‹æœ‰ä¸€ä»½æˆ‘ä¹‹å‰è¯•éªŒçš„æ¯”è¾ƒé…·ç‚«çš„è½¨è¿¹å…¬å¼åˆé›†ï¼Œå¯ä»¥å‚è€ƒã€‚</p>
<h3 id="äº”-æ³¨æ„äº‹é¡¹">äº”ã€æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>ç²’å­åŠ¨ç”»æ¯”è¾ƒæ¶ˆè€—å†…å­˜å’Œ CPUï¼Œæ‰€ä»¥ç²’å­æ•°ç›®å¤ªå¤šï¼Œæ¯”å¦‚è¶…è¿‡ 1000 çš„è¯ï¼Œå¯èƒ½ä¼šæœ‰å¡é¡¿ã€‚</li>
<li>é»˜è®¤åœ¨åŠ¨ç”»ç»“æŸçš„æ—¶å€™ï¼Œç²’å­æ˜¯ä¸ä¼šæ¶ˆå¤±çš„ã€‚å¦‚æœè¦è®©ç²’å­åœ¨åŠ¨ç”»ç»“æŸæ—¶æ¶ˆå¤±ï¼Œå¯ä»¥è‡ªå®šä¹‰ <code>ValueAnimator</code> ç›‘å¬åŠ¨ç”»ç»“æŸï¼Œåœ¨ç»“æŸæ—¶è°ƒç”¨ <code>ParticleManager.hide()</code> æ–¹æ³•æ¥éšè—ç²’å­ã€‚</li>
<li>å¦‚æœéœ€è¦åå¤è§¦å‘ç²’å­åŠ¨ç”»ï¼Œæ¯”å¦‚æŒ‰ä¸€æ¬¡æŒ‰é’®è§¦å‘ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ <code>particleManager</code> å˜é‡æ¥å¯åŠ¨å’Œå–æ¶ˆç²’å­åŠ¨ç”»ï¼Œå¯ä»¥é¿å…å†…å­˜æ¶ˆè€—å’Œå†…å­˜æŠ–åŠ¨ã€‚æ¯”å¦‚ï¼š</li>
</ul>
<pre><code class="language-kotlin">particleManager = Particles.with(this, container)
button.setOnClickListener {
        
    particleManager!!.colorFromView(button)
                      .particleNum(300)
                      .anchor(it)
                      .shape(Shape.CIRCLE, Shape.BITMAP)
                      .radius(8, 12)
                      .rotation(Rotation(600))
                      .anim(ParticleAnimation.EXPLOSION)

    particleManager!!.start()
}
</code></pre>
<h3 id="å…­-æœ€å">å…­ã€æœ€å</h3>
<p>è¿™ä¸ªé¡¹ç›®æš‚æ—¶é™¤äº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªå·±ç¬¬ä¸€ä¸ªå¼€æºå‘å¸ƒçš„é¡¹ç›®ï¼Œä¼šèŠ±ä¸€äº›æ—¶é—´ç²¾åŠ›å»ç»´æŠ¤ã€‚</p>
<ul>
<li>åç»­ä¼šå¢åŠ æ›´å¤šç²’å­ç‰¹æ•ˆï¼Œæ¯”å¦‚ç²’å­è¿åŠ¨è¿‡ç¨‹ä¸­çš„å°ºå¯¸ã€é€æ˜åº¦ã€é¢œè‰²ç­‰æ”¹å˜</li>
<li>å†åç»­å¯èƒ½ä¼šå‡ºä¸€ä»½ compose ç‰ˆæœ¬ğŸ¶</li>
</ul>
<p>æœ€åï¼Œhttps://github.com/ultimateHandsomeBoy666/Particle é¡¹ç›®åœ°å€åœ¨è¿™é‡Œï¼Œæ¬¢è¿ forkã€prã€issuesã€starï¼Œæ±‚æ±‚å¤§å®¶ç‚¹ä¸ªå°æ˜Ÿæ˜Ÿå§âœ¨â¤ï¸ï¼Œæ„Ÿè°¢ï¼</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€æ–‡ç†è§£ onMeasure]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/yi-wen-li-jie-onmeasure/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/yi-wen-li-jie-onmeasure/">
        </link>
        <updated>2021-05-15T09:11:25.000Z</updated>
        <content type="html"><![CDATA[<p>è®°å¾—æˆ‘åˆšæ¥è§¦è‡ªå®šä¹‰ View çš„æ—¶å€™ï¼Œå…³äº View çš„æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ä¸‰å¤§æµç¨‹ï¼Œæœ€éš¾æ‡‚çš„å°±æ˜¯ <code>onMeasure</code> è¿‡ç¨‹ã€‚ç›¸æ¯”äº <code>onLayout</code> å’Œ <code>onDraw</code> åªå…³æ³¨å½“å‰ View çš„é€»è¾‘ï¼Œ<code>onMeasure</code> å¾€å¾€è¦å¤„ç†çˆ¶ View å’Œå­ View ä¹‹é—´å…³ç³»ï¼Œè¿™è®© <code>onMeasure</code> ç†è§£å’Œå®è·µèµ·æ¥éƒ½å˜å¾—æ›´éš¾äº†ä¸€äº›ã€‚å½“æ—¶å¹¶æ²¡æœ‰ç†è§£çš„å¾ˆé€å½»ï¼Œä¸è¿‡è¿˜æ˜¯èƒ½åšçš„ã€‚åæ¥éšç€ç»éªŒæé«˜ï¼Œæ…¢æ…¢ææ¸…æ¥šäº† <code>onMeasure</code> è¿‡ç¨‹ï¼Œå¹¶ä¸”å‘ç°ç½‘ä¸Šå¾ˆå¤šå…³äº <code>onMeasure</code> çš„ä¸€äº›è¯´æ³•éƒ½æ˜¯é”™çš„ï¼Œæˆ–è€…è¯´ä¸å‡†ç¡®çš„ã€‚</p>
<h3 id="ä¸€-measurespec-æ¥è‡ªå“ªé‡Œ">ä¸€ã€MeasureSpec æ¥è‡ªå“ªé‡Œ</h3>
<p>æˆ‘ä»¬çœ‹çœ‹ View çš„ <code>onMeasure</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-java">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),
                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));
    }
</code></pre>
<p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨è‡ªå®šä¹‰ View çš„æ—¶å€™è¦é‡å†™ <code>onMeasure</code> æ–¹æ³•ï¼Œè¦å¯¹æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•° <code>widthMeasureSpec</code> å’Œ <code>heightMeasureSpec</code> è¿›è¡Œå¤„ç†ã€‚ç½‘ä¸Šå¾ˆå¤šæ–‡ç« åœ¨æåˆ° <code>measureSpec</code> çš„æ—¶å€™ä¼šè¯¦ç»†çš„è¯´å®ƒçš„æ¦‚å¿µï¼Œæ¯”å¦‚ 32 ä½æ•´æ•°ï¼Œå¤´ä¸¤ä½æ˜¯ modeï¼Œåé¢ 30 ä½æ˜¯ sizeã€‚ä½†æ˜¯å¾€å¾€éƒ½æ˜¯ç½—åˆ—ä¸€å¤§ä¸²çŸ¥è¯†ç‚¹ï¼Œå¹¶æ²¡æœ‰ç†æ¸…å…¶ä¸­çš„å…³ç³»å’Œé€»è¾‘ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘æƒ³æ¢ä¸€ç§æ€è·¯æ¥è®² <code>onMeasure</code> ï¼Œå°½é‡é¿å…ç½—åˆ—çŸ¥è¯†ç‚¹ï¼Œè€Œæ˜¯ä»æˆ‘è‡ªå·±çš„ç†è§£å‡ºå‘ï¼Œå†™æ¸…æ¥š <code>onMeasure</code> çš„é€»è¾‘ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¿™æ ·åšã€‚</p>
<p>é¦–å…ˆï¼Œ<code>widthMeasure</code> å’Œ <code>heightMeasure</code> æ¥è‡ªå“ªé‡Œï¼Ÿæ˜¯è°æŠŠè¿™ä¸¤ä¸ªå‚æ•°ä¼ å…¥åˆ°è‡ªå®šä¹‰ View çš„ <code>onMeasure</code> æ–¹æ³•é‡Œçš„ï¼Ÿ</p>
<p>è¦å¼„æ¸…è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦çŸ¥é“æ˜¯è°è°ƒç”¨äº† View çš„ <code>onMeasure</code> æ–¹æ³•ã€‚è¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½å¾ˆæ¸…æ¥šäº†ï¼Œåœ¨ View çš„ <code>measure</code> æ–¹æ³•ä¸­ä¼šè°ƒç”¨ <code>onMeasure</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public final void measure(int widthMeasureSpec, int heightMeasureSpec) {
  	...
    onMeasure(widthMeasureSpec, heightMeasureSpec);
    ...
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>onMeasure</code> æ–¹æ³•ä¸­çš„ <code>measureSpec</code> æ¥è‡ªäº <code>measure</code> æ–¹æ³•ä¸­çš„ <code>measureSpec</code>ï¼Œé‚£ä¹ˆæ˜¯è°è°ƒç”¨äº† View çš„ <code>measure</code> æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å®ƒçš„çˆ¶ Viewã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ <code>measure</code> æ–¹æ³•çš„æ˜¯ ViewGroup ç±»å‹ã€‚å…¶å®ï¼Œåœ¨ <code>measure</code> æ–¹æ³•çš„æ³¨é‡Šä¸­ï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼š</p>
<blockquote>
<pre><code class="language-java">This is called to find out how big a view should be. The parent
supplies constraint information in the width and height parameters.
@param widthMeasureSpec Horizontal space requirements as imposed by the
    parent
@param heightMeasureSpec Vertical space requirements as imposed by the
    parent
</code></pre>
</blockquote>
<p><code>widthMeasureSpec</code> å’Œ <code>heightMeasureSpec</code> æ˜¯ç”±çˆ¶ View å’Œå­ View çš„å°ºå¯¸å…±åŒä½œç”¨å¾—åˆ°çš„å¯¹å­ View æ–½åŠ çš„çº¦æŸã€‚</p>
<p>ä»¥ LinearLayout ä¸ºä¾‹ï¼Œåœ¨å…¶ <code>onMeasure</code> æ–¹æ³•ä¸­ï¼Œä¼šæœ‰å¦‚ä¸‹è°ƒç”¨é“¾ï¼š</p>
<blockquote>
<p><code>onMeasure</code> -&gt; <code>measureVertical</code> -&gt; <code>measureChildBeforeLayout</code> -&gt; <code>measureChildWithMargins</code></p>
</blockquote>
<p>åœ¨ <code>measureVertical</code> æ–¹æ³•ä¸­ï¼Œä¼šéå†å…¶å­ Viewï¼Œè°ƒç”¨ <code>measureChildBeforeLayout</code> æ–¹æ³•</p>
<pre><code class="language-java">final int count = getVirtualChildCount();
for (int i = 0; i &lt; count; ++i) {
  ...
  measureChildBeforeLayout(child, i, widthMeasureSpec, 0,
                        heightMeasureSpec, usedHeight);
}
</code></pre>
<p>åœ¨ <code>measureChildBeforeLayout</code> ä¸­ä¼šè°ƒç”¨ <code>measureChildWithMargins</code> ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨å°±è°ƒç”¨äº†å­ View çš„ <code>measure</code> æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯ ViewGroup è¿™ä¸ªåŸºç±»ä¸­çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-java">// ViewGroup.java
protected void measureChildWithMargins(View child,
            int parentWidthMeasureSpec, int widthUsed,
            int parentHeightMeasureSpec, int heightUsed) {
        final MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();
				// è®¡ç®—ä¼ é€’ç»™å­ View çš„ measureSpec
        final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,
                mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin
                        + widthUsed, lp.width);
        final int childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,
                mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin
                        + heightUsed, lp.height);
				// è°ƒç”¨å­ View çš„ measure æ–¹æ³•
        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);
    }
</code></pre>
<p>è¯¥æ–¹æ³•çš„æœ€åä¸€å¥å°±æ˜¯è°ƒç”¨ LinearLayout çš„å­ View çš„ <code>measure</code> æ–¹æ³•ï¼Œå¹¶æŠŠè®¡ç®—å¾—åˆ°çš„ <code>measureSpec</code> ä¼ å…¥è¯¥æ–¹æ³•ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å­ View åœ¨ <code>onMeasure</code> è¿‡ç¨‹ä¸­çš„ <code>measureSpec</code> æ˜¯ç”±çˆ¶ View ä¼ è¿›æ¥çš„ï¼Œä½†æ˜¯è¿™ä¸ª <code>measureSpec</code> æœ¬èº«æ˜¯å±äºå­ View çš„ï¼Œå®ƒå†…éƒ¨åŒ…å«çš„ä»…ä»…æ˜¯å­ View çš„å°ºå¯¸ä¿¡æ¯ã€‚åªä¸è¿‡åœ¨å¾—åˆ°è¿™ä¸ªå­ View å°ºå¯¸ä¿¡æ¯çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å€ŸåŠ©çˆ¶ Viewã€‚</p>
<h3 id="äºŒ-measurespec-å¦‚ä½•è®¡ç®—">äºŒã€MeasureSpec å¦‚ä½•è®¡ç®—</h3>
<p>å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œå­ View åœ¨ <code>onMeasure</code> è¿‡ç¨‹ä½¿ç”¨çš„ <code>measureSpec</code> æ˜¯ç”±çˆ¶ View ç»™å®ƒçš„ã€‚é‚£ä¹ˆçˆ¶ View æ˜¯æ€ä¹ˆè®¡ç®—å¾—åˆ°è¿™ä¸ª <code>measureSpec</code> çš„å‘¢ï¼Ÿ</p>
<p>åœ¨ <code>measureChildWithMargins</code> æ–¹æ³•ä¸­ï¼Œæœ‰ï¼š</p>
<pre><code class="language-java">final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,
                mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin
                        + widthUsed, lp.width);
</code></pre>
<p>é¡¾åæ€ä¹‰ï¼Œå­ View çš„ <code>measureSpec</code> æ˜¯ç”± <code>getChildMeasureSpec</code> æ–¹æ³•è®¡ç®—æ¥çš„ã€‚è¯¥æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public static int getChildMeasureSpec(int spec, int padding, int childDimension)
</code></pre>
<ul>
<li><code>spec</code> ï¼Œè¿™ä¸ªå‚æ•°æŒ‡çš„æ˜¯çˆ¶ View çš„ <code>measureSpec</code>ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨å­ View çš„ <code>measure</code> æ–¹æ³•çš„é‚£ä¸ªçˆ¶ Viewã€‚å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œçˆ¶ View çš„ <code>measureSpec</code> æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿç­”æ¡ˆæ˜¯çˆ¶ View çš„ çˆ¶ Viewï¼Œè¿™æ˜¯ä¸€ä¸ªé“¾æ¡ã€‚</li>
<li><code>padding</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯çˆ¶ View çš„ padding å’Œå­ View  çš„ margin ç­‰å€¼çš„å’Œï¼Œåœ¨è¿™é‡Œä¸æ˜¯é‡ç‚¹ã€‚</li>
<li><code>childDimension</code>ï¼Œè¿™ä¸ªæŒ‡çš„å°±æ˜¯æˆ‘ä»¬ View çš„å®½åº¦æˆ–è€…é«˜åº¦ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ xml è®¾ç½®çš„ <code>android:layout_height</code> æˆ–è€… <code>android:layout_widht</code>ã€‚<code>childDimension</code> å¯èƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œæ¯”å¦‚ <code>24dp</code>ï¼ˆå½“ç„¶ï¼Œåœ¨ <code>measure</code> è¿‡ç¨‹ä¸­å·²ç»è½¬ä¸ºäº†å¯¹åº”çš„ <code>px</code> ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>MATCH_PARENT</code> æˆ–è€… <code>WRAP_CONTENT</code>ï¼Œè¿™ä¸¤è€…å¯¹åº”çš„å€¼åˆ†åˆ«ä¸º -1 å’Œ -2ï¼Œå±äºæ ‡è®°å€¼ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šç½‘ä¸Šçš„å¾ˆå¤šæ–‡ç« ï¼Œåœ¨çœ‹çš„æ—¶å€™å¾ˆå®¹æ˜“è®©äººæ¨¡ç³Šäº† <code>MATCH_PARENT</code> åŠ <code>WRAP_CONTENT</code>  è¿™ä¸¤è€…ä¸ <code>MeasureSpec.MODE</code> çš„å…³ç³»ã€‚ä¸€äº›æ–‡ç« ä¼šè¯´ï¼Œå½“ View çš„å°ºå¯¸è®¾ç½®ä¸º <code>WRAP_CONTENT</code> çš„æ—¶å€™ï¼Œå®ƒçš„ mode å¯¹åº” <code>AT_MOST</code>ã€‚è¿™ç§è¯´æ³•å¹¶ä¸å‡†ç¡®ã€‚ <code>MATCH_PARENT</code> å’Œ<code>WRAP_CONTENT</code> åªæ˜¯ <code>childDimension</code>ï¼Œå®ƒå’Œ <code>measureSpec</code> çš„ mode æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œåªä¸è¿‡å®ƒæ˜¯æ ‡è®°ç”¨çš„ <code>childDimension</code>ï¼Œéœ€è¦å€ŸåŠ©çˆ¶ View ç»™å‡ºå…·ä½“çš„å°ºå¯¸ã€‚</p>
<p>åœ¨æ·±å…¥ <code>getChildMeasureSpec</code> çš„å…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ <code>MeasureSpec</code> çš„æ¦‚å¿µã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f95632ad98544504a36c127d0aad3e13~tplv-k3u1fbpfcp-watermark.image" alt="image-20210512111013280.png" loading="lazy"></figure>
<p><code>MeasureSpec</code> çš„ç»“æ„å¯¹äºå¼€å‘è€…æ¥è¯´åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œæ˜¯ä¸€ä¸ª 32 ä½ <code>Int</code> æ•´å‹ã€‚é«˜ 2 ä½æ˜¯ <code>MODE</code>ï¼Œä½ 30 ä½æ˜¯ <code>SIZE</code>ã€‚<code>getChildMeasureSpec</code> çš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª  <code>MeasureSpec</code>ï¼Œè¿™ä¸ª <code>MeasureSpec</code> æœ€åä¼šä½œä¸ºå‚æ•°ä¼ å…¥åˆ°å­ View çš„ <code>onMeasure</code> æ–¹æ³•ä¸­ã€‚</p>
<p><code>MODE</code> æœ‰ 3 ç§ï¼š</p>
<ul>
<li>
<p><code>EXACTLY</code></p>
<p>è¡¨ç¤ºå½“å‰ View çš„å°ºå¯¸ä¸ºç¡®åˆ‡çš„å€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å 30 ä½ <code>SIZE</code> çš„å€¼ã€‚</p>
</li>
<li>
<p><code>AT_MOST</code></p>
<p>è¡¨ç¤ºå½“å‰ View çš„å°ºå¯¸æœ€å¤§ä¸èƒ½è¶…è¿‡ <code>SIZE</code> çš„å€¼ã€‚</p>
</li>
<li>
<p><code>UNSPECIFIED</code></p>
<p>è¡¨ç¤ºå½“å‰ View çš„å°ºå¯¸ä¸å—çˆ¶ View çš„é™åˆ¶ï¼Œæƒ³è¦å¤šå¤§å°±å¯ä»¥å¤šå¤§ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>SIZE</code> çš„å€¼æ„ä¹‰ä¸å¤§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯æ»‘åŠ¨çš„çˆ¶å¸ƒå±€å¯¹å­ View æ–½åŠ çš„çº¦æŸå°±æ˜¯ <code>UNSPECIFIED</code> ï¼Œæ¯”å¦‚ ScrollView å’Œ RecyclerViewã€‚åœ¨æ»‘åŠ¨æ—¶ï¼Œå®é™…ä¸Šæ˜¯è®©å­ View åœ¨å®ƒä»¬çš„å†…éƒ¨æ»šåŠ¨ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„å­ View çš„å°ºå¯¸è¦å¤§äºçˆ¶ Viewï¼Œæ‰€ä»¥çˆ¶ View ä¸åº”è¯¥å¯¹å­ View æ–½åŠ å°ºå¯¸çš„çº¦æŸã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„ <code>SIZE</code> æ˜¯é€šè¿‡ <code>getChildMeasureSpec</code> æ–¹æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œæœ‰å¯èƒ½æ˜¯å­ View åœ¨ xml ä¸­è®¾ç½®çš„å°ºå¯¸ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯çˆ¶ View çš„å°ºå¯¸ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ 0ã€‚</p>
</li>
</ul>
<p>å›åˆ° <code>getChildMeasureSpec</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public static int getChildMeasureSpec(int spec, int padding, int childDimension) {
        int specMode = MeasureSpec.getMode(spec);
        int specSize = MeasureSpec.getSize(spec);

        int size = Math.max(0, specSize - padding);

        int resultSize = 0;
        int resultMode = 0;

        switch (specMode) {
        // Parent has imposed an exact size on us
        case MeasureSpec.EXACTLY:
            if (childDimension &gt;= 0) {
                resultSize = childDimension;
                resultMode = MeasureSpec.EXACTLY;
            } else if (childDimension == LayoutParams.MATCH_PARENT) {
                // Child wants to be our size. So be it.
                resultSize = size;
                resultMode = MeasureSpec.EXACTLY;
            } else if (childDimension == LayoutParams.WRAP_CONTENT) {
                // Child wants to determine its own size. It can't be
                // bigger than us.
                resultSize = size;
                resultMode = MeasureSpec.AT_MOST;
            }
            break;

        // Parent has imposed a maximum size on us
        case MeasureSpec.AT_MOST:
            if (childDimension &gt;= 0) {
                // Child wants a specific size... so be it
                resultSize = childDimension;
                resultMode = MeasureSpec.EXACTLY;
            } else if (childDimension == LayoutParams.MATCH_PARENT) {
                // Child wants to be our size, but our size is not fixed.
                // Constrain child to not be bigger than us.
                resultSize = size;
                resultMode = MeasureSpec.AT_MOST;
            } else if (childDimension == LayoutParams.WRAP_CONTENT) {
                // Child wants to determine its own size. It can't be
                // bigger than us.
                resultSize = size;
                resultMode = MeasureSpec.AT_MOST;
            }
            break;

        // Parent asked to see how big we want to be
        case MeasureSpec.UNSPECIFIED:
            if (childDimension &gt;= 0) {
                // Child wants a specific size... let him have it
                resultSize = childDimension;
                resultMode = MeasureSpec.EXACTLY;
            } else if (childDimension == LayoutParams.MATCH_PARENT) {
                // Child wants to be our size... find out how big it should
                // be
                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
                resultMode = MeasureSpec.UNSPECIFIED;
            } else if (childDimension == LayoutParams.WRAP_CONTENT) {
                // Child wants to determine its own size.... find out how
                // big it should be
                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
                resultMode = MeasureSpec.UNSPECIFIED;
            }
            break;
        }
        //noinspection ResourceType
        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);
    }
</code></pre>
<p>ä»£ç å¾ˆé•¿ï¼Œä½†æ˜¯å®ç°çš„åŠŸèƒ½å…¶å®ç”¨ä¸€å¥è¯å°±å¯ä»¥æ¦‚æ‹¬ï¼šåœ¨ä¸åŒçš„çˆ¶ View çš„ <code>MeasureSpec.MODE</code>  ä¸‹ï¼Œå½“å­ View çš„å°ºå¯¸åˆ†åˆ«ä¸ºå…·ä½“å€¼ã€<code>MATCH_PARENT</code> å’Œ <code>WRAP_CONTENT</code> çš„æ—¶å€™ï¼Œè®¡ç®—å‡ºå­ View çš„ <code>MeasureSpec</code> å¹¶è¿”å›ã€‚æ‰€ä»¥ä¸€å…±æœ‰ 3 x 3 = 9 ç§æƒ…å†µã€‚</p>
<p>è¿™é‡Œæˆ‘ä¸å†å¯¹æ¯ä¸€ä¸ªæƒ…å†µè§£é‡Šäº†ï¼Œä»£ç ä¸­çš„æ³¨é‡Šå·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ã€‚æˆ‘æä¸€äº›å…¶ä»–çš„ç‚¹ï¼š</p>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆå­ View çš„ <code>MeasureSpec</code> éœ€è¦ç”±çˆ¶ View å…±åŒç¡®å®šï¼Ÿ</strong></p>
<p>å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸º <code>MATCH_PARENT</code> å’Œ <code>WRAP_CONTENT</code> çš„å­˜åœ¨ï¼Œå› ä¸ºè¿™ä¸¤ä¸ª dimension éœ€è¦å€ŸåŠ©çˆ¶ View æ‰èƒ½ç¡®å®šã€‚<code>MATCH_PARENT</code> éœ€è¦çŸ¥é“çˆ¶ View æœ‰å¤šå¤§æ‰èƒ½åŒ¹é…åˆ°çˆ¶ View çš„å¤§å°ï¼›è€Œ <code>WRAP_CONTENT</code> è™½ç„¶è¡¨ç¤ºå­ View çš„å°ºå¯¸ç”±è‡ªå·±å†³å®šï¼Œä½†æ˜¯è¿™ä¸ªå¤§å°ä¸èƒ½è¶…è¿‡çˆ¶ View çš„å¤§å°ã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„ View çš„ dimension åªèƒ½è®¾ç½®ä¸ºå›ºå®šçš„æ•°å€¼ï¼Œé‚£ä¹ˆå…¶å®å­ View çš„ <code>MeasureSpec</code> å°±å’Œçˆ¶ View æ— å…³äº†ã€‚æ­£å¦‚ä¸Šé¢ä»£ç ä¸­ï¼Œå½“ <code>childDimension &gt;= 0</code> æ—¶ï¼Œå­ View çš„ <code>MeasureSpec</code> å§‹ç»ˆç”± <code>childDimension</code> å’Œ <code>MeasureSpec.EXACTLY</code> ç»„æˆã€‚</p>
</li>
<li>
<p><strong><code>AT_MOST</code> å’Œ <code>WRAP_CONTENT</code> çš„å…³ç³»</strong></p>
<p>ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« è¯´ï¼Œå½“ä¸€ä¸ª View çš„å°ºå¯¸è®¾ç½®ä¸º <code>WRAP_CONTENT</code> æ—¶ï¼Œå®ƒçš„ <code>MeasureSpec.MODE</code> å°±æ˜¯ <code>AT_MOST</code>ã€‚è¿™å¹¶ä¸å‡†ç¡®ã€‚é¦–å…ˆï¼Œå½“çˆ¶ View çš„ MODE æ˜¯ <code>UNSPECIFIED</code> æ—¶ï¼Œå­ View è®¾ç½®ä¸º <code>WRAP_CONTENT</code> æˆ– <code>MATCH_PARENT</code>ï¼Œé‚£ä¹ˆå­ View çš„ MODE ä¹Ÿéƒ½æ˜¯ <code>UNSPECIIED</code> è€Œä¸æ˜¯ <code>AT_MOST</code>ã€‚å…¶æ¬¡ï¼Œå½“çˆ¶ View æ˜¯ <code>AT_MOST</code> çš„æ—¶å€™ï¼Œå­ View çš„ <code>childDimension</code> å³ä½¿æ˜¯ <code>MATCH_PARENT</code>, å­ View çš„ MODE ä¹Ÿæ˜¯<code>AT_MOST</code>ã€‚æ‰€ä»¥ <code>AT_MOST</code> ä¸ <code>WARP_CONTENT</code> å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚</p>
<p>çœ‹èµ·æ¥æœ‰ç‚¹ä¹±ï¼Œä½†æ˜¯åªè¦å§‹ç»ˆæŠ“ä½å…³é”®ç‚¹ï¼Œå³ <code>AT_MOST</code> æ„å‘³ç€è¿™ä¸ª View çš„å°ºå¯¸æœ‰ä¸Šé™ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡ <code>MeasureSpec.SIZE</code> çš„å€¼ã€‚é‚£å…·ä½“çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿè¿™å°±è¦çœ‹åœ¨ <code>onMeasure</code> ä¸­æ˜¯å¦‚ä½•è®¾ç½® View çš„å°ºå¯¸äº†ã€‚å¯¹äºä¸€èˆ¬çš„è§†å›¾æ§ä»¶çš„ <code>onMeasure</code> é€»è¾‘ï¼Œå½“å®ƒçš„ <code>MeasureSpec.MODE</code> æ˜¯ <code>AT_MOST</code> çš„æ—¶å€™ï¼Œæ„å‘³ç€å®ƒçš„å¤§å°å°±æ˜¯åŒ…è£¹å†…å®¹çš„å¤§å°ï¼Œä½†æ˜¯æœ€å¤§ä¸èƒ½è¶…è¿‡ <code>MeasureSpec.SIZE</code>ï¼Œç±»ä¼¼äºç»™ View åŒæ—¶è®¾ç½® <code>WRAP_CONENT</code> å’Œ <code>maxHeight</code>/<code>maxWidth</code>ã€‚</p>
<p><strong>Tips:</strong> å€ŸåŠ©<code>AT_MOST</code>çš„ç‰¹æ€§ï¼Œå¯ä»¥å®ç°æœ‰ç”¨çš„åŠŸèƒ½ã€‚æ¯”å¦‚éœ€è¦ä¸€ä¸ª <code>WRAP_CONTENT</code> çš„ RecyclerViewï¼Œå®ƒçš„é«˜åº¦éš item æ•°ç›®å¢åŠ è€Œå˜é«˜ï¼Œä½†æ˜¯æœ‰æœ€å¤§é«˜åº¦çš„é™åˆ¶ï¼Œè¶…è¿‡è¿™ä¸ªé«˜åº¦ä¸å†å¢åŠ ã€‚è¦å®ç°è¿™æ ·ä¸€ä¸ª RecyclerViewï¼Œåœ¨ xml é‡Œç»™ RecyclerView è®¾ç½® <code>android:maxHeight</code> æ˜¯ä¸ç®¡ç”¨çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»§æ‰¿ RecyclerView å¹¶é‡å†™ <code>onMeasure</code> æ–¹æ³•ï¼Œåªéœ€è¦å°†</p>
<p><code>heightSpecMode</code> æ”¹æˆ <code>AT_MOST</code> å³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class MyRecyclerView extends RecyclerView {
    ...
    @Override
    protected void onMeasure(int widthSpec, int heightSpec) {
     		// æ„é€ ä¸€ä¸ª mode ä¸º AT_MOST çš„ heightSpecï¼Œsize ä¸ºä½ æƒ³è¦çš„æœ€å¤§é«˜åº¦ï¼Œç„¶åä¼ å…¥åˆ° super ä¸­å³å¯
        int newHeightSpec = MeasureSpec.makeMeasureSpec(maxHeight, MeasureSpec.AT_MOST);
        super.onMeasure(widthSpec, newHeightSpec);
    }
}
</code></pre>
</li>
<li>
<p><strong><code>UNSPECIFIED</code> ä»€ä¹ˆæ—¶å€™ç”¨åˆ°ï¼Ÿ</strong></p>
<p>ç½‘ä¸Šå¾ˆå¤šè®²è§£ç»˜åˆ¶æµç¨‹çš„æ–‡ç« ï¼Œå¯¹äº <code>UNSPECIFIED</code> éƒ½æ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œå¹¶æ²¡æœ‰è®²å¾—å¾ˆæ¸…æ¥šã€‚<code>UNSPECIFIED</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸æŒ‡å®šå°ºå¯¸ã€‚å½“ä¸€ä¸ª View çš„ <code>MeasureSpec.MODE</code> æ˜¯ <code>UNSPECIFIED</code> çš„æ—¶å€™ï¼Œè¯´æ˜çˆ¶ View å¯¹å®ƒçš„å°ºå¯¸æ²¡æœ‰ä»»ä½•çº¦æŸã€‚å®é™…ä¸Š android ä¸­ä½¿ç”¨åˆ° <code>UNSPECIFIED</code> çš„æ§ä»¶å¾ˆå°‘ï¼Œåªæœ‰ ScrollViewã€RecyclerView è¿™ç±»å¯ä»¥æ»‘åŠ¨çš„ View ä¼šç”¨åˆ°ï¼Œå› ä¸ºå®ƒä»¬çš„å­ View (ä¹Ÿå°±æ˜¯æ»‘åŠ¨çš„å†…å®¹) å¯ä»¥æ— é™é«˜ï¼Œæ¯”çˆ¶ View (è§†å£ï¼ŒViewPort) é«˜å¾—å¤šã€‚</p>
<p>æ¯”å¦‚ ScrollView ç»™å­ View æ–½åŠ çº¦æŸæ—¶ï¼Œå°±ç›´æ¥æ„é€ äº†ä¸€ä¸ª <code>UNSPECIFIED</code> çš„ <code>MeasureSpec</code> æ¥æµ‹é‡å­ Viewï¼š</p>
<pre><code class="language-java">protected void measureChildWithMargins(View child, int parentWidthMeasureSpec, int widthUsed,
            int parentHeightMeasureSpec, int heightUsed) {
        final MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();

        final int childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,
                mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin
                        + widthUsed, lp.width);
        final int usedTotal = mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin +
                heightUsed;
    // è¿™é‡Œç›´æ¥æ„é€ äº†ä¸€ä¸ª UNSPECIFIED çš„ MeasureSpec ç”¨æ¥æµ‹é‡å­ View
        final int childHeightMeasureSpec = MeasureSpec.makeSafeMeasureSpec(
                Math.max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - usedTotal),
                MeasureSpec.UNSPECIFIED);
        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);
    }
</code></pre>
</li>
</ul>
<h3 id="ä¸‰-onmeasure-è¿‡ç¨‹">ä¸‰ã€onMeasure è¿‡ç¨‹</h3>
<p>å‰é¢æˆ‘ä»¬æ˜ç™½äº† <code>onMeasure</code> æ–¹æ³•çš„å…¥å‚ <code>MeasureSpec</code> åˆ°åº•æ˜¯æ€æ ·å¾—åˆ°çš„ï¼Œç°åœ¨æˆ‘ä»¬æŠŠé‡ç‚¹è½¬ç§»åˆ° <code>onMeasure</code> è¿‡ç¨‹ã€‚</p>
<p>å½“ç„¶ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¹‹å‰ä¸æ˜¯å·²ç»å¾—åˆ°äº† <code>MeasureSpec</code> å—ï¼Œ<code>MeasureSpec</code> å†…éƒ¨ä¸æ˜¯å·²ç»æœ‰äº†å°ºå¯¸çš„ä¿¡æ¯å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†æµ‹é‡å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œ<code>MeasureSpec</code> ä¸­çš„å°ºå¯¸å¹¶ä¸èƒ½ç†è§£æˆ View çš„å®é™…å°ºå¯¸ï¼Œ<code>MeasureSpec</code> æ›´å¤šçš„æ˜¯ä½œä¸ºä¸€ç§çˆ¶ View å¯¹å­ View æµ‹é‡çš„<strong>çº¦æŸ</strong>ã€‚å½“å­ View è¦è¿›è¡Œæµ‹é‡æ—¶ï¼Œå¿…é¡»è¦çŸ¥é“è¿™ä¸ªçº¦æŸã€‚è€Œå­ View å…·ä½“è¦æœ‰å¤šå¤§ï¼Œæ˜¯è¦ä¾èµ– <code>onMeasure</code> çš„é€»è¾‘ç¡®å®šçš„ã€‚ä½ å½“ç„¶å¯ä»¥å®Œå…¨ä¸ç†ä¼šè¿™ä¸ªçº¦æŸï¼Œåœ¨ <code>onMeasure</code> ä¸­é€šè¿‡ <code>setMeasuredDimension</code> æ–¹æ³•éšæ„ç»™ View è®¾ç½®å¤§å°ï¼Œä½†æ˜¯ä¸€èˆ¬æ˜¯ä¸ä¼šè¿™æ ·åšçš„ï¼Œé™¤éçˆ¶ View ç»™ä½ çš„çº¦æŸæ˜¯ <code>UNSPEECIFIED</code>ã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹æœ€ç®€å•çš„ View.java ä¸­çš„ <code>onMeasure</code> æ–¹æ³•å®ç°ï¼š</p>
<pre><code class="language-java">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),
                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ View çš„ <code>onMeasure</code> ä¸­ï¼Œæ˜¯é€šè¿‡ <code>getDefaultSize</code> æ¥ç¡®å®šå¤§å°çš„ï¼Œç„¶åä½¿ç”¨ <code>setMeasuredDimension</code> æ¥è®¾ç½® View çš„å®½é«˜ã€‚</p>
<p><code>getDefaultSize</code> æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public static int getDefaultSize(int size, int measureSpec) {
        int result = size;
        int specMode = MeasureSpec.getMode(measureSpec);
        int specSize = MeasureSpec.getSize(measureSpec);

        switch (specMode) {
        case MeasureSpec.UNSPECIFIED:
            result = size;
            break;
        case MeasureSpec.AT_MOST:
        case MeasureSpec.EXACTLY:
            result = specSize;
            break;
        }
        return result;
    }
</code></pre>
<p>é€»è¾‘å¾ˆå¥½æ‡‚ã€‚å½“ <code>specMode</code> æ˜¯ <code>UNSPECIFIED</code> çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>getSuggestedMinimumWidth</code>/<code>getSuggestedMinimumHeight</code> è¿”å›çš„å°ºå¯¸ï¼›å½“ <code>specMode</code> æ˜¯ <code>AT_MOST</code> æˆ– <code>EXACTLY</code> çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>specSize</code>ï¼Œå³ <code>MeasureSpec.SIZE</code>ã€‚</p>
<p>ä»ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå½“å­ View çš„ dimension æ˜¯ <code>WRAP_CONTENT</code>ï¼Œ è€Œçˆ¶ View çš„ <code>specMode</code> æ˜¯ <code>EXACTLY</code> æˆ– <code>AT_MOST</code> çš„æ—¶å€™ï¼Œå­ View çš„ <code>specMode</code> ä¹Ÿæ˜¯ <code>AT_MOST</code>ã€‚è€Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“ View çš„ <code>specMode</code> æ˜¯ <code>AT_MOST</code> çš„æ—¶å€™ï¼Œå´ç›´æ¥å°† <code>specSize</code> è¿”å›äº†ï¼Œå’Œ <code>EXACTLY</code> å¤„ç†æ–¹å¼ä¸€æ ·ã€‚è¿™æ„å‘³ç€ï¼ŒView è¿™ä¸ªç±»åœ¨ xml ä¸­è®¾ç½® <code>WRAP_CONTENT</code> å’Œ <code>MATCH_PARENT</code> çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚å½“ç„¶è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºå•çº¯çš„ View ç±»è¯´ç™½äº†åªæ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œå¹¶æ²¡æœ‰â€œå†…å®¹â€ã€‚</p>
<p>ä¸è¿‡ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰ View çš„æ—¶å€™ï¼Œå¦‚æœä¸å¤å†™ <code>onMeasure</code> çš„è¯ï¼Œé‚£ä¹ˆ <code>WARP_CONTENT</code> å°±æ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚æ‰€ä»¥è‡ªå®šä¹‰ View å¦‚æœæƒ³æœ‰ <code>WRAP_CONTENT</code> çš„æ•ˆæœï¼Œé‚£ä¹ˆéœ€è¦é‡å†™ <code>onMeasure</code> å¹¶å¯¹ <code>specMode</code> ä¸º <code>AT_MOST</code> çš„æƒ…å†µåšå¤„ç†ï¼ˆå½“çˆ¶ View æ˜¯å¯æ»‘åŠ¨çš„View æ—¶ï¼Œ<code>WRAP_CONTENT</code> è¿˜æœ‰å¯èƒ½å¯¹åº” <code>UNSPECIFIED</code> çš„ <code>specMode</code>, æ‰€ä»¥æœ€å¥½ä¹Ÿå¤„ç†è¿™ç§æƒ…å†µï¼‰ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ TextView çš„ <code>onMeasure</code> æ–¹æ³•ã€‚å½“æˆ‘ä»¬ç»™ TextView è®¾ç½® <code>WRAP_CONTENT</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆè‡ªç„¶çš„ä¼šæƒ³è®© TextView çš„å®½åº¦åŒ…è£¹å®ƒå†…éƒ¨çš„æ–‡å­—ã€‚æ¥çœ‹çœ‹å®ƒçš„ <code>onMeasure</code> å®ç°ï¼š</p>
<pre><code class="language-java">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    int widthMode = MeasureSpec.getMode(widthMeasureSpec);
    int widthSize = MeasureSpec.getSize(widthMeasureSpec);
    ...
    int width;
    ...
    if (widthMode == MeasureSpec.EXACTLY) {
            // Parent has told us how big to be. So be it.
            width = widthSize;
        } else {
        // å¦‚æœ widthMode == MeasureSpec.AT_MOST || MeasureSpec.UNSPECIFIED
            if (mLayout != null &amp;&amp; mEllipsize == null) {
                des = desired(mLayout);
            }
			...
        	width = des;
            ...
   ...
   setMeasuredDimension(width, height);
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ <code>widthMode == MeasureSpec.AT_MOST</code> æ—¶ï¼Œé€šè¿‡ <code>desired(Layout layout)</code> æ–¹æ³•æ¥è®¡ç®—å¾—åˆ° widthã€‚<code>desired</code> æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">private static int desired(Layout layout) {
        int n = layout.getLineCount();
        CharSequence text = layout.getText();
        float max = 0;

        // if any line was wrapped, we can't use it.
        // but it's ok for the last line not to have a newline

        for (int i = 0; i &lt; n - 1; i++) {
            if (text.charAt(layout.getLineEnd(i) - 1) != '\n') {
                return -1;
            }
        }

        for (int i = 0; i &lt; n; i++) {
            max = Math.max(max, layout.getLineWidth(i));
        }

        return (int) Math.ceil(max);
    }
</code></pre>
<p>é€»è¾‘ç®€å•æ˜äº†ï¼Œå°±æ˜¯å–æ‰€æœ‰æ–‡å­—è¡Œçš„æœ€å¤§è¡Œå®½ã€‚</p>
<p>æ‰€ä»¥ <code>onMeasure</code> æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œæ ¹æ®çˆ¶ View å¯¹è‡ªå·±çš„çº¦æŸ(<code>widthMeasureSpec</code> å’Œ <code>heightMeasureSpec</code>)ï¼Œç»“åˆè‡ªèº«çš„ç‰¹æ€§ï¼Œè®¡ç®—å‡ºå°ºå¯¸å¹¶ç”¨ <code>setMeasuredDimension</code> èµ‹å€¼ã€‚</p>
<p>ViewGroup çš„ <code>onMeasuer</code> é€»è¾‘å’Œ View ç±»ä¼¼ï¼Œåªä¸è¿‡ ViewGroup ä¸€èˆ¬éœ€è¦å…ˆè®¡ç®—å­ View çš„å°ºå¯¸æ‰èƒ½ç¡®å®šè‡ªèº«å°ºå¯¸ã€‚æ¯”å¦‚ LinearLayout <code>WRAP_CONTENT</code> éœ€è¦å…ˆçŸ¥é“å­ View ä»¬çš„é«˜åº¦ï¼ŒåŠ èµ·æ¥æ‰èƒ½ç¡®å®šè‡ªå·±å¤šé«˜ã€‚</p>
<h3 id="å››-æœ€é¡¶å±‚çš„-measurespec">å››ã€æœ€é¡¶å±‚çš„ MeasureSpec</h3>
<p>å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œå­ View åœ¨ <code>onMeasure</code> æ–¹æ³•ä¸­ä¼ å…¥çš„ <code>measureSpec</code> å‚æ•°æ˜¯ç”±çˆ¶ View çš„ <code>measureSpec</code> å’Œ å­ View çš„ <code>childDimension</code> å…±åŒè®¡ç®—å¾—åˆ°çš„çº¦æŸã€‚è€Œçˆ¶ View çš„ <code>measureSpec</code> æ˜¯ç”±çˆ¶ View çš„çˆ¶ View è®¡ç®—æ¥çš„ã€‚è¿™æ ·å½¢æˆäº†ä¸€ä¸ªé“¾æ¡ã€‚é‚£è¿™ä¸ªé“¾æ¡çš„å¤´åœ¨å“ªé‡Œå‘¢ï¼Œæœ€é¡¶ç«¯çš„æ ¹ View çš„åœ¨ <code>onMeasure</code> çš„æ—¶å€™å®ƒçš„å…¥å‚ <code>measureSpec</code> æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p>
<p>å¯¹ä¸€ä¸ª Activity æ¥è¯´ï¼Œæœ€é¡¶å±‚çš„ View æ˜¯ <code>DecorView</code>ï¼Œå¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Activity -&gt; WindowManager -&gt; ViewRootImpl -&gt; DecorView</p>
</blockquote>
<p>å½“ Activity é€šè¿‡ WindowManager å°† <code>DecorView</code> æ·»åŠ åˆ° window ä¸­æ—¶ï¼Œä¼šè°ƒç”¨ ViewRootImpl çš„ <code>setView</code> æ–¹æ³•ï¼ŒæŒæœ‰ <code>DecorView</code> ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// WindowManagerGlobal.java
public void addView(View view, ViewGroup.LayoutParams params,
            Display display, Window parentWindow, int userId) { 
    ...
    root = new ViewRootImpl(view.getContext(), display);

    view.setLayoutParams(wparams);

    mViews.add(view);
    mRoots.add(root);
    mParams.add(wparams);
    ...
}
</code></pre>
<p>æµ‹é‡è¿‡ç¨‹æ­£æ˜¯ç”± ViewRootImpl å‘èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€é¡¶éƒ¨çš„ <code>DecorView</code> åœ¨ <code>measure</code> è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ <code>measureSpec</code> å°±æ˜¯ç”± ViewRootImpl ä¼ å…¥çš„ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ ViewRootImple çš„ <code>performTraversals</code> :</p>
<pre><code class="language-java">// ViewRootImpl.java
private void performTraversals() {
    if (mWidth != frame.width() || mHeight != frame.height()) {
                mWidth = frame.width();
                mHeight = frame.height();
    }
    ...
    int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);
    int childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);
    // Ask host how big it wants to be
    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);
    ...
}

 private static int getRootMeasureSpec(int windowSize, int rootDimension) {
        int measureSpec;
        switch (rootDimension) {

        case ViewGroup.LayoutParams.MATCH_PARENT:
            // Window can't resize. Force root view to be windowSize.
            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);
            break;
        case ViewGroup.LayoutParams.WRAP_CONTENT:
            // Window can resize. Set max size for root view.
            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);
            break;
        default:
            // Window wants to be an exact size. Force root view to be that size.
            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);
            break;
        }
        return measureSpec;
    }

private void performMeasure(int childWidthMeasureSpec, int childHeightMeasureSpec) {
        if (mView == null) {
            return;
        }
    	mView.measure(childWidthMeasureSpec, childHeightMeasureSpec);
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€é¡¶å±‚çš„ <code>measureSpec</code> é€šè¿‡ <code>getRootMeasureSpec</code> æ–¹æ³•æ„é€ çš„ï¼Œç„¶ååœ¨ <code>performMeasure</code> ä¸­ä¼ é€’ç»™ <code>mView</code>ï¼ˆå°±æ˜¯ <code>DecorView</code>ï¼‰å»è¿›è¡Œ <code>measure</code> æ“ä½œã€‚</p>
<p><code>getRootMeasureSpec</code> æ–¹æ³•ä¸­ï¼Œ<code>mWidth/mHeight</code> ä¸€èˆ¬æ˜¯å±å¹•çš„å®½/é«˜ï¼Œè€Œ <code>rootDimension</code> æ˜¯ <code>DecorView</code> çš„ <code>layout_width</code> å’Œ <code>layout_height</code>ã€‚è¿™ä¸¤ä¸ªå€¼åœ¨ WindowManager è°ƒç”¨ <code>addView</code> çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ï¼Œæ˜¯ <code>MATCH_PARENT</code>ã€‚æ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„æ˜¯ä»£ç  <code>MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);</code> æ„é€ çš„ MeasureSpecï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>DecorView</code> çš„å°ºå¯¸çº¦æŸæ˜¯ç¡®åˆ‡çš„å®½é«˜å€¼ï¼Œå¹¶ä¸”æ˜¯å±å¹•å®½é«˜ã€‚è¿™æ˜¯å¾ˆåˆç†çš„ï¼Œå› ä¸ºæœ€é¡¶å±‚çš„ View å°±åº”è¯¥æ˜¯å±å¹•å¤§å°ã€‚</p>
<h3 id="äº”-æ€»ç»“">äº”ã€æ€»ç»“</h3>
<ul>
<li>å­ View åœ¨ <code>onMeasure</code> æ–¹æ³•ä¸­ä½¿ç”¨çš„ <code>MeasureSpec</code> æ¥è‡ªçˆ¶ Viewï¼Œè€Œçˆ¶ View çš„ <code>MeasureSpec</code> æ¥è‡ªçˆ¶ View çš„çˆ¶ Viewï¼Œè¿™æ˜¯ä¸€ä¸ªé“¾æ¡ã€‚ä¹‹æ‰€ä»¥å­ View å°ºå¯¸è¦å—åˆ°çˆ¶ View çš„çº¦æŸï¼Œæ˜¯å› ä¸º <code>MATCH_PARENT</code> å’Œ <code>WRAP_CONTENT</code> çš„å­˜åœ¨ã€‚å¦‚æœå­ View çš„å°ºå¯¸åªèƒ½è®¾ç½®ä¸ºå›ºå®šçš„ dp å€¼ï¼Œé‚£çˆ¶ View å¯¹å­ View çš„çº¦æŸå°±æ„ä¹‰ä¸å¤§äº†ã€‚</li>
<li>å­ View çš„ <code>MeasureSpec</code> æ˜¯ç”±å­ View çš„ <code>dimension</code> å’Œçˆ¶ View çš„ <code>MeasureSpec</code> å…±åŒè®¡ç®—å¾—æ¥çš„ã€‚å­ View çš„ <code>dimension</code> å°±æ˜¯å­ View åœ¨ xml ä¸­è®¾ç½®çš„ <code>android:layout_height/android:layout_width</code>ã€‚æ³¨æ„ï¼Œ<code>WRAP_CONTENT</code> å’Œ <code>MATCH_PARENT</code>  ä¹Ÿæ˜¯ <code>dimension</code>ï¼Œæ˜¯å°ºå¯¸ï¼Œä¸æ˜¯ <code>MeasureSpec.MODE</code>ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸è¦å¼„æ··ï¼Œè™½ç„¶è¿™ä¸¤è€…ä¹‹é—´æœ‰å…³ç³»ã€‚</li>
<li><code>WRAP_CONTENT</code> å’Œ <code>AT_MOST</code> ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚<code>UNSPECIFIED</code>ä¸€èˆ¬åªç”¨äºå¯æ»‘åŠ¨çš„ Viewã€‚</li>
<li>è™½ç„¶ <code>MeasureSpec</code> ä¸­å·²ç»åŒ…å«äº†å°ºå¯¸çº¦æŸä¿¡æ¯ï¼Œä½†æ˜¯å­ View ä»ç„¶éœ€è¦åœ¨ <code>onMeasure</code> ä¸­è¿›ä¸€æ­¥ç¡®å®šå­ View å…·ä½“åº”è¯¥æœ‰å¤šå¤§ã€‚æ¯”å¦‚ä¸Šæ–‡æåˆ°çš„ TextView çš„ä¾‹å­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰ View æ˜¯éœ€è¦è‡ªå·±å¤„ç† <code>specMode</code> ä¸º <code>AT_MOST</code> çš„æƒ…å†µçš„ï¼Œå› ä¸º View ç±»æœ¬èº«æ²¡æœ‰å¤„ç†è¿™ä¸ªæƒ…å†µï¼Œä¼šå¯¼è‡´ <code>WRAP_CONTENT</code>  å¤±æ•ˆã€‚</li>
<li>åœ¨é“¾æ¡æœ€é¡¶ç«¯çš„ <code>DecorView</code> çš„ <code>MeasureSpec</code> å°±æ˜¯ <code>ViewRootImpl</code> åœ¨ <code>performMeasure</code> æ–¹æ³•ä¸­æ„é€ çš„ <code>MeasureSpec</code>ã€‚è¿™ä¸ª <code>MeasureSpec</code> çš„ <code>SIZE</code>æ˜¯å±å¹•å®½é«˜ï¼Œ<code>MODE</code> æ˜¯ <code>EXACTLY</code>ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android åµŒå¥—æ»‘åŠ¨æ€»ç»“]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/android-qian-tao-hua-dong-zong-jie/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/android-qian-tao-hua-dong-zong-jie/">
        </link>
        <updated>2021-03-14T10:25:14.000Z</updated>
        <content type="html"><![CDATA[<h3 id="ä¸€-ä»€ä¹ˆæ˜¯åµŒå¥—æ»‘åŠ¨">ä¸€ã€ä»€ä¹ˆæ˜¯åµŒå¥—æ»‘åŠ¨</h3>
<p>åµŒå¥—æ»‘åŠ¨æ˜¯ android å¼€å‘ä¸­å¸¸è§çš„ä¸€ç§ UI æ•ˆæœã€‚å½“ä¸€ä¸ªå¸ƒå±€ä¸­åŒ…å«å¤šä¸ªå¯ä»¥æ»‘åŠ¨çš„ Viewï¼Œå¹¶ä¸”è¿™äº› View äº’ç›¸åµŒå¥—çš„æ—¶å€™ï¼Œå°±éœ€è¦åšåµŒå¥—æ»‘åŠ¨çš„å¤„ç†æ¥è®© UI äº¤äº’æœ‰æ›´æµç•…çš„æ•ˆæœï¼Œæ¯”å¦‚å¸é¡¶æ•ˆæœã€‚å¸¸è§çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbee9045194e4b09a0fd92554693c80c~tplv-k3u1fbpfcp-watermark.image" alt="1615737449263149" height="280px" width="120px"/>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæœ€å¤–å±‚çš„çˆ¶å¸ƒå±€å¯ä»¥æ»‘åŠ¨ï¼Œå†…å±‚çš„ RecyclerView ä¹Ÿå¯ä»¥æ»‘åŠ¨ã€‚å½“ä¸Šæ»‘ RecyclerView çš„æ—¶å€™ï¼Œæœ€å¤–å±‚çš„çˆ¶å¸ƒå±€å…ˆä¸Šæ»‘ï¼Œç›´åˆ°ä¸Šæ»‘åˆ° tab çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ RecyclerView å¼€å§‹æ»‘åŠ¨ï¼Œçˆ¶å¸ƒå±€åœæ­¢æ»‘åŠ¨ï¼Œå¹¶ä¸”æ‰‹æŒ‡ä¸éœ€è¦ç¦»å¼€å±å¹•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å®Œæˆæ•´ä¸ªæ“ä½œã€‚è¿™æ ·å°±è¾¾åˆ°äº†å†…å¤–å¸ƒå±€è¿è´¯æ»‘åŠ¨çš„æ•ˆæœï¼Œå¹¶ä¸”è¾¾åˆ°äº† tab å¸é¡¶çš„æ•ˆæœã€‚</p>
<h3 id="äºŒ-æ»‘åŠ¨åµŒå¥—è§£å†³æ–¹æ¡ˆ">äºŒã€æ»‘åŠ¨åµŒå¥—è§£å†³æ–¹æ¡ˆ</h3>
<p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½åšåˆ°è¿™æ ·çš„è¿è´¯çš„åµŒå¥—æ»‘åŠ¨å‘¢ï¼Ÿ</p>
<h4 id="1-æ‰‹åŠ¨è¦†å†™äº‹ä»¶åˆ†å‘ä¸æ‹¦æˆª">1ã€æ‰‹åŠ¨è¦†å†™äº‹ä»¶åˆ†å‘ä¸æ‹¦æˆª</h4>
<p>å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ android çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œè¦åšåˆ°åµŒå¥—æ»‘åŠ¨çš„æ•ˆæœï¼Œé‡å†™äº‹ä»¶åˆ†å‘æ˜¯æœ€ä¸ºåŸå§‹çš„ä¸€ç§æ–¹æ³•ï¼Œæ—©æœŸçš„ android å¼€å‘ä»¬å°±æ˜¯è¿™æ ·åšçš„ã€‚ä»¥ä¹‹å‰å±•ç¤ºçš„æ•ˆæœçš„ä¸ºä¾‹ï¼Œåœ¨ ACTION_MOVE äº‹ä»¶åˆ†å‘æ—¶ï¼Œå…ˆåˆ¤æ–­ tab ä½ç½®æ˜¯å¦åˆ°é¡¶ç«¯ï¼Œå¦‚æœæ²¡åˆ°ï¼Œåˆ™è®©å¤–å±‚çˆ¶å¸ƒå±€æ‹¦æˆªæ‰ MOVE äº‹ä»¶ï¼Œçˆ¶å¸ƒå±€æ»‘åŠ¨ã€‚å¦‚æœå·²ç»åˆ°äº†ï¼Œåˆ™ä¸æ‹¦æˆªï¼Œå°†äº‹ä»¶ä¼ ç»™å­ RecyclerViewï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ceab0391ad84aefa0fb815650c899d0~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy"></figure>
<p>æ˜¯å¦æ‹¦æˆªäº‹ä»¶ï¼Œå³é‡å†™ <code>onIntercetTouchEvent</code> æ–¹æ³•ï¼Œæ˜¯è¯¥æµç¨‹çš„æ ¸å¿ƒã€‚</p>
<h5 id="æ‰‹åŠ¨é‡å†™äº‹ä»¶åˆ†å‘çš„ç¼ºç‚¹">æ‰‹åŠ¨é‡å†™äº‹ä»¶åˆ†å‘çš„ç¼ºç‚¹</h5>
<ul>
<li>
<p><strong>åªé€‚åˆæ¯”è¾ƒç®€å•çš„åµŒå¥—æ»‘åŠ¨æƒ…å†µ</strong></p>
<p>è¿™ä¸€ç‚¹å¾ˆå¥½ç†è§£ã€‚å› ä¸ºä½ éœ€è¦è‡ªå·±æ‰‹åŠ¨ç¼–å†™æ‹¦æˆªé€»è¾‘ï¼ŒåµŒå¥—æ»‘åŠ¨çš„å¸ƒå±€ä¸€æ—¦å¤æ‚ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤§é‡çš„ä»£ç å’Œé€»è¾‘æ¥å®ç°åµŒå¥—æ»‘åŠ¨ï¼Œå¢å¤§ç»´æŠ¤çš„æˆæœ¬ã€‚æ‰€ä»¥ä¸é€‚åˆå¤æ‚çš„åµŒå¥—æ»‘åŠ¨å¸ƒå±€ï¼Œå®é™…ä¸Šä¹Ÿå¾ˆéš¾å®ç°å¤æ‚çš„åµŒå¥—æ»‘åŠ¨ã€‚</p>
</li>
<li>
<p><strong>éš¾ä»¥æ”¯æŒ fling</strong></p>
<p>fling æŒ‡çš„æ˜¯æ»‘åŠ¨æ¾æ‰‹åï¼Œè§†å›¾ç»§ç»­ä¾é æƒ¯æ€§æ»‘åŠ¨çš„è¿‡ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼ŒåµŒå¥—æ»‘åŠ¨æ˜¯éœ€è¦æ”¯æŒ fling çš„ã€‚é‚£ä¹ˆå¯¹äºæ‰‹åŠ¨ç¼–å†™äº‹ä»¶åˆ†å‘æ¥è¯´ï¼Œé™¤äº†éœ€è¦é‡å†™ <code>onInterceptTouchEvent</code> ä¹‹å¤–ï¼Œè¿˜éœ€è¦é’ˆå¯¹ <code>ACTION_UP</code> äº‹ä»¶è¿›è¡Œç‰¹å®šçš„å¤„ç†ï¼Œå› ä¸º fling æºäº <code>ACTION_UP</code> äº‹ä»¶æ—¶äº§ç”Ÿçš„ <code>Velocity</code>ã€‚ç„¶è€Œäº‹ä»¶åˆ†å‘æœºåˆ¶å¹¶æ²¡æœ‰æä¾›åƒ <code>onInterceptTouchEvent</code> çš„é‚£æ ·çš„å¯¹å¤–æš´éœ²çš„æ¥å£è®©å¼€å‘è€…æ¥å¤„ç† <code>ACITON_UP</code> äº‹ä»¶ã€‚åªèƒ½é€šè¿‡å¤å†™ <code>onTouchEvent</code> ç­‰æ–¹æ³•æ¥å¤„ç†ï¼Œè€Œè¿™æ ·åšçš„é™åˆ¶å¤ªå¤§ï¼Œå› ä¸ºä½ éœ€è¦è°ƒç”¨ <code>super.onTouchEvent</code>ï¼Œä½†æ˜¯ä½ åˆä¸èƒ½ä¿®æ”¹å…¶ä¸­çš„ä»£ç ã€‚</p>
</li>
<li>
<p><strong>æ²¡æœ‰åŠæ³•å®ç°è¿è´¯çš„å¸é¡¶åµŒå¥—æ»‘åŠ¨</strong></p>
<p>è¿˜æ˜¯ä»¥ä¹‹å‰çš„ä¾‹å­æ¥è¯´ï¼Œå½“ tab å¸é¡¶åï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯æ‰‹æŒ‡ä¸æ¾å¼€ç»§ç»­å¾€ä¸Šæ»‘å¯ä»¥ä½¿ RecyclerView å¾€ä¸Šæ»‘ï¼Œç„¶è€Œæ‰‹åŠ¨æ‹¦æˆªäº‹ä»¶çš„åšæ³•æ˜¯åšä¸åˆ°çš„ï¼Œå¿…é¡»å…ˆæŠ¬èµ·æ‰‹æŒ‡ç„¶åå†æ¬¡æ»‘åŠ¨ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿçœ‹çœ‹  <code>dispatchTouchEvent</code>  ä¸­çš„ä»£ç ï¼š</p>
<pre><code class="language-java">if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) {
                ......
            } else {
  // å½“ MotionEvent ä¸º ACTION_MOVE ä¸” mFirstTouchTarget == null æ—¶ï¼Œä»ç„¶æ‹¦æˆªäº‹ä»¶
                intercepted = true;
            }
</code></pre>
<p>å½“ ViewGroup åœ¨åˆ†å‘äº‹ä»¶æ—¶ï¼Œå¦‚æœ <code>mFirstTouchTarget == null</code> åˆ™è¯´æ˜ ViewGroup ä¸­æ²¡æœ‰å­ View æ¥æ¶ˆè´¹äº‹ä»¶ï¼Œè¯¥äº‹ä»¶ç”± ViewGroup è‡ªå·±å¤„ç†ã€‚è€Œå½“ ViewGroup æ‹¦æˆªäº‹ä»¶åï¼Œæ°æ°ä¼šå°† <code>mFirstTouchTarget</code> ç½®ç©ºã€‚å›åˆ°ä¹‹å‰çš„ä¾‹å­ï¼Œå½“å¤–å±‚æ»‘åŠ¨çˆ¶å¸ƒå±€æ‹¦æˆªäº† <code>ACTION_MOVE</code> äº‹ä»¶åï¼Œä¼šå°† <code>mFirstTouchTarget</code> ç½®ç©ºã€‚æ¥ä¸‹æ¥å³ä½¿å¸é¡¶åä¸æ‹¦æˆªäº‹ä»¶ï¼Œç”±äº <code>mFirstTouchTarget</code> å·²ç»ä¸º <code>null</code>ï¼Œæ‰€ä»¥äº‹ä»¶ä¸ä¼šä¼ é€’åˆ°å­ RecyclerViewï¼Œè€Œæ˜¯ç»§ç»­ç”±çˆ¶å¸ƒå±€æ¶ˆè´¹ã€‚è¿™æ ·å°±æ²¡æœ‰è¾¾åˆ°è¿è´¯çš„å¸é¡¶åµŒå¥—æ»‘åŠ¨çš„æ•ˆæœã€‚</p>
</li>
</ul>
<h4 id="2-coordinatorlayout-appbar-behavior-scrollflag">2ã€CoordinatorLayout + AppBar + Behavior + scrollFlag</h4>
<p><code>CoordinatorLayout</code> æ˜¯ google æä¾›çš„ä¸€å¥—å¯ä»¥å®ç°å¤æ‚äº¤äº’æ•ˆæœçš„å¸ƒå±€ï¼Œå’Œ <code>AppBar</code> ã€<code>Behavior</code>ã€<code>scrollFlag</code> é…åˆä½¿ç”¨ï¼Œå¯ä»¥è§£è€¦åœ°å®šåˆ¶å¤šç§æ•ˆæœï¼Œè¿™äº›æ•ˆæœç”± <code>Behavior</code> å’Œ <code>scrollFlag</code>æŒ‡å®šã€‚å¹¶ä¸” <code>Behavior</code> å¯ä»¥è‡ªå®šä¹‰ã€‚</p>
<p>è¦ç”¨ <code>CoordinatorLayout</code> å®ç°åµŒå¥—æ»‘åŠ¨éå¸¸ç®€å•ï¼Œåªè¦æŒ‰å¦‚ä¸‹ç¼–å†™å¸ƒå±€æ–‡ä»¶ï¼š</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;androidx.coordinatorlayout.widget.CoordinatorLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

    &lt;com.google.android.material.appbar.AppBarLayout
        android:layout_height=&quot;300dp&quot;
        android:layout_width=&quot;match_parent&quot;&gt;
        
      	// å¯æ»‘åŠ¨éƒ¨åˆ†
        &lt;View
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;0dp&quot;
            android:layout_weight=&quot;1&quot;
            app:layout_scrollFlags=&quot;scroll&quot;/&gt;

        &lt;TextView
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;64dp&quot;
            android:layout_gravity=&quot;bottom&quot;
            android:text=&quot;Top&quot;
            android:textSize=&quot;32sp&quot;
            android:textColor=&quot;@color/white&quot;
            android:gravity=&quot;center&quot;
            android:textStyle=&quot;bold&quot;/&gt;

    &lt;/com.google.android.material.appbar.AppBarLayout&gt;

    &lt;androidx.recyclerview.widget.RecyclerView
        android:id=&quot;@+id/rv&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;/&gt;

&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;
</code></pre>
<p>å°† <code>AppBarLayout</code> ä¸­éœ€è¦ä¸Šæ»‘éšè—çš„éƒ¨åˆ†çš„ <code>scrollFlag</code>æŒ‡å®šä¸º <code>scroll</code> ï¼Œåœ¨RecyclerView ä¸­æŒ‡å®š <code>behavior</code> ä¸º <code>appbar_scrolling_view_behavior</code> å°±å¯ä»¥å®ç°æœ€ç®€å•çš„å¸é¡¶åµŒå¥—æ»‘åŠ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb76cc0af0dd48769b24d6c2f8ec3342~tplv-k3u1fbpfcp-watermark.image" alt="1615743833115315" height="280px" width="120px" />
<p>çœ‹èµ·æ¥åƒå¸¦æœ‰ header çš„ RecyclerView åœ¨æ»‘åŠ¨ï¼Œä½†å…¶å®æ˜¯åµŒå¥—æ»‘åŠ¨ã€‚</p>
<p><code>layout_scrollFlags</code> å’Œ <code>layout_behavior</code> æœ‰å¾ˆå¤šå¯é€‰å€¼ï¼Œé…åˆèµ·æ¥å¯ä»¥å®ç°å¤šç§æ•ˆæœï¼Œä¸åªé™äºåµŒå¥—æ»‘åŠ¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒ API æ–‡æ¡£ã€‚</p>
<p>ä½¿ç”¨ <code>CoordinatorLayout</code> å®ç°åµŒå¥—æ»‘åŠ¨æ¯”æ‰‹åŠ¨å®ç°è¦å¥½å¾—å¤šï¼Œæ—¢å¯ä»¥å®ç°è¿è´¯çš„å¸é¡¶åµŒå¥—æ»‘åŠ¨ï¼Œåˆæ”¯æŒ flingã€‚è€Œä¸”æ˜¯å®˜æ–¹æä¾›çš„å¸ƒå±€ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œå‡º bug çš„å‡ ç‡å¾ˆå°ï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ã€‚ä¸è¿‡ä¹Ÿæ­£æ˜¯å› ä¸ºå®˜æ–¹å°†å…¶å°è£…å¾—å¾ˆå¥½ï¼Œä½¿ç”¨ <code>CoordinatorLayout</code> å¾ˆéš¾å®ç°æ¯”è¾ƒå¤æ‚çš„åµŒå¥—æ»‘åŠ¨å¸ƒå±€ï¼Œæ¯”å¦‚å¤šçº§åµŒå¥—æ»‘åŠ¨ã€‚</p>
<h4 id="3-åµŒå¥—æ»‘åŠ¨ç»„ä»¶-nestedscrollingparent-å’Œ-nestedscrollingchild">3ã€åµŒå¥—æ»‘åŠ¨ç»„ä»¶ NestedScrollingParent å’Œ NestedScrollingChild</h4>
<p><code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code> æ˜¯ google å®˜æ–¹æä¾›åœ°ä¸€å¥—ä¸“é—¨ç”¨æ¥è§£å†³åµŒå¥—æ»‘åŠ¨åœ°ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public interface NestedScrollingParent2 extends NestedScrollingParent {

    boolean onStartNestedScroll(@NonNull View child, @NonNull View target, @ScrollAxis int axes,
            @NestedScrollType int type);

    void onNestedScrollAccepted(@NonNull View child, @NonNull View target, @ScrollAxis int axes,
            @NestedScrollType int type);

    void onStopNestedScroll(@NonNull View target, @NestedScrollType int type);

    void onNestedScroll(@NonNull View target, int dxConsumed, int dyConsumed,
            int dxUnconsumed, int dyUnconsumed, @NestedScrollType int type);

    void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed,
            @NestedScrollType int type);

}

public interface NestedScrollingChild2 extends NestedScrollingChild {
    
    boolean startNestedScroll(@ScrollAxis int axes, @NestedScrollType int type);

    void stopNestedScroll(@NestedScrollType int type);

    boolean hasNestedScrollingParent(@NestedScrollType int type);

    boolean dispatchNestedScroll(int dxConsumed, int dyConsumed,
            int dxUnconsumed, int dyUnconsumed, @Nullable int[] offsetInWindow,
            @NestedScrollType int type);

    boolean dispatchNestedPreScroll(int dx, int dy, @Nullable int[] consumed,
            @Nullable int[] offsetInWindow, @NestedScrollType int type);
}

</code></pre>
<p>éœ€è¦åµŒå¥—æ»‘åŠ¨çš„ View å¯ä»¥å®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¤å†™å…¶ä¸­çš„æ–¹æ³•ã€‚è¿™å¥—ç»„ä»¶å®ç°åµŒå¥—æ»‘åŠ¨çš„æ ¸å¿ƒåŸç†å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<ul>
<li><code>NestedScrollingChild</code> åœ¨ <code>onTouchEvent</code> æ–¹æ³•ä¸­å…ˆå°† <code>ACITON_MOVE</code> äº‹ä»¶äº§ç”Ÿçš„ä½ç§» dx å’Œ dy é€šè¿‡ <code>dispatchNestedPreScroll</code> ä¼ é€’ç»™ <code>NestedScrollingParent</code></li>
<li><code>NestedScrollingParent</code> åœ¨ <code>onNestedPreScroll</code> ä¸­æ¥å—åˆ° dx å’Œ dy å¹¶è¿›è¡Œæ¶ˆè´¹ã€‚å¹¶å°†æ¶ˆè´¹æ‰çš„ä½ç§»æ”¾å…¥ <code>int[] consumed</code> ä¸­ï¼Œ<code>consumed</code> æ•°ç»„æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 2 çš„ int ç±»å‹æ•°ç»„ï¼Œ<code>consumed[0]</code> ä»£è¡¨ x è½´çš„æ¶ˆè€—ï¼Œ<code>consumed[1]</code> ä»£è¡¨ y è½´çš„æ¶ˆè€—</li>
<li><code>NestedScrollingChild</code> ä¹‹åä» <code>int[] consumed</code> æ•°ç»„ä¸­æ‹¿åˆ° <code>NestedScrollingParent</code> å·²ç»æ¶ˆè´¹æ‰çš„ä½ç§»ï¼Œå‡å»ä¹‹åå¾—åˆ°å‰©ä½™çš„ä½ç§»ï¼Œå†ç”±è‡ªå·±æ¶ˆè´¹</li>
</ul>
<p>æ»‘åŠ¨ä½ç§»ä¼ é€’æ–¹å‘ç”± child -&gt; parent -&gt; childï¼Œå¦‚ä¸‹å›¾ã€‚å¦‚æœ child æ˜¯ Recyclerview ï¼Œå®ƒä¼šå…ˆæŠŠä½ç§»ç»™çˆ¶å¸ƒå±€æ¶ˆè´¹ï¼Œè¿™æ—¶çˆ¶å¸ƒå±€æ»‘åŠ¨ã€‚å½“çˆ¶å¸ƒå±€æ»‘åŠ¨é¡¶åˆ°ä¸èƒ½æ»‘åŠ¨æ—¶ï¼ŒRecyclerview è¿™æ—¶ä¼šæ¶ˆè´¹å…¨éƒ¨ä½ç§»ï¼Œè¿™æ—¶å®ƒè‡ªå·±å¼€å§‹æ»‘åŠ¨ï¼Œè¿™æ ·å°±å½¢æˆäº†åµŒå¥—æ»‘åŠ¨ï¼Œæ•ˆæœæ­£å¦‚ä¹‹å‰çš„ä¾‹å­ä¸­æ‰€çœ‹åˆ°çš„ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4df609e97e3d4cb99e2f739cc4340b00~tplv-k3u1fbpfcp-watermark.image" alt="ä½ç§»ä¼ é€’æµç¨‹" loading="lazy"></figure>
<p><code>dispatchNestedScroll</code> å’Œ <code>onNestedScroll</code> çš„ä½œç”¨åŸç†ä¸Šè¿°  preScroll çš„æ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ„é€ çš„åµŒå¥—æ»‘åŠ¨é¡ºåºå’Œ preScroll çš„ç›¸åï¼Œæ˜¯å­ View å…ˆæ¶ˆè´¹ï¼Œå­ View æ¶ˆè´¹ä¸äº†çš„æ—¶å€™ï¼Œå†ç”±çˆ¶ View å†æ¶ˆè´¹ã€‚</p>
<p>è¿™å¥—æœºåˆ¶è¿˜æ”¯æŒ flingï¼Œåœ¨æ‰‹æŒ‡ç¦»å¼€ view çš„æ—¶å€™ï¼Œå³äº§ç”Ÿ <code>ACITON_UP</code> äº‹ä»¶æ—¶ï¼Œchild å°†æ­¤æ—¶çš„ <code>Velocity</code> è½¬åŒ–ä¸ºä½ç§» <code>dx</code> æˆ– <code>dy</code>ï¼Œå¹¶é‡å¤ä¹‹å‰çš„æµç¨‹ã€‚é€šè¿‡ <code>@NestedScrollType int type</code> çš„å€¼æ¥åˆ¤æ–­æ˜¯ <code>TYPE_TOUCH</code> è¿˜æ˜¯ <code>TYPE_NON_TOUCH</code>ï¼Œ <code>TYPE_TOUCH</code>  å°±æ˜¯æ»‘åŠ¨ï¼Œ <code>TYPE_NON_TOUCH</code> å°±æ˜¯ flingã€‚</p>
<h5 id="android-ä¸­å“ªäº›-view-ä½¿ç”¨äº†è¿™å¥—æ»‘åŠ¨æœºåˆ¶">Android ä¸­å“ªäº› View ä½¿ç”¨äº†è¿™å¥—æ»‘åŠ¨æœºåˆ¶ï¼Ÿ</h5>
<ul>
<li>å®ç° <code>NestedScrollingParent</code> æ¥å£çš„ View æœ‰ï¼š<code>NestedScrollView</code>ã€<code>CoordinatorLayout</code>ã€<code>MotionLayout</code> ç­‰</li>
<li>å®ç° <code>NestedScrollingChild</code> æ¥å£çš„ View æœ‰ï¼š<code>NestedScrollView</code>ã€<code>RecyclerView</code> ç­‰</li>
<li><code>NestedScrollView</code> æ˜¯å”¯ä¸€åŒæ—¶å®ç°ä¸¤ä¸ªæ¥å£çš„ Viewï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ç”¨ä½œä¸­ä»‹æ¥å®ç°å¤šçº§åµŒå¥—æ»‘åŠ¨ï¼Œåé¢ä¼šè¯´åˆ°ã€‚</li>
</ul>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šï¼Œä¹‹å‰æåˆ°çš„ <code>CoordinatorLayout</code> å®ç°çš„åµŒå¥—æ»‘åŠ¨ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯é€šè¿‡è¿™å¥— NestedScrolling æ¥å£æ¥å®ç°çš„ã€‚ä½†æ˜¯ç”±äºå®ƒå°è£…å¾—å¤ªå¥½ï¼Œæˆ‘ä»¬æ²¡åŠæ³•åšè¿‡å¤šå®šåˆ¶ã€‚è€Œç›´æ¥ä½¿ç”¨è¿™å¥—æ¥å£ï¼Œå°±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚åšå®šåˆ¶ã€‚</p>
<p>å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»å®ç° <code>NestedScrollingChild</code> æ¥å£ï¼Œå› ä¸º RecyclerView å·²ç»åšäº†è¿™ä¸ªå®ç°ï¼Œè€Œæ¶‰åŠåˆ°åµŒå¥—æ»‘åŠ¨åœºæ™¯çš„å­ View åŸºæœ¬ä¹Ÿéƒ½æ˜¯ RecyclerViewã€‚æˆ‘ä»¬çœ‹çœ‹ RecyclerView çš„ç›¸å…³æºç ï¼š</p>
<pre><code class="language-java">public boolean onTouchEvent(MotionEvent e) {
    ...
    case MotionEvent.ACTION_MOVE: {
               ...
                // è®¡ç®— dxï¼Œdy
                int dx = mLastTouchX - x;
                int dy = mLastTouchY - y;
				...
                    mReusableIntPair[0] = 0;
                    mReusableIntPair[1] = 0;
       				...
                    // åˆ†å‘ preScroll
                    if (dispatchNestedPreScroll(
                        canScrollHorizontally ? dx : 0,
                        canScrollVertically ? dy : 0,
                        mReusableIntPair, mScrollOffset, TYPE_TOUCH
                    )) {
                        // å‡å»çˆ¶ view æ¶ˆè´¹æ‰çš„ä½ç§»
                        dx -= mReusableIntPair[0];
                        dy -= mReusableIntPair[1];
            
                        mNestedOffsets[0] += mScrollOffset[0];
                        mNestedOffsets[1] += mScrollOffset[1];
                        
                        getParent().requestDisallowInterceptTouchEvent(true);
                    }
        ...
            } break;
    ...
}


boolean scrollByInternal(int x, int y, MotionEvent ev) {
        int unconsumedX = 0;
        int unconsumedY = 0;
        int consumedX = 0;
        int consumedY = 0;
        if (mAdapter != null) {
            mReusableIntPair[0] = 0;
            mReusableIntPair[1] = 0;
            // å…ˆæ¶ˆè€—æ‰è‡ªå·±çš„ scroll
            scrollStep(x, y, mReusableIntPair);
            consumedX = mReusableIntPair[0];
            consumedY = mReusableIntPair[1];
            // è®¡ç®—å‰©ä½™çš„é‡
            unconsumedX = x - consumedX;
            unconsumedY = y - consumedY;
        }

        mReusableIntPair[0] = 0;
        mReusableIntPair[1] = 0;
    	// åˆ†å‘ nestedScroll ç»™çˆ¶ Viewï¼Œé¡ºåºå’Œ preScroll åˆšå¥½ç›¸å
        dispatchNestedScroll(consumedX, consumedY, unconsumedX, unconsumedY, mScrollOffset,
                TYPE_TOUCH, mReusableIntPair);
        unconsumedX -= mReusableIntPair[0];
        unconsumedY -= mReusableIntPair[1];
		...
    }
</code></pre>
<p>RecyclerView æ˜¯æ€ä¹ˆè°ƒåˆ°çˆ¶ View çš„ <code>onNestedPreSroll</code> å’Œ <code>onNestedScroll</code> çš„å‘¢ï¼Ÿåˆ†æä¸€ä¸‹ <code>dispatchNestedPreScroll</code> çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼Œ<code>dispatchNestedScroll</code> çš„ä»£ç åŸç†å’Œæ­¤ç±»ä¼¼ï¼Œä¸å†è´´å‡ºï¼š</p>
<pre><code class="language-java">public boolean dispatchNestedPreScroll(int dx, int dy, int[] consumed, int[] offsetInWindow,
            int type) {
        return getScrollingChildHelper().dispatchNestedPreScroll(dx, dy, consumed, offsetInWindow,type);
    }

// NestedScrollingChildHelper.java
public boolean dispatchNestedPreScroll(int dx, int dy, @Nullable int[] consumed,
            @Nullable int[] offsetInWindow, @NestedScrollType int type) {
        if (isNestedScrollingEnabled()) {
            final ViewParent parent = getNestedScrollingParentForType(type);
            if (parent == null) {
                return false;
            }

            if (dx != 0 || dy != 0) {
                ...
                consumed[0] = 0;
                consumed[1] = 0;
                ViewParentCompat.onNestedPreScroll(parent, mView, dx, dy, consumed, type);
								...
            } 
            ...
        }
        return false;
    }

// ViewCompat.java
public static void onNestedPreScroll(ViewParent parent, View target, int dx, int dy,
            int[] consumed, int type) {
        if (parent instanceof NestedScrollingParent2) {
            // First try the NestedScrollingParent2 API
            ((NestedScrollingParent2) parent).onNestedPreScroll(target, dx, dy, consumed, type);
        } else if (type == ViewCompat.TYPE_TOUCH) {
            // Else if the type is the default (touch), try the NestedScrollingParent API
            if (Build.VERSION.SDK_INT &gt;= 21) {
                try {
                    parent.onNestedPreScroll(target, dx, dy, consumed);
                } catch (AbstractMethodError e) {
                    Log.e(TAG, &quot;ViewParent &quot; + parent + &quot; does not implement interface &quot;
                            + &quot;method onNestedPreScroll&quot;, e);
                }
            } else if (parent instanceof NestedScrollingParent) {
                ((NestedScrollingParent) parent).onNestedPreScroll(target, dx, dy, consumed);
            }
        }
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒRecyclerView é€šè¿‡ä¸€ä¸ªä»£ç†ç±» <code>NestedScrollingChildHelper</code> å®Œæˆæ»‘åŠ¨åˆ†å‘ï¼Œæœ€åäº¤ç»™ <code>ViewCompat</code> çš„é™æ€æ–¹æ³•æ¥è®©çˆ¶ View å¤„ç† <code>onNestedPreScroll</code>ã€‚<code>ViewCompat</code> çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å…¼å®¹ä¸åŒç‰ˆæœ¬çš„æ»‘åŠ¨æ¥å£ã€‚</p>
<h5 id="å®ç°-onnestedprescroll-æ–¹æ³•">å®ç° onNestedPreScroll æ–¹æ³•</h5>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° RecyclerView å¯¹äº <code>NestedScrollingChild</code> çš„å®ç°ï¼Œä»¥åŠè§¦å‘åµŒå¥—æ»‘åŠ¨çš„æ—¶æœºã€‚å¦‚æœæˆ‘ä»¬è¦å®ç°åµŒå¥—æ»‘åŠ¨ï¼Œå¹¶ä¸”å†…éƒ¨çš„æ»‘åŠ¨å­ View æ˜¯ RecyclerViewï¼Œé‚£ä¹ˆåªéœ€è¦è®©å¤–å±‚çš„çˆ¶ View å®ç° <code>NestedScrollingParent</code> çš„æ–¹æ³•å°±è¡Œäº†ï¼Œæ¯”å¦‚åœ¨ <code>onNestedPreScroll</code> æ–¹æ³•ä¸­ï¼Œ</p>
<pre><code class="language-java"> @Override
    public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed, int type) {
     	// æ»‘åŠ¨ dy è·ç¦»
       scrollBy(0, dy);
        // å°†æ¶ˆè€—æ‰çš„ dy æ”¾å…¥ consumed æ•°ç»„é€šçŸ¥å­ view
       consumed[1] = dy;
    }
</code></pre>
<p>è¿™æ ·å°±å®ç°äº†æœ€ç®€å•çš„åµŒå¥—æ»‘åŠ¨ã€‚å½“ç„¶ï¼Œå®é™…æƒ…å†µä¸­ï¼Œè¿˜è¦å¯¹æ»‘åŠ¨è·ç¦»è¿›è¡Œåˆ¤æ–­ï¼Œä¸èƒ½è®©çˆ¶ View ä¸€ç›´æ¶ˆè´¹å­ View çš„ä½ç§»ã€‚</p>
<h5 id="å…³äº-nestedscrollview">å…³äº NestedScrollView</h5>
<p>åƒ <code>NestedScrollView</code> è¿™æ ·çš„ç±»ï¼Œç”±äºå®ƒå†…éƒ¨å®ç°äº† <code>onNestedScroll</code>ï¼Œæ‰€ä»¥åœ¨ä¸‹æ»‘æ—¶ï¼Œå®ƒèƒ½åœ¨å†…éƒ¨çš„ RecyclerView ä¸‹æ»‘ç›´åˆ°åˆ—è¡¨é¡¶ç«¯æ—¶ï¼Œå¤–å±‚ç»§ç»­ä¸‹æ»‘è€Œä¸ç”¨æŠ¬èµ·æ‰‹æŒ‡ã€‚å¦å¤–ä¹Ÿå®ç°äº† <code>onNestedPreScroll</code>æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒåœ¨è¯¥æ–¹æ³•ä¸­æŠŠæ»‘åŠ¨ç»§ç»­å‘ä¸Šä¼ é€’ï¼Œè‡ªå·±æ²¡æœ‰æ¶ˆè´¹ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">// NestedScrollView.java
public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed,
            int type) {
    // åªåˆ†å‘äº† preScroll è‡ªå·±å¹¶æ²¡æœ‰æ¶ˆè´¹ã€‚ä¹‹æ‰€ä»¥èƒ½åˆ†å‘æ˜¯å› ä¸º NestedScrollView åŒæ—¶å®ç°äº† NestedScrollingChild æ¥å£
        dispatchNestedPreScroll(dx, dy, consumed, null, type);
    }

@Override
    public boolean dispatchNestedPreScroll(int dx, int dy, int[] consumed, int[] offsetInWindow,
            int type) {
        return mChildHelper.dispatchNestedPreScroll(dx, dy, consumed, offsetInWindow, type);
    }

// NestedScrollingChildHelper.java
public boolean dispatchNestedPreScroll(int dx, int dy, @Nullable int[] consumed,
            @Nullable int[] offsetInWindow, @NestedScrollType int type) {
        if (isNestedScrollingEnabled()) {
            final ViewParent parent = getNestedScrollingParentForType(type);
            if (parent == null) {
                return false;
            }
            if (dx != 0 || dy != 0) {
                ...
                consumed[0] = 0;
                consumed[1] = 0;
                ViewParentCompat.onNestedPreScroll(parent, mView, dx, dy, consumed, type);
								...
            } 
            ...
        }
        return false;
    }
</code></pre>
<p>æ‰€ä»¥å¦‚æœç›´æ¥åœ¨ RecyclerView çš„å¤–å±‚å¥— <code>NestedScrollView</code> æ˜¯æ²¡æœ‰åŠæ³•å®ç°å®Œæ•´çš„åµŒå¥—æ»‘åŠ¨çš„ï¼Œä½ ä¼šå‘ç°åœ¨ä¸Šæ»‘çš„æ—¶å€™ï¼Œæ²¡æœ‰åµŒå¥—æ»‘åŠ¨çš„æ•ˆæœï¼Œè€Œä¸‹æ»‘çš„æ—¶å€™æœ‰åµŒå¥—æ»‘åŠ¨çš„æ•ˆæœã€‚</p>
<h5 id="æ²¡æœ‰è€ƒè™‘åˆ°çš„é—®é¢˜">æ²¡æœ‰è€ƒè™‘åˆ°çš„é—®é¢˜</h5>
<p>å…¶å®ï¼Œåœ¨ä¹‹å‰æ‰€è¯´çš„å†…å®¹ä¸­ï¼Œé»˜è®¤äº†æ‰‹æŒ‡ä»å­ Viw å¼€å§‹æ»‘åŠ¨ã€‚å‡å¦‚æ‰‹æŒ‡ä»å¤–å±‚çš„çˆ¶ View å¼€å§‹æ»‘åŠ¨ï¼Œå½“çˆ¶ View fling åˆ°é¡¶åï¼Œå­ View æ˜¯æ— æ³•ç»§ç»­ flingï¼Œä¼šç«‹é©¬åœä½ï¼Œæ— æ³•å®ç°è¿è´¯çš„åµŒå¥—æ»‘åŠ¨ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºåµŒå¥—æ»‘åŠ¨ç»„ä»¶ä¸­ï¼Œä½ç§»çš„æ¶ˆè´¹åªèƒ½ä» <code>NestedScrollingChild</code> åˆ° <code>NestedScrollingParent</code>ï¼Œè€Œä¸èƒ½ä» <code>NestedScrollingParent</code> åˆ°  <code>NestedScrollingChild</code> ï¼Œå› ä¸ºåªæœ‰ <code>NestedScrollingChild</code> æ‰èƒ½ dispatchï¼Œ<code>NestedScrollingParent</code> ä¸èƒ½ dispatchã€‚</p>
<p>å¦‚æœæƒ³è¦å®ç°ä» <code>NestedScrollingParent</code> åˆ°  <code>NestedScrollingChild</code>  è¿è´¯çš„æ»‘åŠ¨ï¼Œæš‚æ—¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„åŠæ³•ï¼Œåªèƒ½é‡å†™çˆ¶ View çš„äº‹ä»¶åˆ†å‘ï¼Œå°†çˆ¶ View æ»‘åŠ¨åˆ°é¡¶åå‰©ä½™çš„ä½ç§»æ‰‹åŠ¨åˆ†å‘ç»™å®ƒçš„å­ Viewã€‚(å…ˆæŒ–ä¸ªå‘ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•åµŒå¥—æ»‘åŠ¨ç»„ä»¶è¾¾åˆ°ç›®çš„ï¼‰</p>
<h5 id="tips">Tips</h5>
<p><code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code> ä¸€å…±æœ‰ 3 ä¸ªç‰ˆæœ¬ã€‚</p>
<p>æœ€æ—©çš„æ˜¯ <code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code>ï¼Œè¿™ä¸€å¥—æ¥å£æŠŠ scroll å’Œ fling åˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œé€ æˆäº†ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<p>åæ¥æœ‰äº† <code>NestedScrollingParent2</code> å’Œ <code>NestedScrollingChild2</code> ç»§æ‰¿è‡ªä¸€ä»£ï¼Œä¸è¿‡å®ƒå°† fling è½¬åŒ–ä¸º scroll çš„è·ç¦»ç»Ÿä¸€è¿›è¡Œå¤„ç†ã€‚ä¸Šè¿°çš„åµŒå¥—æ»‘åŠ¨ç»„ä»¶å‡æŒ‡äºŒä»£ã€‚</p>
<p>å†åæ¥åˆæœ‰äº† <code>NestedScrollingParent3</code> å’Œ <code>NestedScrollingChild</code> ç»§æ‰¿è‡ªäºŒä»£ï¼Œå®ƒä»¬ç›¸æ¯”äº 2 ä»£å¢åŠ äº† <code>dispatchNestedScroll</code> å’Œ <code>onNestedScroll</code> æ¶ˆè€—éƒ¨åˆ†æ»‘åŠ¨ä½ç§»çš„åŠŸèƒ½ï¼Œå³åœ¨çˆ¶ View æ¶ˆè€—ä½ç§»ä¹‹åï¼Œå°†æ¶ˆè€—å€¼æ”¾å…¥ <code>consumed</code> æ•°ç»„é€šçŸ¥å­ Viewã€‚è€ŒäºŒä»£æ˜¯ä¸ä¼šè®©å­ View çŸ¥é“çˆ¶ View çš„æ¶ˆè€—å€¼çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¦è‡ªå·±å®ç°åµŒå¥—æ»‘åŠ¨ï¼Œåªéœ€è¦å®ç° 2 ä»£åŠä»¥ä¸Šæ¥å£å³å¯ã€‚ä¸€ä»£åŸºæœ¬ä¸å†ä½¿ç”¨ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨ <code>NestedScrollView</code> æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œå½“å®ƒçš„å­ View æ˜¯ RecyclerView è¿™ç§ content å¯ä»¥æ— é™é•¿çš„å¸ƒå±€æ—¶ï¼Œè¦æ³¨æ„é™åˆ¶è¿™äº›å­ View çš„é«˜åº¦ï¼Œä¸è¦ä½¿ç”¨ <code>wrap_content</code> è®¾ç½® RecyclerView çš„é«˜åº¦ã€‚å› ä¸º <code>NestedScrollView</code> åœ¨æµ‹é‡æ—¶ç»™å­ View çš„é™åˆ¶æ˜¯ <code>UNSPECIFIED</code>  ï¼Œå³ä¸åšé™åˆ¶ï¼ŒRecyclerView æƒ³è¦å¤šé«˜å°±æœ‰å¤šé«˜ã€‚åƒ RecyclerView å¦‚æœå†…éƒ¨ item æ•°é‡å¤ªå¤šï¼ŒRecyclerView åœ¨ <code>wrap_content</code> çš„æƒ…å†µä¸‹ä¼šæŠŠæ‰€æœ‰ item éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œç›¸å½“äºæ²¡æœ‰å›æ”¶ã€‚è¿™æ ·ä¼šå¯¹å†…å­˜é€ æˆå¾ˆå¤§æ¶ˆè€—ã€‚å¦‚æœè°ƒç”¨ <code>setVisibility</code> æ”¹å˜å¯è§æ€§çš„è¯ï¼Œå½“ä»ä¸å¯è§åˆ°å¯è§ï¼Œæ›´æ˜¯ä¼šç¬é—´è°ƒç”¨æ‰€æœ‰ item çš„æµ‹é‡å¸ƒå±€æµç¨‹ï¼Œé€ æˆå¡é¡¿ã€‚è¿™æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­å®é™…é‡åˆ°çš„é—®é¢˜ã€‚</p>
<h3 id="ä¸‰-å¤šçº§åµŒå¥—æ»‘åŠ¨">ä¸‰ã€å¤šçº§åµŒå¥—æ»‘åŠ¨</h3>
<p>æˆ‘ä»¬çŸ¥é“äº† <code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code>å¯ä»¥ç”¨æ¥å®šåˆ¶åŒ–åœ°å®ç°è‡ªå·±åœ°åµŒå¥—æ»‘åŠ¨ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¦‚æœä¸€ä¸ª View åŒæ—¶å®ç°äº†ä¸¤ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå®ƒæ—¢å¯ä»¥æ¥å— child çš„æ»‘åŠ¨ï¼Œåˆå¯ä»¥åˆ†å‘æ»‘åŠ¨ç»™ parentï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªé“¾æ¡ã€‚è€Œå¤šçº§åµŒå¥—æ»‘åŠ¨çš„æ ¸å¿ƒåŸç†å°±æ¥è‡ªäºæ­¤ï¼Œå¦‚å›¾ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04651fef68e34951bc4bff6c90c11103~tplv-k3u1fbpfcp-watermark.image" alt="image-20210304170155409.png" loading="lazy"></figure>
<p>åŸç†å…¶å®å¹¶ä¸å¤æ‚ï¼Œä¸‹é¢ç”¨ä¼ªä»£ç è¡¨ç¤ºä¸€ä¸‹ï¼š</p>
<ul>
<li>
<p>å¯¹äº <code>NestedScrollingParent</code></p>
<pre><code> @Override
    public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed, int type) {
       scrollByMe(dx, dy);
       ...
       consumed[0] = dxConsumed;
       consumed[1] = dyConsumed;
    }
</code></pre>
</li>
<li>
<p>å¯¹äºä¸­ä»‹è€…ï¼Œå³åŒæ—¶å®ç°äº† <code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code> çš„ä¸­é—´ View æ¥è¯´</p>
<pre><code class="language-java"> @Override
    public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int[] consumed, int type) {
        // å…ˆåˆ†å‘ï¼Œå†æ¶ˆè´¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å…ˆä»¥å…ˆæ¶ˆè´¹ï¼Œå†åˆ†å‘ï¼Œè¿™å–å†³äºä¸šåŠ¡
       dispatchNestedPreScroll(dispatchNestedPreScroll(dx, dy, consumed, null, type);
	   	 int dx -= consumed[0];
       int dy -= consumed[1];
       scrollByMe(dx, dy);
       consumed[0] = dxConsumed;
       consumed[1] = dyConsumed;
    }
</code></pre>
</li>
<li>
<p>å¯¹äºæœ€å†…å±‚çš„ <code>NestedScrollingChild</code>ï¼Œä¸€èˆ¬ä½¿ç”¨ RecyclerView å°±å¯ä»¥ã€‚<br>
åœ¨å¤šçº§åµŒå¥—æ»‘åŠ¨ä¸­ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡è‡ªå·±è®¾ç½®å„å±‚åœ¨ä¸Šæ»‘ä¸ä¸‹æ»‘è¿‡ç¨‹ä¸­çš„ä¼˜å…ˆçº§ã€‚</p>
</li>
</ul>
<p>å·¥ä½œçš„é¡¹ç›®å› ä¸ºè¿˜æ²¡å‘å¸ƒå°±ä¸æ”¾ä¸Šæ¥äº†ï¼Œè¿™é‡Œä¸Šä¸€ä¸ªä»ç½‘ä¸Šæ‰¾åˆ°çš„å³åˆ» App å¤šçº§åµŒå¥—æ»‘åŠ¨çš„å›¾ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd9239d5d70545bd830d304e88e4af0a~tplv-k3u1fbpfcp-watermark.image" alt="3b1169d0-23cd-11eb-a910-368fe856f9f2.gif" loading="lazy"></figure>
<p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://zhuanlan.zhihu.com/p/56582475</p>
<h3 id="å››-åµŒå¥—æ»‘åŠ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼">å››ã€åµŒå¥—æ»‘åŠ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼</h3>
<p>ä½œä¸ºæ€»ç»“ï¼Œè®¨è®ºä¸€ä¸‹ã€‚</p>
<ul>
<li>
<p><strong>ç­–ç•¥æ¨¡å¼</strong></p>
<p><code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code>æ˜¯ä¸€å¯¹æ¥å£ï¼Œä¸åŒçš„ View é€šè¿‡å®ç°è¿™å¯¹æ¥å£æ¥è¾¾åˆ°ä¸åŒçš„åµŒå¥—æ»‘åŠ¨æ•ˆæœã€‚åŒæ—¶ä½¿ç”¨æ¥å£ä¹Ÿä¿è¯äº†æ‰©å±•æ€§ã€‚</p>
</li>
<li>
<p><strong>ä»£ç†æ¨¡å¼</strong></p>
<p>å¦‚å‰è¿°ï¼Œå½“ä¸€ä¸ª View å®ç°åµŒå¥—æ»‘åŠ¨æ¥å£ä¸­çš„æ–¹æ³•æ—¶ï¼Œæ»‘åŠ¨çš„å…·ä½“ä¼ é€’éƒ½äº¤ç»™äº†ä»£ç†çš„ <code>NestedScrollingParentHelper</code> å’Œ <code>NestedScrollingChildHelper</code>æ¥å®ç°ï¼Œè¿™ä¸¤ä¸ªç±»æ˜¯ç”± sdk æä¾›çš„ï¼Œåœ¨ <code>NestedScrollingParent</code> å’Œ <code>NestedScrollingChild</code> æ¥å£ä¸­æœ‰å¦‚ä¸‹è¯´æ˜ï¼š</p>
<pre><code class="language-java">This interface should be implemented by ViewGroup subclasses
that wish to support scrolling operations delegated by a nested child view.
Classes implementing this interface should create a final instance of a
NestedScrollingParentHelper as a field and delegate any View or ViewGroup methods
to the NestedScrollingParentHelper methods of the same signature.
</code></pre>
</li>
<li>
<p><strong>é€‚é…å™¨æ¨¡å¼ / å¤–è§‚æ¨¡å¼</strong></p>
<p>RecyclerView å®ç°äº† <code>NestedScrollingChild2</code> æ¥å£ï¼Œä½†æ˜¯å¦‚æœå®ƒçš„çˆ¶ view å®ç°çš„æ˜¯ä¸€ä»£çš„ <code>NestedScrollingParent</code> æ¥å£æ€ä¹ˆåŠï¼Ÿè¿™å°±ä¸åŒç‰ˆæœ¬çš„åµŒå¥—æ»‘åŠ¨ç»„ä»¶éœ€è¦å…¼å®¹ã€‚æ€æ ·å®ç°å…¼å®¹å‘¢ï¼Œä½¿ç”¨ <code>ViewCompat</code> ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// ViewCompat.java
public static void onNestedPreScroll(ViewParent parent, View target, int dx, int dy,
            int[] consumed, int type) {
        if (parent instanceof NestedScrollingParent2) {
            // First try the NestedScrollingParent2 API
            ((NestedScrollingParent2) parent).onNestedPreScroll(target, dx, dy, consumed, type);
        } else if (type == ViewCompat.TYPE_TOUCH) {
            // Else if the type is the default (touch), try the NestedScrollingParent API
            if (Build.VERSION.SDK_INT &gt;= 21) {
                try {
                    parent.onNestedPreScroll(target, dx, dy, consumed);
                } catch (AbstractMethodError e) {
                    Log.e(TAG, &quot;ViewParent &quot; + parent + &quot; does not implement interface &quot;
                            + &quot;method onNestedPreScroll&quot;, e);
                }
            } else if (parent instanceof NestedScrollingParent) {
                ((NestedScrollingParent) parent).onNestedPreScroll(target, dx, dy, consumed);
            }
        }
    }
</code></pre>
<p>æ‰€æœ‰çš„ child çš„æ»‘åŠ¨åˆ†å‘ï¼Œéƒ½ä¼šé€šè¿‡ <code>ViewCompat</code> çš„é™æ€æ–¹æ³•æœ€ç»ˆå†ä¼ é€’ç»™ parentï¼Œé€šè¿‡è¿™ä¸ªç±»ä»¥åŠé™æ€æ–¹æ³•ï¼Œè¾¾åˆ°äº†ä¸åŒç‰ˆæœ¬åµŒå¥—æ»‘åŠ¨ç»„ä»¶çš„å…¼å®¹ã€‚åŒæ—¶ï¼Œ <code>ViewCompat</code> å¯¹å¤–æš´éœ²äº†æ˜“ç”¨çš„æ¥å£ï¼Œè€ŒæŠŠå…¼å®¹çš„è¿‡ç¨‹éšè—åœ¨äº†è‡ªå·±å†…éƒ¨ï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§å¤–è§‚æ¨¡å¼ã€‚</p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€æ–‡è¯»æ‡‚ kotlin çš„åå˜ä¸é€†å˜ -- ä» Java è¯´èµ·]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/yi-wen-du-dong-kotlin-de-xie-bian-yu-ni-bian-cong-java-shuo-qi/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/yi-wen-du-dong-kotlin-de-xie-bian-yu-ni-bian-cong-java-shuo-qi/">
        </link>
        <updated>2020-10-10T12:50:59.000Z</updated>
        <content type="html"><![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ kotlin å’Œ Java ä¸­çš„åå˜ä¸é€†å˜ï¼Œå…ˆçœ‹ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p>
<h4 id="æ™®é€šèµ‹å€¼">æ™®é€šèµ‹å€¼</h4>
<p>åœ¨ Java ä¸­ï¼Œå¸¸è§çš„èµ‹å€¼è¯­å¥å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">A a = b;
</code></pre>
<p>èµ‹å€¼è¯­å¥å¿…é¡»æ»¡è¶³çš„æ¡ä»¶æ˜¯ï¼šå·¦è¾¹è¦ä¹ˆæ˜¯å³è¾¹çš„çˆ¶ç±»ï¼Œè¦ä¹ˆå’Œå³è¾¹ç±»å‹ä¸€æ ·ã€‚å³ A çš„ç±»å‹è¦â€œå¤§äºâ€B çš„ç±»å‹ï¼Œæ¯”å¦‚ <code>Object o = new String(&quot;s&quot;);</code> ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œä¸‹æ–‡ä¸­ç§°ä½œ A &gt; Bã€‚</p>
<p>é™¤äº†ä¸Šè¿°æœ€å¸¸è§çš„èµ‹å€¼è¯­å¥ï¼Œè¿˜æœ‰ä¸¤ç§å…¶ä»–çš„èµ‹å€¼è¯­å¥ï¼š</p>
<h4 id="å‡½æ•°å‚æ•°çš„èµ‹å€¼">å‡½æ•°å‚æ•°çš„èµ‹å€¼</h4>
<pre><code class="language-java">public void fun(A a) {}
// è°ƒç”¨å¤„èµ‹å€¼
B b = new B();
fun(b);
</code></pre>
<p>åœ¨è°ƒç”¨ fun(b) æ–¹æ³•æ—¶ï¼Œä¼šå°†ä¼ å…¥çš„ B b å®å‚èµ‹å€¼ç»™å½¢å‚ A aï¼Œå³ <code>A a = b</code> çš„å½¢å¼ã€‚åŒæ ·çš„ï¼Œå¿…é¡»è¦æ»¡è¶³å½¢å‚ç±»å‹å¤§äºå®å‚ï¼Œå³ A &gt; Bã€‚</p>
<h4 id="å‡½æ•°è¿”å›å€¼çš„èµ‹å€¼">å‡½æ•°è¿”å›å€¼çš„èµ‹å€¼</h4>
<pre><code class="language-java">public A fun() {
    B b = new B();
    return b;
} 
</code></pre>
<p>å‡½æ•°è¿”å›å€¼ç±»å‹æ¥æ”¶å®é™…è¿”å›ç±»å‹çš„å€¼ï¼Œå®é™…è¿”å›ç±»å‹ B b ç›¸å½“äºèµ‹å€¼ç»™äº†å‡½æ•°è¿”å›å€¼ç±»å‹ A aï¼Œå³ B b èµ‹å€¼ç»™äº† A a, å³ <code>A a = b</code>ï¼Œé‚£ä¹ˆå¿…é¡»æ»¡è¶³ A &gt; B çš„ç±»å‹å…³ç³»ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ— è®ºå“ªç§èµ‹å€¼ï¼Œéƒ½å¿…é¡»æ»¡è¶³å·¦è¾¹ç±»å‹ &gt; å³è¾¹ç±»å‹ï¼Œå³ A &gt; Bã€‚</p>
<h3 id="java-ä¸­çš„åå˜ä¸é€†å˜">Java ä¸­çš„åå˜ä¸é€†å˜</h3>
<p>æœ‰äº†å‰é¢çš„åŸºç¡€çŸ¥è¯†ï¼Œå°±å¯ä»¥æ–¹ä¾¿åœ°è§£é‡Šåå˜ä¸é€†å˜äº†ã€‚</p>
<p>å¦‚æœç±» A &gt; ç±» Bï¼Œç»è¿‡ä¸€ä¸ªå˜åŒ– trans åå¾—åˆ°çš„ trans(A) ä¸ trans(B) ä¾æ—§æ»¡è¶³ trans(A) &gt; trans(B)ï¼Œé‚£ä¹ˆç§°ä¸º<strong>åå˜</strong>ã€‚</p>
<p>é€†å˜åˆ™åˆšå¥½ç›¸åï¼Œå¦‚æœç±» A &gt; ç±» Bï¼Œç»è¿‡ä¸€ä¸ªå˜åŒ– trans åå¾—åˆ°çš„ trans(A) ä¸ trans(B) æ»¡è¶³ trans(B) &gt; trans(A)ï¼Œç§°ä¸º<strong>é€†å˜</strong>ã€‚</p>
<p>æ¯”å¦‚å¤§å®¶éƒ½çŸ¥é“ Java çš„æ•°ç»„æ˜¯åå˜çš„ï¼Œå‡å¦‚ A &gt; Bï¼Œé‚£ä¹ˆæœ‰ A[] &gt; B[]ï¼Œæ‰€ä»¥ B[] å¯ä»¥èµ‹å€¼ç»™ A[]ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java">Integer[] nums = new Integer[]{};
Object[] o = nums; // å¯ä»¥èµ‹å€¼ï¼Œå› ä¸ºæ•°ç»„çš„åå˜ç‰¹æ€§æ‰€ä»¥ç”± Object &gt; Integer å¾—åˆ° Object[] &gt; Integer[]
</code></pre>
<p>ä½†æ˜¯ Java çš„æ³›å‹åˆ™ä¸æ»¡è¶³åå˜ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">List&lt;Integer&gt; l = new ArrayList&lt;&gt;();
List&lt;Object&gt; o = l;// è¿™é‡Œä¼šæŠ¥é”™ï¼Œä¸èƒ½ç¼–è¯‘
</code></pre>
<p>ä¸Šè¿°ä»£ç æŠ¥é”™ï¼Œå°±æ˜¯å› ä¸ºï¼Œè™½ç„¶ Object &gt; Integerï¼Œä½†æ˜¯ç”±äºæ³›å‹ä¸æ»¡è¶³åå˜ï¼Œæ‰€ä»¥ <code>List&lt;Object&gt;</code> &gt; <code>List&lt;Integer&gt;</code> æ˜¯ä¸æ»¡è¶³çš„ï¼Œæ—¢ç„¶ä¸æ»¡è¶³å·¦è¾¹å¤§äºå³è¾¹è¿™ä¸ªæ¡ä»¶ï¼Œä»å‰è¨€ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œè‡ªç„¶å°±ä¸èƒ½å°† List&lt;Integer&gt; èµ‹å€¼ç»™ List&lt;Object&gt;ã€‚ä¸€èˆ¬ç§° Java æ³›å‹ä¸æ”¯æŒå‹å˜ã€‚</p>
<h3 id="java-ä¸­æ³›å‹å¦‚ä½•å®ç°åå˜ä¸é€†å˜">Java ä¸­æ³›å‹å¦‚ä½•å®ç°åå˜ä¸é€†å˜</h3>
<p>ä»å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Java ä¸­æ³›å‹æ˜¯ä¸æ”¯æŒå‹å˜çš„ï¼Œä½†æ˜¯è¿™ä¼šäº§ç”Ÿä¸€ä¸ªè®©äººå¾ˆå¥‡æ€ªçš„ç–‘æƒ‘ï¼Œä¹Ÿæ˜¯å¾ˆå¤šè®²æ³›å‹çš„æ–‡ç« ä¸­æåˆ°çš„ï¼š</p>
<p>å¦‚æœ B æ˜¯ A çš„å­ç±»ï¼Œé‚£ä¹ˆ List&lt;B&gt; å°±åº”è¯¥æ˜¯ List&lt;A&gt; çš„å­ç±»å‘€ï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸è‡ªç„¶è€Œç„¶çš„æƒ³æ³•ï¼</p>
<p>ä½†æ˜¯å¾ˆæŠ±æ­‰ï¼Œç”±äºç§ç§åŸå› ï¼ŒJava å¹¶ä¸æ”¯æŒã€‚ä½†æ˜¯ï¼ŒJava å¹¶ä¸æ˜¯å®Œå…¨æŠ¹æ€äº†æ³›å‹çš„å‹å˜ç‰¹æ€§ï¼ŒJava æä¾›äº† &lt;? extends T&gt; å’Œ &lt;? super T&gt; ä½¿æ³›å‹æ‹¥æœ‰åå˜å’Œé€†å˜çš„ç‰¹æ€§ã€‚</p>
<h4 id="extends-t-ä¸-super-t">&lt;? extends T&gt; ä¸ &lt;? super T&gt;</h4>
<p>&lt;? extends T&gt; ç§°ä¸ºä¸Šç•Œé€šé…ç¬¦ï¼Œ&lt;? super T&gt; ç§°ä¸ºä¸‹ç•Œé€šé…ç¬¦ã€‚ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦å¯ä»¥ä½¿æ³›å‹åå˜ï¼Œè€Œä½¿ç”¨ä¸‹ç•Œé€šé…ç¬¦å¯ä»¥ä½¿æ³›å‹é€†å˜ã€‚</p>
<p>æ¯”å¦‚ä¹‹å‰ä¸¾çš„ä¾‹å­</p>
<pre><code class="language-java">List&lt;Integer&gt; l = new ArrayList&lt;&gt;();
List&lt;Object&gt; o = l;// è¿™é‡Œä¼šæŠ¥é”™ï¼Œä¸èƒ½ç¼–è¯‘
</code></pre>
<p>å¦‚æœä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦ï¼Œ</p>
<pre><code class="language-java">List&lt;Integer&gt; l = new ArrayList&lt;&gt;();
List&lt;? extends Object&gt; o = l;// å¯ä»¥é€šè¿‡ç¼–è¯‘
</code></pre>
<p>è¿™æ ·ï¼ŒList&lt;? extends Object&gt; çš„ç±»å‹å°±å¤§äº List&lt;Integer&gt; çš„ç±»å‹äº†ï¼Œä¹Ÿå°±å®ç°äº†åå˜ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œå­ç±»çš„æ³›å‹æ˜¯æ³›å‹çš„å­ç±»â€ã€‚</p>
<p>åŒæ ·ï¼Œä¸‹ç•Œé€šé…ç¬¦ &lt;? super T&gt; å¯ä»¥å®ç°é€†å˜ï¼Œå¦‚ï¼š</p>
<pre><code class="language-java">public List&lt;? super Integer&gt; fun(){
    List&lt;Object&gt; l = new ArrayList&lt;&gt;();
    return l;
}
</code></pre>
<p>ä¸Šè¿°ä»£ç æ€ä¹ˆå°±å®ç°é€†å˜äº†å‘¢ï¼Ÿé¦–å…ˆï¼ŒObject &gt; Integerï¼›å¦å¤–ï¼Œä»å‰è¨€æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°è¿”å›å€¼ç±»å‹å¿…é¡»å¤§äºå®é™…è¿”å›å€¼ç±»å‹ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ <code>List&lt;? super Integer&gt;</code> &gt; <code>List&lt;Object&gt;</code>ï¼Œå’Œ Object &gt; Integer åˆšå¥½ç›¸åã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»è¿‡æ³›å‹å˜åŒ–åï¼ŒObject å’Œ Integer çš„ç±»å‹å…³ç³»ç¿»è½¬äº†ï¼Œè¿™å°±æ˜¯é€†å˜ï¼Œè€Œå®ç°é€†å˜çš„å°±æ˜¯ä¸‹ç•Œé€šé…ç¬¦ &lt;? super T&gt;ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ&lt;? extends T&gt; ä¸­çš„ä¸Šç•Œæ˜¯ Tï¼Œä¹Ÿå°±æ˜¯è¯´ &lt;? extends T&gt; æ‰€æ³›æŒ‡çš„ç±»å‹éƒ½æ˜¯ T çš„å­ç±»æˆ– T æœ¬èº«ï¼Œæ‰€ä»¥ T å¤§äº &lt;? extends T&gt; ã€‚&lt;? super T&gt; ä¸­çš„ä¸‹ç•Œæ˜¯ Tï¼Œä¹Ÿå°±æ˜¯è¯´ &lt;? super T&gt; æ‰€æ³›æŒ‡çš„ç±»å‹éƒ½æ˜¯ T çš„çˆ¶ç±»æˆ– T æœ¬èº«ï¼Œæ‰€ä»¥ &lt;? super T&gt;  å¤§äº Tã€‚</p>
<p>è™½ç„¶ Java ä½¿ç”¨é€šé…ç¬¦è§£å†³äº†æ³›å‹çš„åå˜ä¸é€†å˜çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºå¾ˆå¤šè®²åˆ°æ³›å‹çš„æ–‡ç« éƒ½æ™¦æ¶©éš¾æ‡‚ï¼Œæ›¾ç»è®©æˆ‘ä¸€åº¦æ„Ÿæ…¨è¿™ tm åˆ°åº•æ˜¯ä»€ä¹ˆç©æ„ï¼Ÿç›´åˆ°æˆ‘åœ¨ stackoverflow ä¸Šå‘ç°äº†é€šä¿—æ˜“æ‡‚çš„è§£é‡Š(æ˜¯çš„ï¼Œå‰æ–‡å¤§éƒ¨åˆ†å†…å®¹éƒ½æ¥è‡ªäº stackoverflow ä¸­å¤§ç¥çš„è§£é‡Š)ï¼Œæ‰ç»ˆäºäº†ç„¶ã€‚å…¶å®åªè¦æŠ“ä½<strong>èµ‹å€¼è¯­å¥å·¦è¾¹ç±»å‹å¿…é¡»å¤§äºå³è¾¹ç±»å‹</strong>è¿™ä¸ªå…³é”®ç‚¹ä¸€åˆ‡å°±éƒ½å¾ˆå¥½æ‡‚äº†ã€‚</p>
<h4 id="pecs">PECS</h4>
<p>PECS å‡†åˆ™å³ Producer Extends Consumer Superï¼Œç”Ÿäº§è€…ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ä¸‹ç•Œé€šé…ç¬¦ã€‚ç›´æ¥çœ‹è¿™å¥è¯å¯èƒ½ä¼šè®©äººå¾ˆç–‘æƒ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿½æœ¬æº¯æºæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šæœ‰è¿™å¥è¯ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„æ³›å‹ç±»ï¼š</p>
<pre><code class="language-java">public class Container&lt;T&gt; {
    private T item;

    public void set(T t) { 
        item = t;
    }

    public T get() {
        return item;
    }
}
</code></pre>
<p>ç„¶åå†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">Container&lt;Object&gt; c = new Container&lt;String&gt;(); // (1)ç¼–è¯‘æŠ¥é”™

Container&lt;? extends Object&gt; c = new Container&lt;String&gt;(); // (2)ç¼–è¯‘é€šè¿‡
c.set(&quot;sss&quot;); // (3)ç¼–è¯‘æŠ¥é”™
Object o = c.get();// (4)ç¼–è¯‘é€šè¿‡
</code></pre>
<p>ä»£ç  (1)ï¼Œ<code>Container&lt;Object&gt; c = new Container&lt;String&gt;();</code> ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºæ³›å‹æ˜¯ä¸å‹å˜çš„ï¼Œæ‰€ä»¥ Container&lt;String&gt; å¹¶ä¸æ˜¯ Container&lt;Object&gt; çš„å­ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•èµ‹å€¼ã€‚</p>
<p>ä»£ç  (2)ï¼ŒåŠ äº†ä¸Šç•Œé€šé…ç¬¦ä»¥åï¼Œæ”¯æŒæ³›å‹åå˜ï¼ŒContainer&lt;String&gt; å°±æˆäº† Container&lt;? extends Object&gt; çš„å­ç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘é€šè¿‡ï¼Œå¯ä»¥èµ‹å€¼ã€‚</p>
<p>æ—¢ç„¶ä»£ç  (2) é€šè¿‡ç¼–è¯‘ï¼Œé‚£ä»£ç  (3) ä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿå› ä¸ºä»£ç  (3) å°è¯•æŠŠ String ç±»å‹èµ‹å€¼ç»™ &lt;? extends Object&gt; ç±»å‹ã€‚æ˜¾ç„¶ï¼Œç¼–è¯‘å™¨åªçŸ¥é“ &lt;? extends Object&gt;  æ˜¯ Obejct çš„æŸä¸€ä¸ªå­ç±»å‹ï¼Œä½†æ˜¯å…·ä½“æ˜¯å“ªä¸€ä¸ªå¹¶ä¸çŸ¥é“ï¼Œä¹Ÿè®¸å¹¶ä¸æ˜¯ String ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å°† String ç±»å‹èµ‹å€¼ç»™å®ƒã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºä½¿ç”¨äº† &lt;? extends T&gt; çš„ç±»å‹ï¼Œæ˜¯ä¸èƒ½å†™å…¥å…ƒç´ çš„ï¼Œä¸ç„¶å°±ä¼šåƒä»£ç  (3) å¤„ä¸€æ ·ç¼–è¯‘æŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯å¯ä»¥è¯»å–å…ƒç´ ï¼Œæ¯”å¦‚ä»£ç  (4) ã€‚å¹¶ä¸”è¯¥ç±»å‹åªèƒ½è¯»å–å…ƒç´ ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œç”Ÿäº§è€…â€ï¼Œå³<strong>åªèƒ½ä»ä¸­è¯»å–å…ƒç´ çš„å°±æ˜¯ç”Ÿäº§è€…</strong>ï¼Œç”Ÿäº§è€…å°±ä½¿ç”¨ &lt;? extends T&gt; é€šé…ç¬¦ã€‚</p>
<p>æ¶ˆè´¹è€…åŒç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">Container&lt;String&gt; c = new Container&lt;Object&gt;(); // (1)ç¼–è¯‘æŠ¥é”™

Container&lt;? super String&gt; c = new Container&lt;Object&gt;(); // (2)ç¼–è¯‘é€šè¿‡
 c.set(&quot;sss&quot;);// (3) ç¼–è¯‘é€šè¿‡
 String s = c.get();// (4) ç¼–è¯‘æŠ¥é”™

</code></pre>
<p>ä»£ç  (1) ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºæ³›å‹ä¸æ”¯æŒé€†å˜ã€‚è€Œä¸”å°±ç®—ä¸æ‡‚æ³›å‹ï¼Œè¿™ä¸ªä»£ç çš„å½¢å¼ä¸€çœ¼çœ‹èµ·æ¥ä¹Ÿæ˜¯é”™çš„ã€‚</p>
<p>ä»£ç  (2) ç¼–è¯‘é€šè¿‡ï¼Œå› ä¸ºåŠ äº† &lt;? super T&gt; é€šé…ç¬¦åï¼Œæ³›å‹é€†å˜ã€‚</p>
<p>ä»£ç  (3) ç¼–è¯‘é€šè¿‡ï¼Œå®ƒæŠŠ String ç±»å‹èµ‹å€¼ç»™ &lt;? super String&gt;ï¼Œ&lt;? super String&gt; æ³›æŒ‡ String çš„çˆ¶ç±»æˆ– Stringï¼Œæ‰€ä»¥è¿™æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ã€‚</p>
<p>ä»£ç  (4) ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºå®ƒå°è¯•æŠŠ &lt;? super String&gt; èµ‹å€¼ç»™ Stringï¼Œè€Œ &lt;? super String&gt; å¤§äº Stringï¼Œæ‰€ä»¥ä¸èƒ½èµ‹å€¼ã€‚äº‹å®ä¸Šï¼Œç¼–è¯‘å™¨å®Œå…¨ä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆç±»å‹å»æ¥å— <code>c.get()</code> çš„è¿”å›å€¼ï¼Œå› ä¸ºåœ¨ç¼–è¯‘å™¨çœ¼é‡Œ &lt;? super String&gt; æ˜¯ä¸€ä¸ªæ³›æŒ‡çš„ç±»å‹ï¼Œæ‰€æœ‰ String çš„çˆ¶ç±»å’Œ String æœ¬èº«éƒ½æœ‰å¯èƒ½ã€‚</p>
<p>åŒæ ·ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºä½¿ç”¨äº† &lt;? super T&gt; çš„ç±»å‹ï¼Œæ˜¯ä¸èƒ½è¯»å–å…ƒç´ çš„ï¼Œä¸ç„¶å°±ä¼šåƒä»£ç  (4) å¤„ä¸€æ ·ç¼–è¯‘æŠ¥é”™ã€‚ä½†æ˜¯å¯ä»¥å†™å…¥å…ƒç´ ï¼Œæ¯”å¦‚ä»£ç  (3)ã€‚è¯¥ç±»å‹åªèƒ½å†™å…¥å…ƒç´ ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ¶ˆè´¹è€…â€ï¼Œå³<strong>åªèƒ½å†™å…¥å…ƒç´ çš„å°±æ˜¯æ¶ˆè´¹è€…</strong>ï¼Œæ¶ˆè´¹è€…å°±ä½¿ç”¨ &lt;? super T&gt; é€šé…ç¬¦ã€‚</p>
<p>ç»¼ä¸Šï¼Œè¿™å°±æ˜¯ PECS åŸåˆ™ã€‚</p>
<h3 id="kotlin-ä¸­çš„åå˜ä¸é€†å˜">kotlin ä¸­çš„åå˜ä¸é€†å˜</h3>
<p>kotlin æŠ›å¼ƒäº† Java ä¸­çš„é€šé…ç¬¦ï¼Œè½¬è€Œä½¿ç”¨äº†<strong>å£°æ˜å¤„å‹å˜</strong>ä¸<strong>ç±»å‹æŠ•å½±</strong>ã€‚</p>
<h4 id="å£°æ˜å¤„å‹å˜">å£°æ˜å¤„å‹å˜</h4>
<p>é¦–å…ˆè®©æˆ‘ä»¬å›å¤´çœ‹çœ‹ Container çš„å®šä¹‰ï¼š</p>
<pre><code class="language-java">public class Container&lt;T&gt; {
    private T item;

    public void set(T t) { 
        item = t;
    }

    public T get() {
        return item;
    }
}
</code></pre>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªä¼šä½¿ç”¨ <code>Container&lt;? extends T&gt;</code> æˆ–è€… <code>Container&lt;? super T&gt;</code> ï¼Œæ„å‘³ç€æˆ‘ä»¬åªä½¿ç”¨ Container ä½œä¸ºç”Ÿäº§è€…æˆ–è€… Container ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åœ¨å®šä¹‰ Container è¿™ä¸ªç±»çš„æ—¶å€™è¦æŠŠ get å’Œ set éƒ½å®šä¹‰å¥½å‘¢ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªç±»åªæœ‰æ¶ˆè´¹è€…çš„ä½œç”¨ï¼Œé‚£å®šä¹‰ get æ–¹æ³•å®Œå…¨æ˜¯å¤šä½™çš„ã€‚</p>
<p>åè¿‡æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªæ³›å‹ç±»åªæœ‰ç”Ÿäº§è€…æ–¹æ³•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼ˆæ¥è‡ª kotlin å®˜æ–¹æ–‡æ¡£ï¼‰:</p>
<pre><code class="language-kotlin">// Java
interface Source&lt;T&gt; {
  T nextT(); // åªæœ‰ç”Ÿäº§è€…æ–¹æ³•
}
// Java
void demo(Source&lt;String&gt; strs) {
  Source&lt;Object&gt; objects = strs; // ï¼ï¼ï¼åœ¨ Java ä¸­ä¸å…è®¸ï¼Œè¦ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦ &lt;? extends Object&gt;
  // â€¦â€¦
}
</code></pre>
<p>åœ¨ <code>Source&lt;Object&gt;</code> ç±»å‹çš„å˜é‡ä¸­å­˜å‚¨ <code>Source&lt;String&gt;</code> å®ä¾‹çš„å¼•ç”¨æ˜¯æä¸ºå®‰å…¨çš„â€”â€”å› ä¸ºæ²¡æœ‰æ¶ˆè´¹è€…-æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚ç„¶è€Œ Java ä¾ç„¶ä¸è®©æˆ‘ä»¬ç›´æ¥èµ‹å€¼ï¼Œéœ€è¦ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦ã€‚</p>
<p>ä½†æ˜¯è¿™æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œä½¿ç”¨é€šé…ç¬¦åªæ˜¯æŠŠç±»å‹å˜å¾—æ›´å¤æ‚ï¼Œå¹¶æ²¡æœ‰å¸¦æ¥é¢å¤–çš„ä»·å€¼ï¼Œå› ä¸ºèƒ½è°ƒç”¨çš„æ–¹æ³•è¿˜æ˜¯åªæœ‰ç”Ÿäº§è€…æ–¹æ³•ã€‚ä½† Java ç¼–è¯‘å™¨åªè®¤æ­»ç†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨ä½¿ç”¨ä¹‹å‰ç¡®å®šä¸€ä¸ªç±»æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œé‚£åœ¨å®šä¹‰ç±»çš„æ—¶å€™ç›´æ¥å£°æ˜å®ƒçš„è§’è‰²å²‚ä¸ç¾å“‰ï¼Ÿ</p>
<p>è¿™å°±æ˜¯ kotlin çš„å£°æ˜å¤„å‹å˜ï¼Œç›´æ¥åœ¨ç±»å£°æ˜çš„æ—¶å€™ï¼Œå®šä¹‰å®ƒçš„å‹å˜è¡Œä¸ºã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-java">class Container&lt;out T&gt; { // (1)
    private  var item: T? = null 
        
    fun get(): T? = item
}

val c: Container&lt;Any&gt; = Container&lt;String&gt;()// ï¼ˆ2ï¼‰ç¼–è¯‘é€šè¿‡ï¼Œå› ä¸º T æ˜¯ä¸€ä¸ª out-å‚æ•°
</code></pre>
<p>(1) å¤„ç›´æ¥ä½¿ç”¨ &lt;out T&gt; æŒ‡å®š T ç±»å‹åªèƒ½å‡ºç°åœ¨ç”Ÿäº§è€…çš„ä½ç½®ä¸Šã€‚è™½ç„¶å¤šäº†ä¸€äº›é™åˆ¶ï¼Œä½†æ˜¯ï¼Œåœ¨ kotlin ç¼–è¯‘å™¨åœ¨çŸ¥é“äº† T çš„è§’è‰²ä»¥åï¼Œå°±å¯ä»¥åƒ (2) å¤„ä¸€æ ·å°† Container&lt;String&gt; ç›´æ¥èµ‹å€¼ç»™ Container&lt;Any&gt;ï¼Œå¥½åƒ<strong>æ³›å‹ç›´æ¥å¯ä»¥åå˜äº†ä¸€æ ·</strong>ï¼Œè€Œä¸éœ€è¦å†ä½¿ç”¨ Java å½“ä¸­çš„é€šé…ç¬¦ &lt;? extends String&gt;ã€‚</p>
<p>åŒæ ·çš„ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œ</p>
<pre><code class="language-kotlin">class Container&lt;in T&gt; { // (1) 
    private  var item: T? = null 
     fun set(t: T) {
        item = t
    }
}

val c: Container&lt;String&gt; = Container&lt;Any&gt;() // (2) ç¼–è¯‘é€šè¿‡,å› ä¸º T æ˜¯ä¸€ä¸ª in-å‚æ•°
</code></pre>
<p>ä»£ç  (1) å¤„ä½¿ç”¨ &lt;in T&gt; æŒ‡å®š T ç±»å‹åªèƒ½å‡ºç°åœ¨æ¶ˆè´¹è€…çš„ä½ç½®ä¸Šã€‚ä»£ç  (2) å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œ Any &gt; Stringï¼Œä½†æ˜¯ Container&lt;String&gt; å¯ä»¥è¢« Container&lt;Any&gt; èµ‹å€¼ï¼Œæ„å‘³ç€ Container&lt;String&gt; å¤§äº Container&lt;Any&gt; ï¼Œå³å®ƒçœ‹ä¸Šå»å°±åƒ <strong>T ç›´æ¥å®ç°äº†æ³›å‹é€†å˜</strong>ï¼Œè€Œä¸éœ€è¦å€ŸåŠ© &lt;? super String&gt; é€šé…ç¬¦æ¥å®ç°é€†å˜ã€‚å¦‚æœæ˜¯ Java ä»£ç ï¼Œåˆ™éœ€è¦å†™æˆ <code>Container&lt;? super String&gt; c = new Container&lt;Object&gt;();</code>ã€‚</p>
<p>è¿™å°±æ˜¯<strong>å£°æ˜å¤„å‹å˜</strong>ï¼Œåœ¨ç±»å£°æ˜çš„æ—¶å€™ä½¿ç”¨ out å’Œ in å…³é”®å­—ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥å†™å‡ºæ³›å‹å‹å˜çš„ä»£ç ã€‚</p>
<p>è€Œ Java åœ¨ä½¿ç”¨æ—¶å¿…é¡»å€ŸåŠ©é€šé…ç¬¦æ‰èƒ½å®ç°æ³›å‹å‹å˜ï¼Œè¿™æ˜¯<strong>ä½¿ç”¨å¤„å‹å˜</strong>ã€‚</p>
<h4 id="ç±»å‹æŠ•å½±">ç±»å‹æŠ•å½±</h4>
<p>æœ‰æ—¶ä¸€ä¸ªç±»æ—¢å¯ä»¥ä½œç”Ÿäº§è€…åˆå¯ä»¥ä½œæ¶ˆè´¹è€…ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ T å‰é¢åŠ  in æˆ–è€… out å…³é”®å­—ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-kotlin">class Container&lt;T&gt; {
    private  var item: T? = null
    
    fun set(t: Tï¼Ÿ) {
        item = t
    }

    fun get(): T? = item
}
</code></pre>
<p>è€ƒè™‘è¿™ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="language-kotlin">fun copy(from: Container&lt;Any&gt;, to: Container&lt;Any&gt;) {
    to.set(from.get())
}
</code></pre>
<p>å½“æˆ‘ä»¬å®é™…ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼š</p>
<pre><code class="language-kotlin">val from = Container&lt;Int&gt;()
val to = Container&lt;Any&gt;()
copy(from, to) // æŠ¥é”™ï¼Œfrom æ˜¯ Container&lt;Int&gt; ç±»å‹ï¼Œè€Œ to æ˜¯ Container&lt;Any&gt; ç±»å‹
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615726536879.png" alt="" loading="lazy"></figure>
<p>è¿™æ ·ä½¿ç”¨çš„è¯ï¼Œç¼–è¯‘å™¨æŠ¥é”™ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠä¸¤ä¸ªä¸ä¸€æ ·çš„ç±»å‹åšäº†èµ‹å€¼ã€‚ç”¨ kotlin å®˜æ–¹æ–‡æ¡£çš„è¯è¯´ï¼Œcopy å‡½æ•°åœ¨â€å¹²åäº‹â€œï¼Œ å®ƒå°è¯•<strong>å†™</strong>ä¸€ä¸ª Any ç±»å‹çš„å€¼ç»™ toï¼Œ è€Œæˆ‘ä»¬ç”¨ Int ç±»å‹æ¥æ¥æ”¶è¿™ä¸ªå€¼ï¼Œå¦‚æœç¼–è¯‘å™¨ä¸æŠ¥é”™ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶å°†ä¼šæŠ›å‡ºä¸€ä¸ª <code>ClassCastException</code> å¼‚å¸¸ã€‚</p>
<p>æ‰€ä»¥åº”è¯¥æ€ä¹ˆåŠï¼Ÿç›´æ¥é˜²æ­¢ from è¢«å†™å…¥å°±å¯ä»¥äº†ï¼</p>
<p>å°† copy å‡½æ•°æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-kotlin">fun copy(from: Container&lt;out Any&gt;, to: Container&lt;Any&gt;) { // ç»™ from çš„ç±»å‹åŠ äº† out
    to.set(from.get())
}
val from = Container&lt;Int&gt;()
val to = Container&lt;Any&gt;()
copy(from, to) // ä¸ä¼šå†æŠ¥é”™äº†
</code></pre>
<p>è¿™å°±æ˜¯<strong>ç±»å‹æŠ•å½±</strong>ï¼šfrom æ˜¯ä¸€ä¸ªå—é™åˆ¶çš„ï¼ˆ<strong>æŠ•å½±çš„</strong>ï¼‰Container ç±»ï¼Œæˆ‘ä»¬åªèƒ½æŠŠå®ƒå½“ä½œç”Ÿäº§è€…æ¥ä½¿ç”¨ï¼Œå®ƒåªèƒ½è°ƒç”¨ get() æ–¹æ³•ã€‚</p>
<p>åŒç†ï¼Œå¦‚æœ from çš„æ³›å‹æ˜¯ç”¨ in æ¥ä¿®é¥°çš„è¯ï¼Œåˆ™ from åªèƒ½è¢«å½“ä½œæ¶ˆè´¹è€…ä½¿ç”¨ï¼Œå®ƒåªèƒ½è°ƒç”¨ set() æ–¹æ³•ï¼Œä¸Šè¿°ä»£ç å°±ä¼šæŠ¥é”™ï¼š</p>
<pre><code class="language-kotlin">fun copy(from: Container&lt;in Any&gt;, to: Container&lt;Any&gt;) { // ç»™ from çš„ç±»å‹åŠ äº† in
    to.set(from.get())
}
val from = Container&lt;Int&gt;()
val to = Container&lt;Any&gt;()
copy(from, to) //  æŠ¥é”™
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615726448076.png" alt="" loading="lazy"></figure>
<p>å…¶å®ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œç±»å‹æŠ•å½±å’Œ Java çš„é€šé…ç¬¦å¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§<strong>ä½¿ç”¨æ—¶å‹å˜</strong>ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡">ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ</h3>
<p>ä¸ºä»€ä¹ˆ Java çš„æ•°ç»„æ˜¯é»˜è®¤å‹å˜çš„ï¼Œè€Œæ³›å‹é»˜è®¤ä¸å‹å˜å‘¢ï¼Ÿå…¶å® kolin çš„æ³›å‹é»˜è®¤ä¹Ÿæ˜¯ä¸å‹å˜çš„ï¼Œåªæ˜¯ä½¿ç”¨ out å’Œ in å…³é”®å­—è®©å®ƒçœ‹èµ·æ¥åƒæ³›å‹å‹å˜ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸é»˜è®¤æ³›å‹å¯å‹å˜å‘¢ï¼Ÿ</p>
<p>åœ¨ stackoverflow ä¸Šæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå‚è€ƒï¼šhttps://stackoverflow.com/questions/18666710/why-are-arrays-covariant-but-generics-are-invariant</p>
<blockquote>
<p>Java å’Œ C# æ—©æœŸéƒ½æ˜¯æ²¡æœ‰æ³›å‹ç‰¹æ€§çš„ã€‚</p>
<p>ä½†æ˜¯ä¸ºäº†æ”¯æŒç¨‹åºçš„å¤šæ€æ€§ï¼Œäºæ˜¯å°†æ•°ç»„è®¾è®¡æˆäº†åå˜çš„ã€‚å› ä¸ºæ•°ç»„çš„å¾ˆå¤šæ–¹æ³•åº”è¯¥å¯ä»¥é€‚ç”¨äºæ‰€æœ‰ç±»å‹å…ƒç´ çš„æ•°ç»„ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="language-java">boolean equalArrays (Object[] a1, Object[] a2);
void shuffleArray(Object[] a);
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ˜¯æ¯”è¾ƒæ•°ç»„æ˜¯å¦ç›¸ç­‰ï¼›ç¬¬äºŒä¸ªæ˜¯æ‰“ä¹±æ•°ç»„é¡ºåºã€‚</p>
<p>è¯­è¨€çš„è®¾è®¡è€…ä»¬å¸Œæœ›è¿™äº›æ–¹æ³•å¯¹äºä»»ä½•ç±»å‹å…ƒç´ çš„æ•°ç»„éƒ½å¯ä»¥è°ƒç”¨ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥è°ƒç”¨ shuffleArray(String[] s) æ¥æŠŠå­—ç¬¦ä¸²æ•°ç»„çš„é¡ºåºæ‰“ä¹±ã€‚</p>
<p>å‡ºäºè¿™æ ·çš„è€ƒè™‘ï¼Œåœ¨ Java å’Œ C# ä¸­ï¼Œæ•°ç»„è®¾è®¡æˆäº†åå˜çš„ã€‚</p>
<p>ç„¶è€Œï¼Œå¯¹äºæ³›å‹æ¥è¯´ï¼Œå´æœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p>
<pre><code class="language-java">// Illegal code - because otherwise life would be Bad
List&lt;Dog&gt; dogs = new List&lt;Dog&gt;();
List&lt;Animal&gt; animals = dogs; // Awooga awooga
animals.add(new Cat());// (1)
Dog dog = dogs.get(0); //(2) This should be safe, right?
</code></pre>
<p>å¦‚æœä¸Šè¿°ä»£ç å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œå³ List&lt;Dog&gt; å¯ä»¥èµ‹å€¼ç»™ List&lt;Animal&gt;ï¼ŒList æ˜¯åå˜çš„ã€‚æ¥ä¸‹æ¥å¾€ List&lt;Dog&gt; ä¸­ add ä¸€ä¸ª Cat()ï¼Œå¦‚ä»£ç  (1) å¤„ã€‚è¿™æ ·å°±æœ‰å¯èƒ½é€ æˆä»£ç  (2) å¤„çš„æ¥æ”¶è€… <code>Dog dog</code> å’Œ <code>dogs.get(0)</code> çš„ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ã€‚ä¼šå¼•å‘è¿è¡Œæ—¶çš„å¼‚å¸¸ã€‚æ‰€ä»¥ Java åœ¨ç¼–è¯‘æœŸå°±è¦é˜»æ­¢è¿™ç§è¡Œä¸ºï¼ŒæŠŠæ³›å‹è®¾è®¡ä¸ºé»˜è®¤ä¸å‹å˜çš„ã€‚</p>
</blockquote>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>1ã€Java æ³›å‹é»˜è®¤ä¸å‹å˜ï¼Œæ‰€ä»¥ List&lt;String&gt; ä¸æ˜¯ List&lt;Object&gt; çš„å­ç±»ã€‚å¦‚æœè¦å®ç°æ³›å‹å‹å˜ï¼Œåˆ™éœ€è¦ &lt;? extends T&gt; ä¸ &lt;? super T&gt; é€šé…ç¬¦ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨å¤„å‹å˜çš„æ–¹æ³•ã€‚ä½¿ç”¨ &lt;? extends T&gt; é€šé…ç¬¦æ„å‘³ç€è¯¥ç±»æ˜¯ç”Ÿäº§è€…ï¼Œåªèƒ½è°ƒç”¨ get(): T ä¹‹ç±»çš„æ–¹æ³•ã€‚è€Œä½¿ç”¨ &lt;? super T&gt; é€šé…ç¬¦æ„å‘³ç€è¯¥ç±»æ˜¯æ¶ˆè´¹è€…ï¼Œåªèƒ½è°ƒç”¨ set(T t)ã€add(T t) ä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<p>2ã€Kotlin æ³›å‹å…¶å®é»˜è®¤ä¹Ÿæ˜¯ä¸å‹å˜çš„ï¼Œåªä¸è¿‡ä½¿ç”¨ out å’Œ in å…³é”®å­—åœ¨ç±»å£°æ˜å¤„å‹å˜ï¼Œå¯ä»¥è¾¾åˆ°åœ¨ä½¿ç”¨å¤„çœ‹èµ·æ¥åƒç›´æ¥å‹å˜çš„æ•ˆæœã€‚ä½†æ˜¯è¿™æ ·ä¼šé™åˆ¶ç±»åœ¨å£°æ˜æ—¶åªèƒ½è¦ä¹ˆä½œä¸ºç”Ÿäº§è€…ï¼Œè¦ä¹ˆä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<p>ä½¿ç”¨ç±»å‹æŠ•å½±å¯ä»¥é¿å…ç±»åœ¨å£°æ˜æ—¶è¢«é™åˆ¶ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶è¦ä½¿ç”¨ out å’Œ in å…³é”®å­—æŒ‡æ˜è¿™ä¸ªæ—¶åˆ»ç±»æ‰€å……å½“çš„è§’è‰²æ˜¯æ¶ˆè´¹è€…è¿˜æ˜¯ç”Ÿäº§è€…ã€‚ç±»å‹æŠ•å½±ä¹Ÿæ˜¯ä¸€ç§ä½¿ç”¨å¤„å‹å˜çš„æ–¹æ³•ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/er-cha-shu-de-zui-jin-gong-gong-zu-xian/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/er-cha-shu-de-zui-jin-gong-gong-zu-xian/">
        </link>
        <updated>2020-06-11T12:49:20.000Z</updated>
        <content type="html"><![CDATA[<p>è¯¥é¢˜æ¥è‡ª leetcode 236ï¼Œ https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/</p>
<h3 id="é¢˜ç›®">é¢˜ç›®</h3>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹ pã€q çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<h3 id="åˆ†æ">åˆ†æ</h3>
<p>é¦–å…ˆè®¾ pã€q çš„æœ€è¿‘å…¬å…±ç¥–å…ˆä¸º rootã€‚è¿™ä¸ªé¢˜ç›®æœ€å…³é”®çš„åœ°æ–¹åœ¨äºç†è§£ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>è¦ä¹ˆ pï¼Œq ä¸¤ä¸ªèŠ‚ç‚¹åªåœ¨ root çš„ä¸€ä¸ªå­æ ‘ä¸Šï¼Œæ­¤æ—¶ root å¿…ç„¶å°±æ˜¯ pã€q ä¸­æ·±åº¦å°çš„é‚£ä¸ªï¼Œå³ root == p || root == q</li>
<li>è¦ä¹ˆ pï¼Œq ä¸¤ä¸ªèŠ‚ç‚¹åˆ†åˆ«åœ¨ root çš„ä¸¤ä¸ªå­æ ‘ä¸Š</li>
</ul>
</blockquote>
<p>ä¸‹é¢å…ˆæ¥è¯æ˜ç¬¬ä¸€ç‚¹ï¼š</p>
<blockquote>
<p>pï¼Œq ä¸¤ä¸ªèŠ‚ç‚¹åªåœ¨æœ€è¿‘å…¬å…±ç¥–å…ˆ root çš„ä¸€ä¸ªå­æ ‘ä¸Šï¼Œæ­¤æ—¶ root å¿…ç„¶å°±æ˜¯ pã€q ä¸­æ·±åº¦å°çš„é‚£ä¸ªï¼Œå³ root == p || root == q</p>
</blockquote>
<p>ä½¿ç”¨åè¯æ³•ã€‚<br>
å‡è®¾ pï¼Œq ä¸¤ä¸ªèŠ‚ç‚¹åªåœ¨æœ€è¿‘å…¬å…±ç¥–å…ˆ root çš„ä¸€ä¸ªå­æ ‘ä¸Šï¼Œä¸” root != p &amp;&amp; root != qï¼Œå¦‚ä¸‹å›¾ï¼š<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615726225557.png" alt="" loading="lazy"><br>
å¾ˆæ˜æ˜¾ï¼Œæ­¤æ—¶ pã€q çš„æœ€è¿‘å…¬å…±ç¥–å…ˆä¸º root'ï¼Œè€Œé rootã€‚å¹¶ä¸” pã€q ä¹Ÿåˆ†åˆ« root' çš„ä¸¤ä¸ªå­æ ‘ä¸Šã€‚è¿™ä¸ <strong>root æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</strong>ï¼Œä»¥åŠï¼Œ<strong>pã€q åŒåœ¨ root' çš„ä¸€ä¸ªå­æ ‘ä¸Š</strong>çš„å‡è®¾çŸ›ç›¾ã€‚</p>
<p>ç¬¬äºŒç‚¹åˆ™éå¸¸å®¹æ˜“ç†è§£ï¼Œå¦‚æœ pã€q ä¸åŒåœ¨ root çš„ä¸€ä¸ªå­æ ‘ä¸Šï¼Œåˆ™å¿…ç„¶åˆ†åˆ«åœ¨ä¸¤ä¸ªå­æ ‘ä¸Šã€‚</p>
<p>ç†è§£äº†è¿™ä¸¤ç‚¹æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ<br>
è¿™ä¸¤ç‚¹å¯ä»¥æœ‰ä¸‹é¢çš„æ¨è®ºï¼š</p>
<blockquote>
<ul>
<li>å‡è®¾ root ä¸º pã€q çš„ä»»ä¸€å…¬å…±çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœ p ã€q åˆ†åˆ«åœ¨ root çš„å·¦å³å­æ ‘ä¸Šï¼Œåˆ™ root å¿…ä¸º pã€q æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ï¼ˆå¯ç”±ä¸Šè¿°ç¬¬ä¸€ç‚¹åè¯æ¨å‡ºï¼‰</li>
<li>å¯¹äº pã€q çš„æ‰€æœ‰å…¬å…±çˆ¶èŠ‚ç‚¹ï¼Œ å¦‚æœ pã€q å‡ä¸åˆ†åˆ«åœ¨å…¶å·¦å³å­æ ‘ï¼Œè€Œæ˜¯åŒåœ¨å…¶ä¸€é¢—å­æ ‘ä¸Šï¼Œåˆ™ pã€q çš„æœ€è¿‘å…¬å…±èŠ‚ç‚¹ä¸€å®šæ˜¯ pã€q ä¸­æ·±åº¦è¾ƒå°çš„é‚£ä¸ªã€‚</li>
</ul>
</blockquote>
<p>è®°ä½äº†ä¸Šé¢è¿™ä¸¤ç‚¹ï¼Œå°±å¯ä»¥å†™å‡ºéå¸¸ç®€æ´çš„é€’å½’ä»£ç ï¼š</p>
<pre><code class="language-java">/**
 * Definition for a binary tree node.
 * public class TreeNode {
 *     int val;
 *     TreeNode left;
 *     TreeNode right;
 *     TreeNode(int x) { val = x; }
 * }
 */
class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null || root == p || root == q) return root;// ä¿è¯éå†å®Œæ‰€æœ‰å¯èƒ½çš„ pã€q å…¬å…±çˆ¶èŠ‚ç‚¹
        TreeNode left = lowestCommonAncestor(root.left, p, q); // å¦‚æœ left != nullï¼Œåˆ™ p æˆ– q åœ¨ root çš„å·¦å­æ ‘ä¸­
        TreeNode right = lowestCommonAncestor(root.right, p, q); // // å¦‚æœ right != nullï¼Œåˆ™ p æˆ– q åœ¨ root çš„å³å­æ ‘ä¸­
        if (left != null &amp;&amp; right != null) return root; // å¦‚æœ left != null &amp;&amp; right!= nullï¼Œåˆ™å¯¹åº”æ¨è®ºç¬¬ä¸€ç‚¹
        return left != null ? left : right; // åœ¨éå†å®Œæ‰€æœ‰å¯èƒ½çš„çˆ¶èŠ‚ç‚¹åï¼Œpã€q å‡ä¸åˆ†åœ¨çˆ¶èŠ‚ç‚¹çš„å·¦å³ä¸¤ä¾§ï¼Œå¯¹åº”æ¨è®ºç¬¬äºŒç‚¹
    }
}
</code></pre>
<p>å‚è€ƒï¼š<br>
https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/solution/236-er-cha-shu-de-zui-jin-gong-gong-zu-xian-jian-j/</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kotlin ä¸­çš„ data class å’Œ sealed class]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/kotlin-zhong-de-data-class-he-sealed-class/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/kotlin-zhong-de-data-class-he-sealed-class/">
        </link>
        <updated>2020-05-20T12:47:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="kotlin-ä¸­çš„-data-class">Kotlin ä¸­çš„ data class</h2>
<p>åœ¨ä½¿ç”¨ java çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡å†™ç±»çš„ <code>equals</code> ã€<code>hashCode</code> å’Œ <code>toString</code> æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¾€å¾€éƒ½æ˜¯æ¨¡æ¿åŒ–çš„ã€‚åœ¨ kotlin ä¸­æä¾›äº†æ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•è®©æˆ‘ä»¬ä½¿ç”¨ä¸€è¡Œä»£ç æå®šè¿™äº›å·¥ä½œã€‚è¿™å°±æ˜¯ <code>data class</code>ã€‚</p>
<pre><code class="language-kotlin">// å®šä¹‰ä¸€ä¸ª Person ç±»
data class Person(val name: String, val age: Int) {
}
</code></pre>
<p>å†™å¥½ä¸Šé¢çš„ä»£ç ä¹‹åï¼Œ<code>Person</code> ç±»ä¸­çš„ä¸Šè¿°å‡ ä¸ªæ–¹æ³•çš„é‡å†™å°±ç”± kotlin å¸®æˆ‘ä»¬è‡ªåŠ¨å®Œæˆäº†ã€‚è¿è¡Œä¸‹é¢çš„ä»£ç </p>
<pre><code class="language-kotlin">fun main() {
    val p1 = Person(&quot;Jack&quot;, 24)
    val p2 = Person(&quot;Jack&quot;, 24)

    val p3 = Person(&quot;Jack&quot;, 32)
    val p4 = Person(&quot;Rose&quot;, 31)

    println(p1 == p2) 

    println(p1 === p2)

    println(p1 == p3)

    println(&quot;&quot;&quot;
        p1 hashCode = ${p1.hashCode()}
        p2 hashCode = ${p2.hashCode()}
        p3 hashCode = ${p3.hashCode()}
        p4 hashCode = ${p4.hashCode()}
    &quot;&quot;&quot;.trimIndent())
    
    println(&quot;p1 = $p1&quot;)
}

</code></pre>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>true
false
false
p1 hashCode = 71328761
p2 hashCode = 71328761
p3 hashCode = 71328769
p4 hashCode = 79149200
p1 = Person(name=Jack, age=24)
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>equals</code> ã€<code>hashCode</code> å’Œ <code>toString</code> æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå¹¶ä¸”å·²ç»è¢«è¦†å†™äº†ã€‚</p>
<h2 id="data-class-ç©¶ç«Ÿåšäº†ä»€ä¹ˆ">data class ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿ</h2>
<p><code>data class</code> æ˜¯å¦‚ä½•åšåˆ°ä¸Šè¿°å®ç°çš„å‘¢ï¼ŸæŸ¥çœ‹ <code>Person</code> ç±»çš„å­—èŠ‚ç åç¼–è¯‘å¾—åˆ°çš„ java ä»£ç ï¼Œå¦‚ä¸‹</p>
<pre><code class="language-java">public final class Person {
   @NotNull
   private final String name;
   private final int age;

   @NotNull
   public final String getName() {
      return this.name;
   }

   public final int getAge() {
      return this.age;
   }

   public Person(@NotNull String name, int age) {
      Intrinsics.checkParameterIsNotNull(name, &quot;name&quot;);
      super();
      this.name = name;
      this.age = age;
   }

   @NotNull
   public final String component1() {
      return this.name;
   }

   public final int component2() {
      return this.age;
   }

   @NotNull
   public final Person copy(@NotNull String name, int age) {
      Intrinsics.checkParameterIsNotNull(name, &quot;name&quot;);
      return new Person(name, age);
   }

   // $FF: synthetic method
   public static Person copy$default(Person var0, String var1, int var2, int var3, Object var4) {
      if ((var3 &amp; 1) != 0) {
         var1 = var0.name;
      }

      if ((var3 &amp; 2) != 0) {
         var2 = var0.age;
      }

      return var0.copy(var1, var2);
   }

   @NotNull
   public String toString() {
      return &quot;Person(name=&quot; + this.name + &quot;, age=&quot; + this.age + &quot;)&quot;;
   }

   public int hashCode() {
      String var10000 = this.name;
      return (var10000 != null ? var10000.hashCode() : 0) * 31 + this.age;
   }

   public boolean equals(@Nullable Object var1) {
      if (this != var1) {
         if (var1 instanceof Person) {
            Person var2 = (Person)var1;
            if (Intrinsics.areEqual(this.name, var2.name) &amp;&amp; this.age == var2.age) {
               return true;
            }
         }

         return false;
      } else {
         return true;
      }
   }
}
</code></pre>
<p>ä»ä¸Šé¢å¯ä»¥ä¸€ç›®äº†ç„¶åœ°çœ‹è§ kotlin æ˜¯å¦‚ä½•æ„é€  data class çš„ã€‚ç”±äºæˆ‘å®šä¹‰çš„æˆå‘˜å˜é‡æ˜¯ <code>val</code> ä¸å¯å˜ç±»å‹çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ Getter å’Œ Setterã€‚</p>
<ul>
<li>
<p>å¯¹äº<code>equals</code> æ–¹æ³•ï¼Œå¯¹äº <code>var1</code> , å¦‚æœå®ƒçš„åœ°å€å’Œè‡ªå·±ä¸åŒï¼Œé‚£ä¹ˆå…ˆæ£€æŸ¥å…¶æ˜¯å¦æ˜¯ <code>Person</code> ç±»å‹ ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€ä¸ªå¯¹æ¯”æ¯ä¸ªæˆå‘˜å˜é‡æ˜¯å¦ç›¸ç­‰ã€‚è¿™é‡Œç”¨åˆ°çš„     <code>Intrinsics.areEqual(Object o1, Object o2)</code> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">public static boolean areEqual(Object first, Object second) {
      return first == null ? second == null : first.equals(second);
  }
</code></pre>
<p>æœ€ç»ˆè°ƒç”¨äº†è¢«æ¯”è¾ƒå¯¹è±¡çš„ <code>equals</code> æ–¹æ³•ã€‚<br>
å¯¹äº Int ç±»å‹çš„æˆå‘˜å˜é‡ <code>age</code> , ç›´æ¥ä½¿ç”¨ <code>==</code> æ¯”è¾ƒã€‚</p>
<p>è¿™æ˜¯è¦†å†™ä¸€ä¸ªç±»çš„ <code>equals</code> æ–¹æ³•çš„å¸¸è§„å†™æ³•ã€‚</p>
</li>
<li>
<p><code>hashCode</code> å’Œ <code>toString</code> æ–¹æ³•ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è§„è¦†å†™çš„å¥—è·¯ã€‚</p>
</li>
<li>
<p>æä¾›äº† <code>component1</code> å’Œ <code>component2</code> ä¸¤ä¸ªæ–¹æ³•æ¥è·å–æˆå‘˜å˜é‡ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥åšè§£æ„å£°æ˜ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">val (name, age) = Person(&quot;Rose&quot;, 43) 
println(&quot;$name, $age&quot;)
// (name, age) å°±æ˜¯è§£æ„å£°æ˜ï¼Œname å¯¹åº” component1 , age å¯¹åº” component2 
</code></pre>
</li>
<li>
<p>æä¾›äº† <code>copy</code> æ–¹æ³•æ„é€ ä¸€ä¸ª <code>Person</code> å¯¹è±¡ã€‚æœ‰ // $FF: synthetic method æ³¨é‡Šçš„ <code>copy$default</code> æ–¹æ³•æ˜¯ç»™ kotlin ç¼–è¯‘å™¨è°ƒç”¨çš„ï¼Œæˆ‘ä»¬ç”¨ä¸åˆ°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬åªæƒ³è¦ <code>age</code> ä¸åŒçš„ <code>Person</code> , å¯ä»¥è¿™æ ·å†™</p>
<pre><code class="language-kotlin">  val newPerson = p1.copy(age = 30)
</code></pre>
<p>ç¼–è¯‘å™¨ç¼–è¯‘åˆ°è¿™å¥ä»£ç æ—¶ï¼Œä¼šå¸®æˆ‘ä»¬è°ƒç”¨ <code>copy$default</code> æ¥æ„é€ ä¸€ä¸ª <code>name</code> å€¼å’Œ p1 ä¸€æ ·çš„  <code>newPerson</code> å¯¹è±¡ ã€‚</p>
</li>
</ul>
<p>æ€»ä¹‹ï¼Œ <code>data class</code> å°±æ˜¯ç”¨å¸¸è§„å¥—è·¯æ¥ç”Ÿæˆä¸€ä¸ªå·²ç»è¦†å†™å¥½ä¸Šè¿°æ–¹æ³•çš„ç±»ã€‚</p>
<p>å¦‚æœ Person ç±»ä¸éœ€è¦è‡ªåŠ¨ç”Ÿæˆ age ï¼Œåªéœ€è¦æŠŠ age ä»ä¸»æ„é€ å‡½æ•°ä¸­æ‹¿å‡ºï¼Œæ”¾åˆ°ç±»ä½“ä¸­å°±å¯ä»¥ã€‚å¦‚ä¸‹</p>
<pre><code class="language-kotlin">data class Person(val nameï¼š String) {
    val age: Int = 0
}
</code></pre>
<h2 id="kotlin-ä¸­çš„-sealed-class">Kotlin ä¸­çš„ sealed class</h2>
<p><code>sealed class</code> æ˜¯ä¸€ç§åŒæ—¶æ‹¥æœ‰æšä¸¾ç±» <code>enum</code> å’Œ æ™®é€šç±» <code>class</code> ç‰¹æ€§çš„ç±»ï¼Œå«åšå¯†å°ç±»ã€‚ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œå¦‚ä¸‹</p>
<pre><code class="language-kotlin">sealed class Result
class Success(val code: Int) : Result()
class Exception(val code: Int, val message: String) : Result()
</code></pre>
<p>åœ¨åŒä¸€ä¸ª kotlin æ–‡ä»¶ä¸­å£°æ˜ä¸‰ä¸ªç±»ã€‚é¦–å…ˆå£°æ˜ <code>sealed class</code> ç±» <code>Result</code>, ç„¶åå®šä¹‰å‡ºä¸¤ä¸ªå­ç±» <code>Success</code>, <code>Exception</code> ç»§æ‰¿è‡ª <code>Result</code>ã€‚æ³¨æ„ï¼Œå¯†å°ç±»åŠå…¶å­ç±»å¿…é¡»å£°æ˜åœ¨åŒä¸€ä¸ª kotlin æ–‡ä»¶ä¸­ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åœºæ™¯ã€‚æ¯”å¦‚å¯¹äºç½‘ç»œè¯·æ±‚çš„ç»“æœ Result ï¼Œ å¾€å¾€åªæœ‰ä¸¤ç§ç±»å‹ï¼ŒæˆåŠŸ Success æˆ–è€…æ˜¯å¤±è´¥ Exception ã€‚ä½¿ç”¨æ™®é€šçš„ç±»ä¸èƒ½æŠŠé™åˆ¶å…³ç³»è¡¨è¾¾å‡ºæ¥ï¼Œä½¿ç”¨æšä¸¾ç±»åˆ™æ— æ³•çµæ´»åœ°è‡ªå®šä¹‰éœ€è¦çš„ç±»çš„å†…å®¹ã€‚è¿™æ—¶å€™ï¼Œ<code>sealed class</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚æ¯”å¦‚åœ¨å¤„ç†ç»“æœ <code>Result</code> çš„æ—¶å€™:</p>
<pre><code class="language-kotlin">fun handleResult(result: Result): String{
    return when(result) {
        is Success -&gt; {
            &quot;success&quot;
        }
        is Exception -&gt; {
            &quot;exception&quot;
        }
    }
}
</code></pre>
<p>è¿™æ ·ï¼Œå¯¹äº <code>handleResult</code> çš„å…¥å‚å°±åšäº†ç±»å‹çš„é™åˆ¶ï¼Œé˜²æ­¢ä¼ å…¥ç±»å‹ä¸åŒ¹é…çš„å‚æ•°ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œä½¿ç”¨å¯†å°ç±»çš„è¯ï¼Œ<code>when</code> è¡¨è¾¾å¼å¯ä»¥è¦†ç›–æ‰€æœ‰æƒ…å†µï¼Œä¸éœ€è¦å†æ·»åŠ  <code>else</code> è¯­å¥ï¼ˆè¡¨è¾¾å¼å³æœ‰è¿”å›å€¼çš„ <code>when</code> , æ²¡æœ‰è¿”å›å€¼çš„ç§°ä¸º <code>when</code> è¯­å¥ï¼‰ã€‚</p>
<h2 id="sealed-class-ç©¶ç«Ÿåšäº†ä»€ä¹ˆ">sealed class ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>åŒæ ·åœ°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ <code>sealed class</code> åœ¨ java å±‚é¢åšäº†ä»€ä¹ˆï¼Œå®ç°äº†å‰é¢çš„æ•ˆæœã€‚<br>
ä¸Šè¿°å¯†å°ç±»åç¼–è¯‘å¾—åˆ°çš„ java ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public final class Exception extends Result {
   private final int code;
   @NotNull
   private final String message;

   public final int getCode() {
      return this.code;
   }

   @NotNull
   public final String getMessage() {
      return this.message;
   }

   public Exception(int code, @NotNull String message) {
      Intrinsics.checkParameterIsNotNull(message, &quot;message&quot;);
      super((DefaultConstructorMarker)null);
      this.code = code;
      this.message = message;
   }
}
// Success.java
import kotlin.Metadata;
import kotlin.jvm.internal.DefaultConstructorMarker;
public final class Success extends Result {
   private final int code;

   public final int getCode() {
      return this.code;
   }

   public Success(int code) {
      super((DefaultConstructorMarker)null);
      this.code = code;
   }
}
// Result.java
import kotlin.Metadata;
import kotlin.jvm.internal.DefaultConstructorMarker;
// æœ€é‡è¦çš„åœ°æ–¹
public abstract class Result {
   private Result() {
   }

   // $FF: synthetic method
   public Result(DefaultConstructorMarker $constructor_marker) {
      this();
   }
}

</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Result</code> ç±»å…¶å®æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œ<code>Success</code> å’Œ <code>Exception</code> ç»§æ‰¿äº†è¿™ä¸ªæŠ½è±¡ç±»ã€‚<code>Result</code> ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½åœ¨å¤–éƒ¨è®¿é—®åˆ°ã€‚</p>
<p>é€šè¿‡ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¾¾åˆ°é™åˆ¶ç±»å‹çš„åšæ³•ã€‚</p>
<p>è¿™å…¶å®å’Œ java ä¸­ä½¿ç”¨æ¥å£æ¥é™å®šå‚æ•°ç±»å‹çš„åšæ³•ç±»ä¼¼ï¼Œå¾ˆå¥½ç†è§£ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kotlin ä¸­çš„æ‰©å±•å‡½æ•°å’Œæ‰©å±•å±æ€§]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/kotlin-zhong-de-kuo-zhan-han-shu-he-kuo-zhan-shu-xing/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/kotlin-zhong-de-kuo-zhan-han-shu-he-kuo-zhan-shu-xing/">
        </link>
        <updated>2020-04-26T12:35:53.000Z</updated>
        <content type="html"><![CDATA[<h3 id="kotlin-æ‰©å±•å‡½æ•°">Kotlin æ‰©å±•å‡½æ•°</h3>
<p>åœ¨ android å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨åˆ°å„ç§ utils å·¥å…·ç±»ã€‚æ¯”å¦‚ ViewUtilsï¼Œ ScreenUtilsï¼Œ FileUtils ç­‰ï¼Œ</p>
<p>è¿™äº›ç±»å¾€å¾€ä¼šæä¾›ä¸€äº›é™æ€æ–¹æ³•ï¼Œè®©æˆ‘ä»¬è¿›è¡Œä¸€äº›é€šç”¨çš„æ“ä½œã€‚</p>
<p>æˆ–è€…ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå¸Œæœ›ç»™æŸä¸€ä¸ªç±»å¢åŠ ä¸€ä¸¤ä¸ªå°å±æ€§æˆ–è€…æ–¹æ³•ï¼Œåœ¨ç”¨åˆ°è¿™ä¸ªç±»çš„åœ°æ–¹éƒ½èƒ½è°ƒç”¨ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„å¼€å‘ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ª String å¯¹è±¡éƒ½èƒ½æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›è¿™ä¸ª String å¯¹è±¡åŒ…å«çš„å¤§å†™å­—æ¯ä¸ªæ•°ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½ä¼šåœ¨æŸä¸ª utils ä¸­è¿™æ ·å†™</p>
<pre><code class="language-java">public static int getStringCapitalCount(String s) throws Exception {
        if (s == null) {
            throw new Exception(&quot;string should not be null!&quot;);
        }
        int count = 0;
        for (int i = 0; i &lt; s.length(); i++) {
            char c = s.charAt(i);
            if (c &gt;= 65 &amp;&amp; c &lt;= 90) {
                count++;
            }
        }
        return count;
    }
</code></pre>
<p>æˆ–è€…, æˆ‘ä»¬ä¼šè€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå­ç±»æ¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»ï¼Œç„¶åç»™å­ç±»æ·»åŠ è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨å­ç±»ã€‚å½“ç„¶ï¼ŒString æ˜¯ä¸å¯ç»§æ‰¿çš„ã€‚</p>
<p>è¿™æ ·å†™ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¸€è´¯çš„ java å†™æ³•ã€‚</p>
<p>ä½†æ˜¯åœ¨ Kotlin ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†æ›´ä¼˜é›…çš„æ–¹å¼ã€‚æ—¢ç„¶æˆ‘ä»¬æœ€å¼€å§‹çš„ç›®æ ‡æ˜¯å¸Œæœ› String ç±»å‹å¤šä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä»£ç ä¹Ÿåº”è¯¥å†™å¾—åƒè¿™æ ·ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">// å‡½æ•°åä»¥ç±»åä½œä¸ºå‰ç¼€ï¼š ClassName.funName
// è¯¥å‰ç¼€å«åš æ¥æ”¶è€…ç±»å‹ï¼ˆreceiver typeï¼‰
fun String.capitalCount(): Int{ 
    var count = 0
    this.forEach { // this æŒ‡çš„æ˜¯ç±»çš„å®ä¾‹å¯¹è±¡, å« æ¥æ”¶è€…å¯¹è±¡ï¼ˆreceiver objectï¼‰
        if (it.toInt() in 65..90) {
            count ++
        }
    }
    return count
}
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ä½¿ç”¨åˆ° String çš„åœ°æ–¹ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°±å¥½åƒ String ç±»å‹æœ¬æ¥å°±æ‹¥æœ‰è¿™ä¸ªæ–¹æ³•ä¸€æ ·ã€‚</p>
<pre><code class="language-kotlin">fun main() {
    val s = &quot;AbCdEfg&quot;
    println(s.capitalCount())
}
</code></pre>
<p>è¿™å°±æ˜¯ Kotlin ä¸­çš„æ‰©å±•å‡½æ•°ã€‚</p>
<p>ä¸€èˆ¬ï¼Œå°†æ‰©å±•å‡½æ•°å®šä¹‰åœ¨ä¸€ä¸ª Extensions.kt çš„æ–‡ä»¶ä¸­ï¼Œæœ€å¤–å±‚ç›´æ¥å†™å‡½æ•°å°±å¯ä»¥ï¼Œä¸éœ€è¦åƒ java ä¸€æ ·å®šä¹‰ä¸€ä¸ªç±»ã€‚è¿™æ ·å®šä¹‰çš„å‡½æ•°æ˜¯é¡¶å±‚å‡½æ•°ï¼Œç±»ä¼¼äº java ä¸­çš„é™æ€å‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è°ƒç”¨ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615725849618.png" alt="" loading="lazy"></figure>
<p>ç±»ä¼¼åœ°ï¼Œ æˆ‘ä»¬å†å†™ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç»å¸¸ç”¨åˆ°çš„å°† Date è½¬ä¸º String çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰©å±•å‡½æ•°çš„æ–¹å¼ï¼š</p>
<pre><code class="language-kotlin">fun Date.dateString(): String{
    val dateFormat = SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.getDefault())
    return dateFormat.format(this)
}

// è°ƒç”¨æ—¶
fun main() {
    println(Date().dateString())
}
</code></pre>
<p><strong>æ³¨æ„</strong></p>
<ul>
<li>
<p>æ‰©å±•å‡½æ•°è™½ç„¶çœ‹èµ·æ¥åƒæ˜¯å¾€ç±»é‡Œé¢æ·»åŠ äº†æˆå‘˜å‡½æ•°ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰æ”¹å˜ç±»çš„ä»»ä½•ç»“æ„ã€‚æ‰€ä»¥ï¼Œå¯¹äºç±»å†…éƒ¨ privateã€protected ä»¥åŠ internalï¼ˆæ¨¡å—å¤–è®¿é—®ï¼‰ä¿®é¥°çš„æˆå‘˜å˜é‡å’Œå‡½æ•°ï¼Œæ˜¯ä¸èƒ½å¤Ÿè®¿é—®åˆ°çš„ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<img src="file:///Users/bullfrog/Documents/Gridea/post-images/1615725879056.png" alt="Encapsulation of an Extension Function in Kotlin" style="zoom: 80%;" />
</li>
<li>
<p>å¦‚æœæ‰©å±•å‡½æ•°å’Œç±»å†…éƒ¨å®šä¹‰çš„æˆå‘˜å‡½æ•°é‡åï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶æ‰§è¡Œçš„æ˜¯ç±»çš„å‡½æ•°ã€‚</p>
</li>
<li>
<p>æ‰©å±•æ˜¯é™æ€è§£æçš„ï¼Œè°ƒâ½¤çš„æ‰©å±•å‡½æ•°æ˜¯ç”±å‡½æ•°è°ƒâ½¤æ‰€åœ¨çš„è¡¨è¾¾å¼çš„ç±»å‹æ¥å†³å®šçš„ï¼Œâ½½ä¸æ˜¯ç”±è¡¨è¾¾å¼è¿â¾æ—¶æ±‚å€¼ç»“æœå†³å®šçš„ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-kotlin">open class Shape
class Rectangle: Shape()
fun Shape.getName() = &quot;Shape&quot;
fun Rectangle.getName() = &quot;Rectangle&quot;
fun printClassName(s: Shape) {
println(s.getName())
}
printClassName(Rectangle())
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¼šè¾“å‡º â€œShapeâ€ ï¼Œå› ä¸ºè°ƒç”¨çš„æ‰©å±•å‡½æ•°åªå–å†³äº s å‚æ•°çš„ç±»å‹å£°æ˜ï¼Œè¿™é‡Œå®ƒæ˜¯ Shape ç±»ã€‚</p>
</li>
</ul>
<h3 id="kotlin-æ‰©å±•å±æ€§">Kotlin æ‰©å±•å±æ€§</h3>
<p>å’Œæ‰©å±•å‡½æ•°ç±»ä¼¼ï¼ŒKotlin åŒæ ·æ”¯æŒæ‰©å±•å±æ€§ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-kotlin">// ç»™ StringBuilder ç±»æ·»åŠ æ‰©å±•å±æ€§ firstLetter
var StringBuilder.firstLetter: Char
    get() = get(0)
    set(value) = this.setCharAt(0, value)
</code></pre>
<p>å¯ä»¥æŠŠæ‰©å±•å±æ€§çœ‹ä½œæ˜¯ä¸¤ä¸ªæ‰©å±•å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ getterï¼Œ ä¸€ä¸ªæ˜¯ setter ã€‚</p>
<p>è°ƒç”¨æ—¶ï¼š</p>
<pre><code class="language-kotlin">fun main(args: Array&lt;String&gt;) {
    val message = StringBuilder(&quot;hello !&quot;)
    println(&quot;${message.firstLetter} is the first letter of $message&quot;)
    message.firstLetter = 'H'
    println(&quot;${message.firstLetter} is the first letter of $message&quot;)
}
</code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<blockquote>
<p>h is the first letter of hello !</p>
</blockquote>
<blockquote>
<p>H is the first letter of Hello !</p>
</blockquote>
<p><strong>æ³¨æ„</strong></p>
<p>æ‰©å±•å±æ€§æ²¡æœ‰åˆå§‹åŒ–å™¨ï¼Œå³æ‰©å±•å±æ€§ä¸èƒ½åˆå§‹åŒ–ï¼Œåªèƒ½ä½¿ç”¨ getter / setter æ¥æ“ä½œæ‰©å±•å±æ€§çš„å€¼ã€‚</p>
<pre><code class="language-kotlin">val StringBuilder.firsetLetter = 'a' // è¿™æ˜¯é”™è¯¯çš„ï¼Œ ä¸èƒ½åˆå§‹åŒ–æ‰©å±•å±æ€§
</code></pre>
<p>è¿™æ˜¯å› ä¸ºæ‰©å±•å±æ€§å¹¶æ²¡æœ‰çœŸæ­£åœ°æ’å…¥ä¸€ä¸ªå±æ€§åˆ°ç±»ä¸­ï¼Œæ‰€ä»¥æ‰©å±•å±æ€§æ²¡æœ‰å¹•åå­—æ®µï¼ˆbacking fieldï¼‰ï¼Œä¸èƒ½è¿›è¡Œåˆå§‹åŒ–ã€‚åŒæ ·ï¼Œä¹Ÿä¸èƒ½åœ¨æ‰©å±•å±æ€§çš„ setter é‡Œä½¿ç”¨ field å…³é”®å­—ã€‚</p>
<p><strong>é…åˆæ³›å‹ä½¿ç”¨</strong></p>
<p>å¯ä»¥ä½¿ç”¨æ³›å‹æ¥ç»™å¤šä¸ªç±»æ·»åŠ æ‰©å±•å±æ€§ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-kotlin">// å¾—åˆ°é€†åºçš„ string
val &lt;T&gt; T.reverseString: String
    get() {
        return this.toString().reversed() // å®é™…ä¸Š reversed å‡½æ•°ä¹Ÿæ˜¯ Kotlin String ç±»å‹è‡ªå¸¦çš„æ‰©å±•å‡½æ•°
    }
</code></pre>
<h3 id="æ‰©å±•çš„-java-ä»£ç ">æ‰©å±•çš„ Java ä»£ç </h3>
<p>Kotlin ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°æ‰©å±•å‡½æ•°å’Œæ‰©å±•å±æ€§çš„å‘¢ï¼Ÿ</p>
<p>è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰ String.capitalCount çš„ä¾‹å­ï¼Œåç¼–è¯‘åçš„ java ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// Extension.kt æ–‡ä»¶ä¼šè¢«ç¼–è¯‘æˆ ExtensionKt.class
public final class ExtensionsKt {
   public static final int capitalCount(@NotNull String $this$capitalCount) {
      int count = 0;
      CharSequence $this$forEach$iv = (CharSequence)$this$capitalCount;
      int $i$f$forEach = false;
      CharSequence var4 = $this$forEach$iv;

      for(int var5 = 0; var5 &lt; var4.length(); ++var5) {
         char element$iv = var4.charAt(var5);
         int var8 = false;
         if ('A' &lt;= element$iv) {
            if ('Z' &gt;= element$iv) {
               ++count;
            }
         }
      }
 return count;
}
</code></pre>
<p>å®é™…ä¸Šå’Œåœ¨ java util ä¸­å®ç°æ–¹æ³•ä¸€è‡´ï¼Œç”Ÿæˆäº†ä¸€ä¸ªä»¥ String ç±»å‹ä¸ºå½¢å‚çš„é™æ€æ–¹æ³•ï¼Œè€Œå‡½æ•°å½¢å‚ this$capitalCount å…¶å®å°±æ˜¯åœ¨ kotlin ä¸­ this æŒ‡ä»£çš„é‚£ä¸ªå¯¹è±¡ã€‚</p>
<p>å†çœ‹ StringBuilder.firstLetter å±æ€§çš„åç¼–è¯‘ java ä»£ç ï¼š</p>
<pre><code class="language-java">public static final char getFirstLetter(@NotNull StringBuilder $this$firstLetter) {
      return $this$firstLetter.charAt(0);
   }

public static final void setFirstLetter(@NotNull StringBuilder $this$firstLetter, char value) {
      $this$firstLetter.setCharAt(0, value);
   }
</code></pre>
<p>å…¶å®å°±æ˜¯ç”Ÿæˆäº†ä¸¤ä¸ªé™æ€çš„æ–¹æ³•ï¼Œä¸€ä¸ª setter å’Œ ä¸€ä¸ª getterã€‚ç”¨ä¸¤ä¸ªæ‰©å±•å‡½æ•°ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[è¯‘æ–‡]æ€ä¹ˆæˆä¸ºä¸€åçœŸæ­£çš„é”®ç›˜ä¾ ï¼ˆä»æ­¤ä¸å†ä½¿ç”¨é¼ æ ‡ï¼‰]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/yi-wen-zen-me-cheng-wei-yi-ming-zhen-zheng-de-jian-pan-xia-cong-ci-bu-zai-shi-yong-shu-biao/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/yi-wen-zen-me-cheng-wei-yi-ming-zhen-zheng-de-jian-pan-xia-cong-ci-bu-zai-shi-yong-shu-biao/">
        </link>
        <updated>2019-06-08T12:56:53.000Z</updated>
        <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ï¼šhttps://levelup.gitconnected.com/how-to-become-a-true-keyboard-warrior-and-stop-using-your-mouse-a87cd29c5801</p>
<figure data-type="image" tabindex="1"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615726654424.png" alt="é”®ç›˜ä¾ " loading="lazy"></figure>
<p>ä½ è‚¯å®šè§åˆ°è¿‡ç¨‹åºå‘˜ä»¬é¢çº¢è€³èµ¤åœ°äº‰è®ºå“ªä¸ª IDE å¥½ç”¨ï¼Œå“ªä¸ªç¼–ç¨‹è¯­è¨€è¯­æ³•æ›´ç‰› â€”â€” è¿™ä¸ªäº‰è®ºå¯ä»¥æ‰©å±•æˆæˆ‘ä»¬ç°åœ¨è¦è®¨è®ºçš„é—®é¢˜ï¼Œå³æˆ‘ä»¬æ˜¯æ€æ ·ä½¿ç”¨é”®é¼ æ¥æ“ä½œç”µè„‘çš„ã€‚</p>
<p>æŒ‰ç…§ä½¿ç”¨ç”µè„‘çš„æ–¹å¼ï¼Œå¯ä»¥åˆ’åˆ†å‡ºä¸¤ç±»äººï¼šä¸€ç±»å¾ˆä¾èµ–é¼ æ ‡ï¼Œä¹Ÿä¸èƒ½ç†è§£ä¸ºä»€ä¹ˆæœ‰äººæ„¿æ„ç”¨é”®ç›˜è¾“å…¥ä»£æ›¿é¼ æ ‡æ¥æ“ä½œç”µè„‘ï¼›å¦ä¸€ç±»äººï¼Œå°±æ˜¯æˆ‘ä»¬ï¼ˆä½œè€…è‡ªå¤¸ï¼‰ï¼Œäººæ•°è™½å°‘ï¼Œä½†æ˜¯æ‡‚å¾—ç”¨é”®ç›˜çš„ä¾¿æ·ä¹‹å¤„ï¼Œå°½å¯èƒ½åœ°ä½¿ç”¨é”®ç›˜ã€‚</p>
<h2 id="ä¸€æ—¦ä¹ æƒ¯äº†é”®ç›˜ä»¥åä½ çš„é€Ÿåº¦ä¼šå¿«å¾—å¤š">ä¸€æ—¦ä¹ æƒ¯äº†é”®ç›˜ä»¥åï¼Œä½ çš„é€Ÿåº¦ä¼šå¿«å¾—å¤š</h2>
<p>ä½¿ç”¨é¼ æ ‡å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å‡å¦‚ä½ æ˜ç¡®çŸ¥é“è‡ªå·±è¦åšä»€ä¹ˆï¼ˆè€Œä¸æ˜¯æ¼«æ— ç›®çš„åœ°ç½‘ä¸Šå†²æµªï¼‰ï¼Œé‚£æ¯«æ— ç–‘é—®ä½¿ç”¨é”®ç›˜æ˜¯ä¸€ä¸ªæ›´å¿«çš„é€‰æ‹©ã€‚</p>
<p>ä¸¾ä¸ªå¤§å®¶éƒ½æ‡‚çš„ç®€å•ä¾‹å­ï¼Œä½¿ç”¨ <strong>Ctrl-C/V</strong> è¿›è¡Œå¤åˆ¶ç²˜è´´æ“ä½œï¼Œè€Œä¸æ˜¯é¼ æ ‡å³å‡»ï¼Œåœ¨ä¼—å¤šçš„é€‰é¡¹ä¸­æ‰¾åˆ°å¤åˆ¶ï¼Œç„¶åå†æŠŠè¿™ä¸ªæ“ä½œé‡å¤ä¸€éï¼Œè¿›è¡Œç²˜è´´ã€‚å‡ ä¹æ‰€æœ‰æˆ‘è®¤è¯†çš„äººéƒ½æ˜¯å¾ˆæ—©å°±æ‡‚å¾—ä½¿ç”¨é”®ç›˜æ¥è¿›è¡Œå¤åˆ¶/ç²˜è´´æ“ä½œï¼Œå³ä½¿æ˜¯é‚£äº›é IT å²—çš„åŒäº‹ã€‚</p>
<p>ä½†è¿™åªæ˜¯å†°å±±ä¸€è§’ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†äººåœ¨ <strong>Ctrl-C/V</strong> ä¹‹å‰ä»ç„¶éœ€è¦ç”¨é¼ æ ‡é€‰ä¸­æ–‡å­—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <strong>Ctrl-Shift-æ–¹å‘é”®</strong> æˆ–è€…æ˜¯ <strong>Shift-End/Home</strong>ã€‚å¤§éƒ¨åˆ†äººä½¿ç”¨å›é€€é”®åˆ é™¤æ‰“é”™çš„å­—æ¯ï¼Œè€Œä¸ä¼šä½¿ç”¨ <strong>Ctrl-Backspace</strong> æ¥åˆ é™¤æ•´ä¸ªå•è¯å†é‡æ–°è¾“å…¥ã€‚è¿˜æœ‰è®¸å¤šäººä½¿ç”¨é¼ æ ‡åœ¨ç¨‹åºçª—å£ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <strong>Alt-Tab</strong> ç»„åˆé”®ã€‚</p>
<p>å¾ˆéš¾å»è§£é‡Šä¸ºä»€ä¹ˆåƒç”¨é¼ æ ‡æ“ä½œè¿™ä¹ˆç®€ç®€å•å•çš„äº‹æƒ…ï¼Œå…¶å®ä¼šæµªè´¹å¤§é‡æ—¶é—´ã€‚è€Œä¸”å¤§éƒ¨åˆ†äººå¹¶æ²¡æœ‰æ„è¯†åˆ°ï¼Œå› ä¸ºæ¯”èµ·ä½¿ç”¨å¿«æ·é”®ï¼Œé¼ æ ‡æ“ä½œå¤šèŠ±çš„æ—¶é—´å°‘å¾—å¯æ€œã€‚ä½†æ˜¯æˆ‘å¯ä»¥å‘ä½ ä¿è¯ï¼Œä¾èµ–é¼ æ ‡çš„äººï¼Œä¸€å¤©ä¼šå¤šæµªè´¹ä¸€ä¸ªå°æ—¶ï¼Œç”šè‡³æ›´å¤šçš„æ—¶é—´ã€‚ç”¨è¿™äº›æ—¶é—´å·å·æ‡’ä¼‘æ¯ä¸€ä¸‹æˆ–è€…å†åšç‚¹å·¥<br>
ä½œï¼Œä¸é¦™å—ï¼Ÿ</p>
<blockquote>
<p>æ¯æ¬¡ä½ ç”¨é¼ æ ‡ï¼Œä½ éƒ½å¤šèŠ±äº†åå‡ äºŒåç§’ â€”â€” è¿™è¿˜ä¸ç®—ç”¨é¼ æ ‡æ‰“æ–­ä½ å·¥ä½œèŠ‚å¥çš„ä»£ä»·ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨é”®ç›˜æ¥æ“ä½œæ–‡æœ¬">ä½¿ç”¨é”®ç›˜æ¥æ“ä½œæ–‡æœ¬</h2>
<p>å³ä½¿å¿«æ·é”®å¾ˆç®€å•ï¼Œä½†æ˜¯ä»ç„¶æœ‰ç›¸å½“å¤šäººä¸çŸ¥é“è¿™äº›åŸºæœ¬çš„å¿«æ·æ“ä½œã€‚<br>
å‡ ä¹æ‰€æœ‰çš„æ–‡æœ¬ç¼–è¾‘å™¨éƒ½å¯ä»¥è®©ä½ åšåˆ°ä¸‹é¢è¿™äº›åŸºæœ¬çš„å¿«æ·æ“ä½œï¼Œé•¿æœŸæ¥çœ‹å¯ä»¥å¸®ä½ çœä¸‹å‡ ä¸ªå°æ—¶çš„æ—¶é—´ï¼š</p>
<ul>
<li><strong>Ctrl-Backspace</strong>/<strong>Ctrl-Delete</strong> å¯ä»¥ç›´æ¥æŠŠå·¦/å³çš„å•è¯åˆ é™¤ï¼Œä¸ç”¨ä¸€ä¸ªå­—æ¯ä¸€ä¸ªå­—æ¯çš„åˆ ã€‚</li>
<li><strong>Shift</strong> é”®åŠ ä¸Šæ–¹å‘é”®å¯ä»¥é€‰ä¸­æ–‡å­—ï¼Œå†åŒæ—¶æŒ‰ä¸‹ <strong>Ctrl</strong> é”®çš„è¯ï¼Œå°±æ˜¯ä»¥å•è¯çš„è·¨åº¦æ¥é€‰ä¸­ã€‚<strong>Shift</strong> å’Œ <strong>Home/End</strong> é”®åŒæ—¶æŒ‰ï¼Œç›´æ¥å‘å‰/åé€‰ä¸­ä¸€æ•´è¡Œï¼Œè€Œä¸éœ€è¦æŒ‰ä½ <strong>Shift</strong> é€è¯é€‰ä¸­ã€‚è¿™æ ·ä½ å°±å¯ä»¥ç”¨ <strong>Shift-Backspace-Home/End</strong> ç›´æ¥åˆ é™¤å‰/åä¸€æ•´è¡Œã€‚</li>
<li><strong>Ctrl-æ–¹å‘ä¸Šé”®</strong> åœ¨è®¸å¤šæ–‡æœ¬ç¼–è¾‘å™¨ä¸­å¯ä»¥å¾€ä¸Šè·³ä¸€ä¸ªæ®µè½ï¼Œè™½ç„¶æˆ‘ä¸ç»å¸¸ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªå°æŠ€å·§ç¡®å®å¯ä»¥æ¯”åªç”¨æ–¹å‘é”®æ›´å¿«ã€‚</li>
<li><strong>Ctrl-F</strong> å¯ä»¥æœç´¢å•è¯ï¼Œä¹Ÿå¯ä»¥è®©ä½ å¿«é€Ÿåœ°è·³è½¬åˆ°ç½‘é¡µæˆ–è€…æ–‡æ¡£çš„æŸä¸ªéƒ¨åˆ†ï¼Œå¦‚æœä½ çŸ¥é“è‡ªå·±åœ¨å¯»æ‰¾ä»€ä¹ˆçš„è¯ã€‚<strong>Ctrl-H</strong> å¯ä»¥åœ¨åŒä¸€ä¸ªç¨‹åºä¸­æ‰“å¼€ç›¸åŒçš„çª—å£å¹¶ä¸”æ›¿æ¢æ‰å•è¯/è¯ç»„ã€‚</li>
<li><strong>Ctrl-Home/End</strong> å¯ä»¥è®©ä½ è·³è½¬åˆ°æ–‡æ¡£çš„å¼€å¤´/ç»“å°¾ï¼Œè¿™ä¸ªæŠ€å·§å¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚ä½ åœ¨æŸä¸ªåœ°æ–¹åšäº†æ›´æ­£ï¼Œç„¶åéœ€è¦å†è¿”å›æ–‡æ¡£ç»“å°¾ç»§ç»­ç¼–è¾‘ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¿«æ·é”®ã€‚</li>
</ul>
<h2 id="æµè§ˆå™¨çš„å¿«æ·æ“ä½œ">æµè§ˆå™¨çš„å¿«æ·æ“ä½œ</h2>
<p>å‡ ä¹æ‰€æœ‰æˆ‘è®¤è¯†çš„äººï¼Œéƒ½ä¼šä¾é é¼ æ ‡æ¥æ“ä½œæµè§ˆå™¨ï¼Œå¥½åƒæ²¡æœ‰äººçŸ¥é“å…¶å®ä½ å¯ä»¥ç”¨ <strong>Ctrl-L</strong> è·³è½¬åˆ°åœ°å€æ ï¼Œç„¶åç›´æ¥è¾“å…¥ä½ æƒ³è®¿é—®çš„ç½‘å€ã€‚</p>
<ul>
<li><strong>Ctrl-T</strong> å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨é¡µé¢ã€‚</li>
<li><strong>Ctrl-W</strong> å¯ä»¥å…³é—­å½“å‰é¡µé¢ã€‚</li>
<li><strong>Ctrl-1</strong> åˆ° 8 å¯ä»¥æŒ‰æ’åˆ—é¡ºåºæ‰“å¼€ç›¸åº”çš„é¡µé¢ï¼Œ<strong>Ctrl-9</strong> åˆ™æ€»æ˜¯ä¼šè·³è½¬åˆ°æœ€åä¸€ä¸ªé¡µé¢ã€‚</li>
<li><strong>Ctrl-PageUp/PageDown</strong> å¯ä»¥åœ¨æ‰“å¼€çš„é¡µé¢ä¸­é€ä¸ªæ¥å›ç©¿æ¢­ï¼Œ<strong>PageUp/PageDown</strong> åˆ™å¯ä»¥è®©ä½ ä¸Šä¸‹æ»šåŠ¨é¡µé¢ã€‚</li>
<li>è¯´åˆ°æ»šåŠ¨é¡µé¢ï¼šä½ è¿˜å¯ä»¥ç”¨ç©ºæ ¼é”®å¾€ä¸‹æ»šåŠ¨é¡µé¢ï¼Œå¾ˆæ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯ä½ å¦ä¸€åªæ‰‹å¾ˆå¿™çš„æ—¶å€™...ç«¯ç€æ°´æ¯å–æ°´ï¼ŒåŒæ—¶åˆèƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚</li>
<li><strong>Ctrl-R</strong> ä¼šé‡æ–°åŠ è½½é¡µé¢ï¼Œå’Œ <strong>F5</strong> åŠŸèƒ½ä¸€æ ·ã€‚</li>
<li>æµè§ˆå™¨çš„åœ°å€æ åŒæ—¶ä¹Ÿæ˜¯æœç´¢æ ï¼Œæ‰€ä»¥ç›´æ¥åœ¨åœ°å€æ é‡Œè¾“å…¥ä½ è¦æœç´¢çš„ä¸œè¥¿å°±å¯ä»¥å•¦ï¼Œä¸éœ€è¦å…ˆæ‰“å¼€ <strong>google</strong>ã€‚</li>
</ul>
<h2 id="æµè§ˆå™¨çš„é«˜é˜¶å¿«æ·æ“ä½œ">æµè§ˆå™¨çš„é«˜é˜¶å¿«æ·æ“ä½œ</h2>
<p>è¿™äº›æ“ä½œéœ€è¦ä½ å®‰è£…ä¸€ä¸ªå«åš <strong>Vimium</strong> çš„ chrome æµè§ˆå™¨æ’ä»¶ï¼Œè¿™ç©æ„æ˜¯è‡ªåˆ‡é¢åŒ…æœºå‘æ˜ä»¥æ¥æœ€å¥½çš„ä¸œè¥¿äº†ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ’ä»¶ï¼Œä½ å°±å¯ä»¥åœ¨ç½‘ç«™é‡Œè‡ªå¦‚ç©¿æ¢­ï¼Œæ»šåŠ¨é¡µé¢ï¼ŒæŸ¥æ‰¾å’Œç‚¹å‡»é“¾æ¥ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œéƒ½ä¸éœ€è¦å€ŸåŠ©é¼ æ ‡ã€‚å¦‚æœä½ äº†è§£å„ç±» IDE å¦‚ VS/VSCode/Jetbrains çš„å¤šå¿«æ·é”®æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªæ’ä»¶ä¼šè®©ä½ å¦‚è™æ·»ç¿¼ï¼Œè€Œä¸”è¿™ä¸ªæ’ä»¶å­¦èµ·æ¥è¶…å¿«çš„ï¼</p>
<p>æ¯”å¦‚åœ¨ VSCode ä¸­ï¼Œ<strong>Ctrl-KD</strong> è¿™ä¸ªå¿«æ·é”®ä»£è¡¨ç€æŒ‰ä½ <strong>Ctrl</strong> é”®ï¼Œç„¶åæŒ‰ <strong>K</strong> å’Œ <strong>D</strong>ï¼Œè¿™æ ·ä½ çš„ä»£ç å°±ä¼šè‡ªåŠ¨æ•´ç†æˆä¼˜ç¾çš„æ ¼å¼ã€‚è¿™ä¸ªå¿«æ·é”®æœ€å¼€å§‹æœ‰ç‚¹ä»¤äººè¿·æƒ‘ï¼Œä½†æ˜¯å®ƒå·²ç»æˆäº†æˆ‘æœ‰ç”Ÿä»¥æ¥çš„æœ€æ£’çš„å¿«æ·é”®ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒæ„å‘³ç€å‡ ä¹æ‰€æœ‰æˆ‘ç”¨çš„åº”ç”¨ç¨‹åºä¸­çš„åŠŸèƒ½ï¼Œéƒ½å¯ä»¥æœ‰å¯¹åº”çš„å¿«æ·æ“ä½œï¼Œæˆ‘å¯ä»¥æŠŠä»–ä»¬ä¸­æˆ‘æœ€éœ€è¦çš„é‚£äº›ç»™è®°ä½ã€‚è€Œä¸”ï¼Œå¦‚æœæˆ‘çœŸçš„ä¸è®°å¾—çš„äº†è¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç”¨é¼ æ ‡ï¼Œåœ¨çª—å£ï¼Œèœå•æ ï¼Œé€‰é¡¹é‡Œéšæ„æœç´¢ï¼Œç›´åˆ°æˆ‘å‘ç°æˆ‘éœ€è¦çš„åŠŸèƒ½è—åœ¨å“ªé‡Œã€‚</p>
<p>å®‰è£…äº† Vimium ä»¥åï¼Œåªéœ€ç®€å•æŒ‰ä¸‹ â€œ<strong>F</strong>â€ ç„¶åç½‘é¡µå°±ä¼šå˜æˆè¿™æ ·ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615726671890.png" alt="ä¸ºä»€ä¹ˆæˆ‘è€å©†ä¸å†çˆ±æˆ‘äº†ï¼Ÿ" loading="lazy"></figure>
<p>ç„¶ååªéœ€è¦ç¡®å®šä½ è¦æ‰“å¼€çš„é“¾æ¥ï¼Œæ¯”å¦‚æŒ‰ä¸‹ â€œ<strong>P</strong>â€ é”®ï¼Œä½ å°±èƒ½çŸ¥é“ä¸ºä»€ä¹ˆä½ çš„è€å©†å¯¹ä½ è¿™ä¹ˆå†·æ·¡ï¼Œå´å¯¹éš”å£é‚£ä¸ªæ‡‚å¾—ä¿®ç†é©¬æ¡¶çš„è€ç‹é‚£ä¹ˆäº²æ˜µï¼Œå¯æ˜¯ä»–æ˜æ˜ä»€ä¹ˆå¿«æ·é”®éƒ½ä¸æ‡‚å•Šï¼Œæ¯”ä½ å·®è¿œå•¦ï¼</p>
<p>è¿˜æœ‰è®¸å¤šå¥½ç”¨çš„å¿«æ·é”®,ä½†æ˜¯æˆ‘ç»™ä½ ä»‹ç»çš„è¿™äº›åˆçº§å¿«æ·é”®ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªå·±ç”¨å¾—æœ€å¤šçš„ã€‚è¿˜æœ‰çš„ï¼Œæ¯”å¦‚åƒ <strong>j/k</strong> å¯ä»¥è®©ä½ éå¸¸é¡ºæ»‘åœ°æ»šåŠ¨é¡µé¢ã€‚å¦‚æœä½ ç”¨ç©ºæ ¼é”®è§‰å¾—æ»šåŠ¨å¤ªå¿«äº†ï¼Œé‚£ä¸å¦¨è¯•è¯•è¿™ä¸ªã€‚</p>
<h2 id="æˆ‘çš„ç”µè„‘å…¶å®å°±æ˜¯æµè§ˆå™¨">â€œæˆ‘çš„ç”µè„‘â€å…¶å®å°±æ˜¯æµè§ˆå™¨</h2>
<p>è®¸å¤šäººæ²¡æœ‰æ„è¯†åˆ°çš„æ˜¯ï¼Œâ€œæˆ‘çš„ç”µè„‘â€å…¶å®å°±æ˜¯ä¸€ä¸ªæµè§ˆå™¨ï¼Œæµè§ˆå™¨çš„å¿«æ·é”®åŒæ ·é€‚ç”¨ã€‚</p>
<ul>
<li><strong>Win-E</strong> æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨ã€‚</li>
<li><strong>Ctrl-L</strong> å¯ä»¥è®©ä½ è·³è½¬åˆ°åœ°å€æ ï¼Œç„¶åä½ å¯ä»¥è¾“å…¥æ–‡ä»¶åœ°å€ã€‚</li>
<li><strong>tab</strong>ï¼Œ<strong>shift</strong> å’Œæ–¹å‘é”®å¯ä»¥é€‰ä¸­æ–‡ä»¶ã€‚<strong>F2</strong> å¯ä»¥é‡å‘½åã€‚</li>
</ul>
<h2 id="é™¤æ­¤ä»¥å¤–æ˜¯æ—¶å€™ç”¨ä¸Šä½ çš„æ§åˆ¶å°äº†">é™¤æ­¤ä»¥å¤–ï¼Œæ˜¯æ—¶å€™ç”¨ä¸Šä½ çš„æ§åˆ¶å°äº†</h2>
<p>æˆ‘ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰åœ¨ç°å®ä¸­æœ‰å¹¸çœ‹è¿‡åˆ«äººç”¨æ§åˆ¶å°è¡¨æ¼”å¥‡è¿¹æ·«å·§ï¼Œä»–ä»¬å¯èƒ½ä¼šè¯´äº›è¿™æ ·çš„è¯ï¼Œâ€œå¯¹,åªè¦ cd åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹,ç„¶åè·‘ build.ps1,é—®é¢˜åº”è¯¥å°±è§£å†³äº†â€ ã€‚</p>
<p>å…¶å®è¿™äº›è¯åˆ«äººå‹æ ¹å¬ä¸æ‡‚ã€‚ç”šè‡³æœ‰äº›å¼€å‘äººå‘˜ä¹Ÿä¸æ‡‚ï¼Œæ¯•ç«Ÿï¼Œå¦‚æœä½ ä¸ cd åˆ°é‚£ä¸ªç›®å½•ï¼Œä½ è·‘ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p>
<p>åœ¨å·¥ä½œä¸­è¦å–„ç”¨è¿™äº›å‘½ä»¤ã€‚å½“ç„¶ï¼ŒGit æ˜¯æœ‰ GUI ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯æœ‰å¿…è¦ç”¨å—ï¼Ÿè¿˜æ˜¯æ‰“å¼€ pwershell æˆ–è€… cmdï¼Œè¾“å…¥ git å‘½ä»¤ï¼Œè®°å¾—æäº¤ä»£ç è¦åŠ è¯´æ˜ä¿¡æ¯ï¼Œæ¯”å¦‚â€œä¿®å¤äº†ä¸€ä¸ª bugâ€ã€‚</p>
<p>åœ¨ VSCode ä¸­é›†æˆäº†ä¸€ä¸ªç»ˆç«¯ï¼Œå¬èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯ç”¨äº†ä¹‹åï¼ŒçœŸé¦™ï¼æˆ‘ç”¨çš„æ˜¯å¾·æ–‡é”®ç›˜ï¼Œç”¨ <strong>Ctrl-Ã–</strong>  å°±èƒ½æ‰“å¼€ç»ˆç«¯ï¼Œè€Œä¸”å¾ˆå®¹æ˜“è®°å¿†ï¼Œå› ä¸ºå¾·æ–‡é‡Œç»ˆç«¯çš„å•è¯å°±æ˜¯ Ã–konsoleã€‚å¯ä»¥è¯´ååˆ†å‹å¥½äº†ã€‚<strong>Ctrl-P</strong> å¯ä»¥æ‰“å¼€å‘½ä»¤ç›˜ï¼ˆpanï¼‰ï¼Œåœ¨é‡Œé¢æ‰¾åˆ°æ‰€æœ‰é€šç”¨çš„ VSCode åŠŸèƒ½ã€‚</p>
<p><strong>Tab</strong> é”®åœ¨ç»ˆç«¯ä¸­å¯ä»¥ç”¨ä½œè‡ªåŠ¨è¡¥å…¨ã€‚å¤šæ¬¡æŒ‰ä¸‹ <strong>tab</strong> é”®åœ¨æç¤ºå‡ºçš„å¯é€‰é¡¹ä¸­åˆ‡æ¢ï¼Œ<strong>Shift-tab</strong> å¯ä»¥å›åˆ°ä¸Šä¸€ä¸ªå¯é€‰é¡¹ã€‚</p>
<p>ä½¿ç”¨æ–¹å‘ä¸Šé”®ä¼šè‡ªåŠ¨è¾“å…¥ä¸Šä¸€ä¸ªå‘½ä»¤ï¼Œä½ å¯ä»¥ä¿®å¤ä¸€ä¸‹è¯­æ³•é”™è¯¯ã€‚å¦‚æœä½ ä¸å°å¿ƒå·²ç»æäº¤åˆ°äº† master åˆ†æ”¯çš„è¯ï¼Œæ•™ä½ ä¸€ä¸ªç¥å¥‡çš„å‘½ä»¤ï¼Œgit -unfuck -everythingï¼Œç„¶åä¸€åˆ‡éƒ½å˜å¥½äº†ï¼Œä¸éœ€è¦ rebase å’Œ mergeã€‚</p>
<h2 id="å°‘è£…é€¼è¦è°¦è™šå¥½å­¦å¥½é—®æ‰æ˜¯çœŸç†">å°‘è£…é€¼ï¼Œè¦è°¦è™šï¼Œå¥½å­¦å¥½é—®ï¼Œæ‰æ˜¯çœŸç†</h2>
<p>è™½ç„¶æˆ‘å†™äº†è¿™ä¹ˆå¤šï¼Œè‹¦å£å©†å¿ƒï¼Œä½†æ˜¯æˆ‘çŸ¥é“æ²¡æœ‰å‡ ä¸ªäººä¼šå¬å¾—è¿›å»ã€‚å¦‚æœä½ è¯»åˆ°äº†è¿™é‡Œï¼Œä¸æ˜¯å› ä¸ºæˆ‘çš„çœŸå¿ƒæ‰“åŠ¨äº†ä½ ï¼Œè€Œæ˜¯å› ä¸ºä½ æ›¾ç»çœ‹è¿‡æŸäººç”¨é”®ç›˜è£…é€¼ï¼Œé‚£ç§æ„Ÿè§‰ï¼Œä½ ä¹Ÿæƒ³æœ‰ã€‚<br>
é‚£æ—¶å€™çš„ä½ æƒ³çŸ¥é“å¦‚ä½•æ‰èƒ½ç»ƒå°±é”®ç›˜è£…é€¼å¤§æ³•ï¼Œç°åœ¨æˆ‘å‘Šè¯‰ä½ äº†ï¼Œç»™ä½ æŒ‡äº†ä¸€æ¡æ˜è·¯ã€‚ç­‰ä½ å­¦æˆä¹‹åï¼Œä½ å°±ä¸å†éœ€è¦å¼‚æ€§äº†ï¼ˆè€å©†ç®—ä¸ªå•¥ï¼Ÿï¼‰ï¼Œå› ä¸ºæ²¡æœ‰äººä¼šåƒé”®ç›˜é‚£æ ·æ¥å—ä½ äº²å¯†çš„æŠšæ‘¸ï¼Œä¹Ÿæ²¡æœ‰äººä¼šåƒä½ çš„ç”µè„‘ä¸€æ ·æ‡‚ä½ éœ€è¦ä»€ä¹ˆã€‚</p>
<p>æ­å–œï¼Œä½ è·¨è¿‡äº†è¿™é“åã€‚å³ä½¿ä½ è¿˜ç°åœ¨è¿˜æ²¡æœ‰ç§ƒé¡¶ï¼Œç”šè‡³å¤´å‘æµ“å¯†ï¼Œä½†ä½ å·²ç»èµ°ä¸Šèªæ˜ç»é¡¶çš„é“è·¯ã€‚ç›¸ä¿¡æˆ‘ï¼Œå½“åˆ«äººçœ‹åˆ°ä½ ç”¨é”®ç›˜ç°åœºè£…é€¼çš„æ—¶å€™ï¼Œä»–ä¹Ÿä¸€å®šä¼šæƒ³è·Ÿä½ å­¦ä¸€æ‰‹çš„ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[è¯‘æ–‡]ç»™èœé¸Ÿçœ‹çš„-Android-Architecture-Components-(å®‰å“æ¶æ„ç»„ä»¶)çŸ¥è¯†ï¼ˆkotlinï¼‰]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/gei-cai-niao-kan-de-android-architecture-components-an-zhuo-jia-gou-zu-jian-zhi-shi-kotlin/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/gei-cai-niao-kan-de-android-architecture-components-an-zhuo-jia-gou-zu-jian-zhi-shi-kotlin/">
        </link>
        <updated>2019-05-28T12:23:51.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸ºè¯‘æ–‡ï¼ŒåŸæ–‡é“¾æ¥ï¼š<br>
<a href="https://medium.com/@elye.project/android-architecture-components-for-dummies-in-kotlin-50-lines-of-code-29b29d3a381">https://medium.com/@elye.project/android-architecture-components-for-dummies-in-kotlin-50-lines-of-code-29b29d3a381</a></p>
<p>ä»¥å‰å†™ android ç¨‹åºæ—¶ï¼Œåªéœ€è¦æŠŠæ‰€æœ‰ä»£ç å†™åœ¨ Activity ä¸­å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-java">class MainActivity : AppCompatActivity() {
    private var count = 0

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        my_container.setOnClickListener { incrementCount() }
    }

    override fun onResume() {
        super.onResume()
        incrementCount()
    }

    private fun incrementCount() {
        my_text.text = (++count).toString()
    }
}
</code></pre>
<p>ä»…ä»…ç”¨å°äº 20 è¡Œçš„ä»£ç ï¼Œä½ å°±å¯ä»¥å®ç°ä¸€ä¸ªè®¡æ•°ç¨‹åºï¼Œç»Ÿè®¡æ¯æ¬¡ä½ ç‚¹å‡»å’Œå‰å°æ˜¾ç¤º App çš„æ¬¡æ•°ã€‚<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615724725735.png" alt="æˆ¿å­.png" loading="lazy"><br>
è¿™æ ·çš„ä»£ç è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å´éš¾ä»¥æ‰©å±•æˆä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œå°±åƒä¸Šå›¾ä¸­çš„å°æˆ¿å­ä¸€æ ·ï¼Œæœ‰å¾ˆå¤šé—®é¢˜ï¼š<br>
1ã€å¦‚æœä½ æ—‹è½¬ä½ çš„è®¾å¤‡ï¼Œ<code>count</code> ä¼šè¢«é‡ç½®ä¸º 0<br>
2ã€è¿™æ ·çš„ä»£ç å¾ˆéš¾è¿›è¡Œå•å…ƒæµ‹è¯•<br>
3ã€æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ª class é‡Œé¢ï¼Œä¼šè®©å¼€å‘è€…å˜ç¬¨å˜è¿Ÿé’ã€‚ä¹Ÿè®¸ä½ æ˜¯ä¸ªèœé¸Ÿï¼Œä½†ä½ ä¸€å®šä¸æƒ³å˜æˆç¬¨ç¬¨çš„å¼€å‘è€…ã€‚</p>
<h2 id="ä»£ç æ¶æ„">ä»£ç æ¶æ„</h2>
<p>æœ‰è®¸å¤šä¸­æ–¹æ³•å¯ä»¥æ›´å¥½åœ°ç»„ç»‡ä½ çš„ä»£ç ç»“æ„ã€‚æœ€åŸºæœ¬çš„æ–¹æ³•å°±æ˜¯æŠŠä»£ç æ‹†åˆ†æˆä¸åŒçš„ class ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º <strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ã€‚<br>
ä½ å¯èƒ½å¬è¯´è¿‡ MVP ã€MVC ã€MVVM...å¦‚æœä½ å¾ˆäº†è§£è¿™äº›æ¦‚å¿µå¹¶ä¸”è¿ç”¨è‡ªå¦‚ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¸ç”¨çœ‹è¿™ç¯‡æ–‡ç« äº†ï¼Œå»å–æ¯å’–å•¡ç„¶åå¹²åˆ«çš„äº‹æƒ…å§</p>
<p>å¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£ä¹ˆè¯·ç»§ç»­è¯»ä¸‹å»...</p>
<p>ç®€å•æ¥è¯´ï¼Œé€šè¿‡æŠŠé€»è¾‘ä»£ç å°½å¯èƒ½å¤šåœ°ä» Activity å½“ä¸­ç§»åˆ°åˆ«çš„ç±»å½“ä¸­å°±å¯ä»¥å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚ä½ åœ° Activity åªä¼šå»å¤„ç†å’Œ Android æœ¬èº«ç›¸å…³åœ°å·¥ä½œï¼Œä»¥åŠ UI çš„æ›´æ–°ã€‚è®©åˆ«çš„ç±»æ¥å¤„ç†é‡è¦çš„é€»è¾‘äº‹åŠ¡ã€‚<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615724796401.png" alt="åˆ†ç¦»è§†å›¾å’Œé€»è¾‘.png" loading="lazy"><br>
è¿™æ ·çš„è¯ã€‚ä»»ä½• LifeCycle äº‹ä»¶éƒ½ç”± Activity é€šçŸ¥ Logic class ï¼ŒåŒæ—¶å¯¹äºä»»ä½•æ•°æ®çš„æ”¹å˜ï¼Œä½ çš„ Logic class éƒ½ä¼šå°†å…¶é€šçŸ¥åˆ° Activity ã€‚<br>
å¾ˆç®€å•å§ï¼Ÿè™½ç„¶å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯æ¯ä¸ªäººå…·ä½“å®ç°çš„æ–¹å¼éƒ½ä¸åŒã€‚è¿™å°±æ˜¯ MVP ã€MVC  ã€MVVM ï¼ˆæˆ‘ç”šè‡³å¬è¿‡ MVVMIï¼‰çš„ç”±æ¥ã€‚å³ä½¿æ˜¯åŒä¸€ç§æ¶æ„ï¼Œä»£ç å†™æ³•ä¹Ÿä¼šæœ‰è®¸å¤šä¸åŒã€‚</p>
<h2 id="è°·æ­Œçœ‹ä¸ä¸‹å»äº†">è°·æ­Œçœ‹ä¸ä¸‹å»äº†</h2>
<p>å¼€å‘è€…ä½¿ç”¨å„ç§æ¶æ„ã€å„ç§æ–¹æ³•æ¥åˆ†ç¦»è§†å›¾å’Œé€»è¾‘å±‚ï¼Œé‚£ä¹ˆå“ªç§æ˜¯æœ€å¥½çš„å‘¢ï¼Ÿäººä»¬å¿ä¸ä½é—®è°·æ­Œã€‚äºæ˜¯åœ¨ 2017 çš„ Google IO å¤§ä¼šä¸Šï¼ŒGoogle å†³å®šæå‡ºä»–è‡ªå·±çš„è§£å†³æ–¹æ¡ˆã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„ Android Architecture Components (å®‰å“æ¶æ„ç»„ä»¶)ã€‚<br>
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçœ‹èµ·æ¥å’Œå‰æ–‡çš„å›¾å‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯æœ‰äº†æ›´æ¸…æ¥šçš„å‘½åã€‚<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615724887879.png" alt="" loading="lazy"></p>
<h2 id="ä»€ä¹ˆæ˜¯-mvvmmodel-view-viewmodel">ä»€ä¹ˆæ˜¯ MVVMï¼ˆModel View ViewModel)ï¼Ÿ</h2>
<p>å½“ä½ çœ‹è§ ViewModel è¿™ä¸ªè¯çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šå¾ˆå®¹æ˜“çš„å°±è”æƒ³åˆ° MVVM ã€‚ä½†æ˜¯ MVVM åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ<br>
ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯åŸºäº <a href="%5Bhttps://en.wikipedia.org/wiki/Observer_pattern%5D(https://en.wikipedia.org/wiki/Observer_pattern)">è§‚å¯Ÿè€…</a> æ¨¡å¼å®ç°çš„æ¶æ„ã€‚<br>
åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä¿¡æ¯çš„æä¾›è€…å¹¶ä¸çŸ¥é“è°éœ€è¦ä»–å»æä¾›è¿™äº›ä¿¡æ¯ã€‚ä½†æ˜¯å¯¹è¿™äº›ä¿¡æ¯æ„Ÿå…´è¶£çš„äººä¼šå¯¹å…¶è¿›è¡Œè®¢é˜…ï¼Œä¸€æ—¦ä¿¡æ¯å‘å¸ƒï¼Œå°±å¯ä»¥è·å–åˆ°éœ€è¦çš„ä¿¡æ¯ã€‚<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615724954175.png" alt="å°±åƒä½ è®¢é˜…ä¸€ä¸ª B ç«™ UP ä¸»ä¸€æ ·ï¼Œä»–ä»¬ä¸€æ›´æ–°ï¼Œä½ å°±èƒ½å¾—åˆ°é€šçŸ¥" loading="lazy"><br>
è¿™æ ·ï¼Œä½ å¤§æ¦‚å°±èƒ½çŒœåˆ°ï¼š<br>
1ã€ViewModel é€šè¿‡ Activity çš„ LifeCycle å¯¹è±¡è®¢é˜… Activity ï¼Œä»¥ä¾¿åœ¨ LifeCycleEvents å‘ç”Ÿæ—¶å¾—åˆ°é€šçŸ¥<br>
2ã€Activity é€šè¿‡ViewModel çš„ LiveData å¯¹è±¡è®¢é˜… ViewModel ï¼Œä»¥ä¾¿åœ¨æ•°æ®æ›´æ–°æ—¶å¾—åˆ°é€šçŸ¥</p>
<h2 id="ä½¿ç”¨å®‰å“æ¶æ„ç»„ä»¶">ä½¿ç”¨å®‰å“æ¶æ„ç»„ä»¶</h2>
<p>å¥½äº†ï¼Œç†è®ºå·²ç»è°ˆå¾—è¶³å¤Ÿå¤šäº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆåœ¨ä»£ç ä¸­ä½¿ç”¨ä»–ä»¬ã€‚</p>
<h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3>
<p>åœ¨æˆ‘ç»™å‡ºçš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨ app çš„ build.gradle ä¸­æ·»åŠ ä¸‹é¢çš„ä¾èµ–å°±è¶³å¤Ÿäº†ã€‚è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„åº“ï¼Œä½†æ˜¯ç°åœ¨ä¸éœ€è¦å®ƒä»¬ã€‚</p>
<pre><code>implementation &quot;android.arch.lifecycle:extensions:1.1.0&quot;
</code></pre>
<h3 id="viewmodel-ç±»å’Œå®ƒçš„-livedata">ViewModel ç±»å’Œå®ƒçš„ LiveData</h3>
<p>ä¾èµ–æ·»åŠ å®Œä¹‹åï¼Œå°±åˆ›å»ºä¸€ä¸ª ViewModel ç±»</p>
<pre><code class="language-java">class MyViewModel(private var count: Int = 0) : ViewModel() {
        val changeNotifier = MutableLiveData&lt;Int&gt;()
        fun increment() { changeNotifier.value = ++ count }
}
</code></pre>
<p>ä¸ºäº†èƒ½å¤Ÿæ›´ç®€å•åœ°åœ¨ Activity ä¸­ä½¿ç”¨å®ƒï¼Œæœ€å¥½æ˜¯ç»§æ‰¿è‡ª <code>ViewModel</code> ã€‚ç°åœ¨è¿™ä¸ªç±»ä¸­åŒ…å«äº†<code>count</code>å˜é‡ï¼Œåœ¨æˆ‘ä»¬ç‚¹å‡»æˆ–è€… activity å‡ºç°åœ¨å‰å°æ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨å®ƒè¿›è¡Œ UI çš„æ›´æ–°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åŒ…å«äº† åä¸º <code>changeNotifier</code>çš„ MutableLiveData ã€‚åªè¦<code>count</code>å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»…éœ€è¦ç›¸åº”åœ°æ›´æ–° changeNotifier.value ï¼Œä¸è®ºæ˜¯è°è®¢é˜…äº†å®ƒï¼Œéƒ½èƒ½è·å–æ›´æ–°çš„æ•°æ®ã€‚</p>
<h3 id="åœ¨-mainactivity-ä¸­ä½¿ç”¨-viewmodel">åœ¨ MainActivity ä¸­ä½¿ç”¨ ViewModel</h3>
<p>å®Œæˆäº†ä¸Šè¿°å·¥ä½œï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª ViewModel ç±»æä¾›ç»™æˆ‘ä»¬çš„ MainActivityã€‚</p>
<pre><code class="language-java">class MainActivity : AppCompatActivity() {
    private val viewModel: MyViewModel by lazy {
        ViewModelProviders.of(this).get(MyViewModel::class.java)
    }

    private val changeObserver =
            Observer&lt;Int&gt; { 
                 value -&gt; value?.let { incrementCount(value) } 
            }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        viewModel.changeNotifier.observe(this, changeObserver)
        my_container.setOnClickListener { viewModel.increment() }
    }

    private fun incrementCount(value: Int) {
        my_text.text = (value).toString()
    }
}
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨äº†<code>lazy</code>å…³é”®è¯æ¥åˆ›å»º<code>viewModel</code>ï¼Œè¿™æ˜¯è°·æ­Œæ¨èçš„æ–¹æ³•</p>
<pre><code class="language-java">private val viewModel: MyViewModel by lazy {
        ViewModelProviders.of(this).get(MyViewModel::class.java)
    }
</code></pre>
<p>ä¹‹åï¼Œ æˆ‘ä»¬çš„ä»£ç å†™å‡ºäº†è·å–æ¶ˆæ¯çš„è¡Œä¸ºä»¥åŠè·å¾—æ¶ˆæ¯åå¹²ä»€ä¹ˆã€‚åœ¨ Kotlin ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ lambda è¡¨è¾¾å¼ï¼Œè¿™æ ·ä¼šè®©ä»£ç çœ‹èµ·æ¥æ›´å¹²å‡€ã€‚</p>
<pre><code class="language-java">private val changeObserver =
            Observer&lt;Int&gt; { 
                 value -&gt; value?.let { incrementCount(value) } 
            }
</code></pre>
<p>ä¹‹åæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸‹é¢çš„ä»£ç å°† <code>changeObserver</code>æ³¨å†Œåˆ°<code>viewModel</code>ã€‚</p>
<pre><code class="language-java">viewModel.changeNotifier.observe(this, changeObserver)
</code></pre>
<p>æœ€åï¼Œ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•ä» UI å»è§¦å‘æ•°æ®çš„å˜åŒ–ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯é€šè¿‡ç‚¹å‡»äº‹ä»¶ã€‚</p>
<pre><code class="language-java">my_container.setOnClickListener { viewModel.increment() }
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615725024720.png" alt="äº‹ä»¶è§¦å‘æµç¨‹" loading="lazy"></figure>
<p>ä» MainActivity åˆ° ViewModel  å†å›åˆ° MainActivity å°±åƒæ˜¯ä¸€è¶Ÿå¾€è¿”çš„è·¯é€”ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠæ‰€æœ‰çš„äº‹æƒ…éƒ½æ”¾åˆ° MainActivity ä¸­æ¥åšï¼Œè¿™æ ·è™½ç„¶çœ‹èµ·æ¥å¤æ‚äº†ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬å´æ­å»ºäº†ä¸€ä¸ªå¥½çš„ App æ¶æ„ã€‚è¿™æ ·å°±èƒ½æŠŠé€»è¾‘ä»£ç å…¨éƒ¨è½¬ç§»åˆ° ViewModel ä¸­è€Œä¸æ˜¯ MainActivity ã€‚</p>
<h3 id="è®©-viewmodel-æ„ŸçŸ¥åˆ°-activity-çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–">è®© ViewModel æ„ŸçŸ¥åˆ° Activity çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–</h3>
<p>ä¸ºäº†è®© ViewModel æ„ŸçŸ¥åˆ° Activity çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒå®ç° <code>LifeCycleObserver</code>æ¥å£ã€‚</p>
<pre><code class="language-java">class MyViewModel(private var count: Int = 0) : ViewModel(),   
    LifecycleObserver {
    val changeNotifier = MutableLiveData&lt;Int&gt;()
    fun increment() { changeNotifier.value = ++count }

    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME) 
    fun onResume() { increment() }
}
</code></pre>
<p>ä½ çš„ <code>viewModel</code>ä¾èµ–äºå“ªä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå°±æ·»åŠ ä¸€ä¸ª @OnLifecycleEvent æ³¨è§£ã€‚<br>
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªå¯¹ ON_RESUME æ„Ÿå…´è¶£ã€‚<br>
åšå®Œè¿™æ­¥åï¼Œæˆ‘ä»¬éœ€è¦è®©<code>viewModel</code>è®¢é˜… <code>MainActivity</code>çš„<code>Lifecycle</code>äº‹ä»¶ã€‚åœ¨æœ€æ–°ç‰ˆæœ¬çš„ <code>AppCompatActivity</code> ç±»ä¸­ï¼Œ<code>LifeCycle</code>å·²ç»æ·»åŠ è¿›æ¥äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨<code>onCreate</code>å‡½æ•°ä¸­å®ç°å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        viewModel.changeNotifier.observe(this, changeObserver)
        lifecycle.addObserver(viewModel)             
        my_container.setOnClickListener { viewModel.increment() }
    }
</code></pre>
<p><img src="https://ultimateHandsomeBoy666.github.io//post-images/1615725047082.png" alt="ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥" loading="lazy"><br>
ç°åœ¨<code>viewModel</code>å°±ä¸éœ€è¦è®©<code>MainActivity</code>åœ¨æ¯ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶å‘ç”Ÿæ—¶ä¸»åŠ¨åœ°è°ƒç”¨<code>viewModel</code>çš„æ–¹æ³•ã€‚åªéœ€è¦åˆé€‚çš„<code>@OnLifeCycleEvent</code>æ³¨è§£ï¼Œ<code>viewModel</code>å°±ä¼šè¢«é€šçŸ¥åˆ°å¹¶ä¸”æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚</p>
<h3 id="å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘æ—‹è½¬è®¾å¤‡äº†">å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘æ—‹è½¬è®¾å¤‡äº†</h3>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ‰©å±•æˆ‘ä»¬åœ° App ï¼Œåœ¨<code>viewModel</code>ä¸­å®ç°æ›´å¤æ‚åœ°é€»è¾‘ã€‚å¹¶ä¸”ï¼Œç›¸æ¯”äº<code>Activity</code>,æˆ‘ä»¬åœ¨å¯ä»¥åœ¨<code>viewModel</code>ä¸­æ›´å¥½åœ°è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚<br>
é™¤æ­¤ä¹‹å¤–ï¼Œæœ€é‡è¦åœ°ä¸€ç‚¹æ—¶ï¼Œå½“æˆ‘ä»¬æ—‹è½¬è®¾å¤‡æ—¶ï¼Œ<code>count</code>ä¸ä¼šå†è¢«é‡ç½®ä¸º 0 ã€‚å®ƒçš„å€¼è¢«ä¿å­˜ä¸‹æ¥äº†ï¼Œå› ä¸º Android å†…éƒ¨å®ç°äº†åœ¨ ViewModel ä¸­ä¿å­˜æ•°æ®çš„æœºåˆ¶ï¼Œä¸éœ€è¦ä½ å»æ˜¾å¼åœ°ä¿å­˜å®ƒã€‚</p>
<h3 id="ä½†ä¹Ÿä¸è¦é«˜å…´åœ°å¤ªæ—©">ä½†ä¹Ÿä¸è¦é«˜å…´åœ°å¤ªæ—©</h3>
<p>è™½ç„¶ ViewModel å¯ä»¥å¾ˆå¥½åœ°ä¿å­˜æ•°æ®ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€<code>onSaveInstanceState</code>å°±æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚å¦‚æœ Activity è¢«è¿›ç¨‹è¢«ç³»ç»Ÿæ€æ­»ï¼Œé‚£ä¹ˆ<code>count</code>åœ°å€¼å°±ä¸ä¼šè¢«ä¿å­˜ã€‚<br>
ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ·»åŠ äº†å¤„ç†<code>savedInstanceState</code>çš„é€»è¾‘ä»£ç ã€‚</p>
<pre><code class="language-java">class MainActivity : AppCompatActivity() {
    private val viewModel: MyViewModel by lazy {
        ViewModelProviders.of(this).get(MyViewModel::class.java)
    }

    private val changeObserver = Observer&lt;Int&gt; { 
                  value -&gt; value?.let { incrementCount(value) } 
            }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        viewModel.restoreState(savedInstanceState)
        viewModel.changeNotifier.observe(this, changeObserver)
        lifecycle.addObserver(viewModel)
        my_container.setOnClickListener { viewModel.increment() }
    }

    override fun onSaveInstanceState(outState: Bundle) {
        super.onSaveInstanceState(outState)
        viewModel.saveState(outState)
    }

    private fun incrementCount(value: Int) {
        my_text.text = (value).toString()
    }
}

class MyViewModel(private var count: Int = 0) : ViewModel(), 
    LifecycleObserver {
    companion object { const val COUNT_KEY = &quot;CountKey&quot; }

    val changeNotifier = MutableLiveData&lt;Int&gt;()

    fun increment() { changeNotifier.value = ++count }

    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME) 
    fun onResume() { increment() }

    fun saveState(outState: Bundle) {
        outState.putInt(COUNT_KEY, count)
    }

    fun restoreState(inState: Bundle?) {
        inState?.let { count = inState.getInt(COUNT_KEY) }
    }
}
</code></pre>
<p>è¿™æ ·ï¼Œä¸è®ºæ˜¯æ—‹è½¬è®¾å¤‡è¿˜æ˜¯è¿›ç¨‹è¢«æ€æ­»ï¼Œä½ çš„<code>count</code>å€¼éƒ½å¯ä»¥è¢«ä¿ç•™ä¸‹æ¥ã€‚</p>
<p>æºç å¯ä»¥ä»ä»¥ä¸‹é“¾æ¥è·å¾—ï¼š<br>
https://github.com/elye/demo_android_architecture_components?source=post_page-----29b29d3a381----------------------</p>
<h3 id="å…³äº-viewmodel-å†è¯´ä¸€ç‚¹">å…³äº ViewModel ï¼Œå†è¯´ä¸€ç‚¹</h3>
<p>å¯èƒ½ä¸Šé¢æœ€ç»ˆçš„ä»£ç çœ‹èµ·æ¥æ¯”ä¸€å¼€å§‹ç›´æ¥åœ¨ Activity ä¸­å¤„ç†æ‰€æœ‰äº‹æƒ…çš„ä»£ç è¦é•¿å¾ˆå¤šã€‚ä½†æ˜¯ï¼Œå¦‚åŒç”»æˆ¿å±‹è®¾è®¡å›¾ä¸€æ ·ï¼Œæƒ³è¦å®ç°æ›´å¤šç»†èŠ‚ï¼Œå°±å¿…é¡»æœ‰åˆç†çš„ç»„ç»‡æ¶æ„ï¼Œå³æŠŠé€»è¾‘ä»£ç ä» Activity å½“ä¸­æŠ½ç¦»å‡ºæ¥ã€‚<br>
æˆ‘çš„è§‚ç‚¹æ˜¯ï¼Œå¦‚æœä½ å·²ç»æœ‰ç†Ÿæ‚‰çš„æ¶æ„ï¼Œå¹¶ä¸”è¿ç”¨è‡ªå¦‚ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä¸ç”¨å®‰å“æ¶æ„ç»„ä»¶ï¼Œ Android Architecture Componens ã€‚é™¤éå®ƒèƒ½ä¸ºä»£ç æä¾›æ›´å¥½çš„è¡¨ç°ï¼Œæ¯”å¦‚åœ¨æ€æ­»å’Œæ¢å¤åº”ç”¨è¿›ç¨‹æ—¶ä¿ç•™å˜é‡å€¼ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android å®ç°å›¾è¡¨å®æ—¶æ›´æ–°]]></title>
        <id>https://ultimateHandsomeBoy666.github.io/post/android-shi-xian-tu-biao-shi-shi-geng-xin/</id>
        <link href="https://ultimateHandsomeBoy666.github.io/post/android-shi-xian-tu-biao-shi-shi-geng-xin/">
        </link>
        <updated>2019-05-22T11:05:57.000Z</updated>
        <content type="html"><![CDATA[<p>é¡¹ç›®é‡Œéœ€è¦Appç«¯ä¸æ–­åœ°ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œå®æ—¶ç”Ÿæˆå›¾è¡¨ã€‚å›¾è¡¨æ§ä»¶ä½¿ç”¨çš„æ˜¯<a href="https://github.com/PhilJay/MPAndroidChart">MPAndroidChart</a>ã€‚è‡ªå·±å†™äº†äº›å®æ—¶æ›´æ–°æŠ˜çº¿å›¾çš„demoï¼Œæ•°æ®æ˜¯çº¿ç¨‹éšæœºç”Ÿæˆçš„ï¼Œä¸æ˜¯åå°æ•°æ®ã€‚</p>
<h3 id="1-messageé…åˆhandlerå®ç°">1ã€Messageé…åˆHandlerå®ç°</h3>
<p>æ•ˆæœå¦‚ä¸‹<br>
<img src="https://ultimateHandsomeBoy666.github.io//post-images/1615723745197.gif" alt="Messageé…åˆHandlerå®ç°.gif" loading="lazy"><br>
åœ¨MainActivityä¸­åˆ›å»ºä¸€ä¸ªäº§ç”Ÿéšæœºæ•°æ®çš„çº¿ç¨‹ï¼Œæ¯äº§ç”Ÿä¸€ä¸ªæ•°æ®å‘é€ä¸€ä¸ªMessageï¼ŒHandleræ”¶åˆ°Messageä¹‹åæ›´æ–°æŠ˜çº¿å›¾ã€‚</p>
<p>MainActivityä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class MainActivity extends AppCompatActivity {
    private static final int TAG = 1;//Messageçš„whatæ ‡è¯†
    private TextView mTextView;
    private Button mStartButton;

    private LineChart mLineChart;
    private Data[] mDatas;
    private List&lt;Entry&gt; mEntries = new ArrayList&lt;&gt;();

    private Thread mThread;
    private Handler mHandler;
    private Random mRandom;

    private StringBuilder mStringBuilder;
    private int mEndIndex;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        mTextView = findViewById(R.id.test_txt);
        mStartButton = findViewById(R.id.start_button);
        mLineChart = findViewById(R.id.line_chart);

        mRandom = new Random();
        mStringBuilder = new StringBuilder(&quot;ç°åœ¨Yè½´æ•°å­—æ˜¯0å“¦&quot;);
        mEndIndex = 1;

        //å…ˆåˆ›å»º5ä¸ªDataæ•°æ®
        mDatas = new Data[]{new Data(1,5),new Data(2,8),
               new Data(3,10),new Data(4,13),new Data(5,16)};
        for (Data data :mDatas){
            mEntries.add(new Entry(data.getValueX(),data.getValueY()));
        }
        LineDataSet dataSet = new LineDataSet(mEntries,&quot;number&quot;);
        LineData lineData = new LineData(dataSet);
        mLineChart.setData(lineData);
        mLineChart.invalidate();


        mHandler = new Handler(){
            @Override
            public void handleMessage(Message msg) {
                super.handleMessage(msg);
                if (msg.what==TAG){
                    updateTxt(msg);
                    updateChart(msg);
                }
            }
        };

        mThread = new Thread(new Runnable() {
            @Override
            public void run() {
                int corrX = 6;//å·²ç»æœ‰äº†äº”ä¸ªæ•°æ®ï¼Œä¸‹ä¸€ä¸ªæ•°æ®çš„xåæ ‡ä»6å¼€å§‹
                while (true){
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    int corrY = mRandom.nextInt(20) + 5;
                    Message message = Message.obtain();
                    message.arg1 = corrY;
                    message.arg2 = corrX;
                    message.what = TAG;
                    mHandler.sendMessage(message);
                    corrX += 1;
                }
            }
        });

        mStartButton.setOnClickListener((View v) -&gt; mThread.start());

    }

    //æ›´æ–°SpannableStringç±»å‹çš„æ–‡æœ¬éœ€è¦ç”¨è¯¥å‡½æ•°åˆ¤æ–­æ›´æ–°æ•°å­—çš„ä½æ•°
    private int endIndex(int i){
        int index = 0;
        while (i!=0){
            i = i/10;
            index += 1;
        }
        return index;
    }

    //æ›´æ–°æ˜¾ç¤ºå½“å‰å€¼çš„TextView
    private void updateTxt(Message msg){
        mStringBuilder.replace(7,7 + mEndIndex, msg.arg1 + &quot;&quot;);//å°†åŸæ¥çš„æ•°å­—æ›¿æ¢

        SpannableStringBuilder spannableStringBuilder = new SpannableStringBuilder(mStringBuilder);
        ForegroundColorSpan foregroundColorSpan = new ForegroundColorSpan(Color.BLUE);
        RelativeSizeSpan relativeSizeSpan = new RelativeSizeSpan(1.5f);

        mEndIndex = endIndex(msg.arg1);//æ–°çš„yå€¼çš„ä½æ•°

        spannableStringBuilder.setSpan(foregroundColorSpan,7,7 + mEndIndex, Spanned.SPAN_INCLUSIVE_EXCLUSIVE);
        spannableStringBuilder.setSpan(relativeSizeSpan,7,7 + mEndIndex, Spanned.SPAN_INCLUSIVE_EXCLUSIVE);
        mTextView.setText(spannableStringBuilder);

    }

    //åˆ·æ–°æŠ˜çº¿å›¾
    private void updateChart(Message msg){
        mEntries.add(new Entry(msg.arg2,msg.arg1));
        LineDataSet dataSet = new LineDataSet(mEntries,&quot;number&quot;);
        LineData lineData = new LineData(dataSet);
        mLineChart.setData(lineData);
        mLineChart.invalidate();
    }

}
</code></pre>
<p>Dataç±»å¦‚ä¸‹</p>
<pre><code class="language-Java">public class Data {
    private int valueX;
    private int valueY;

    public Data(int x,int y){
        this.valueX = x;
        this.valueY = y;
    }

    public int getValueX() {
        return valueX;
    }

    public void setValueX(int valueX) {
        this.valueX = valueX;
    }

    public int getValueY() {
        return valueY;
    }

    public void setValueY(int valueY) {
        this.valueY = valueY;
    }
}
</code></pre>
<h3 id="2-rxjavaå®ç°">2ã€RxJavaå®ç°</h3>
<p>Rxjavaåœ¨å¤„ç†å¤æ‚çš„å¤šçº¿ç¨‹äº‹ä»¶é€»è¾‘æ—¶æ¯”Handler/Asyncç­‰è¦ç®€å•æ˜“ç”¨å¯é ã€‚ç”¨æ¥å†™è¿™ä¸ªdemoç®—æ˜¯å¤§ç‚®æ‰“èšŠå­ï¼Œçº¯å½“ç»ƒæ‰‹äº†ã€‚</p>
<p>MainActivity</p>
<pre><code class="language-Java">public class MainActivity extends AppCompatActivity {
    private static final String TAG = &quot;MainActivity&quot;;
    private LineChart mLineChart;
    private TextView mTextView;
    private Button mStartButton;
    private List&lt;Entry&gt; mEntryList = new ArrayList&lt;&gt;();

    private Random mRandom;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        mLineChart = findViewById(R.id.line_chart);
        mStartButton = findViewById(R.id.start_button);
        mTextView = findViewById(R.id.value_txt);

        mStartButton.setOnClickListener((View v) -&gt; intervalObservable());
    }

    private void intervalObservable() {
        mRandom = new Random();
        Observable.interval(1000, 1000, TimeUnit.MILLISECONDS)
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(new Consumer&lt;Long&gt;() {
                    @Override
                    public void accept(Long aLong) throws Exception {
                        Log.e(&quot;intervalObservable&quot;, Thread.currentThread().getName());
                        Long x = aLong;
                        int y = mRandom.nextInt(10);
                        Data data = new Data(x, y);
                        x++;

                        mEntryList.add(new Entry(data.getX(), data.getY()));
                        LineDataSet dataSet = new LineDataSet(mEntryList, &quot;label&quot;);
                        LineData lineData = new LineData(dataSet);
                        mLineChart.setData(lineData);
                        mLineChart.invalidate();
                        mTextView.setText(&quot;å½“å‰yå€¼ä¸º&quot; + y);
                    }
                });
    }
}
</code></pre>
<p>å†™çš„æ—¶å€™å‘ç°å¦‚æœç›´æ¥ç”¨Observable.create()ç”Ÿæˆæ•°æ®çš„è¯ï¼Œé€Ÿåº¦å¤ªå¿«ï¼ŒMPAndroidChartåˆ·æ–°ä¸è¿‡æ¥ï¼Œä¸€ç‰‡ç©ºç™½ã€‚æ‰€ä»¥æ”¹ç”¨Observable.interval()ï¼Œæ¯ä¸ª1ç§’ç”Ÿæˆä¸€ä¸ªï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªObservable<Long>çš„å¯¹è±¡ï¼Œæ¯æ¬¡å‘å°„çš„éƒ½æ˜¯Longç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥æŠŠDataç±»å‹ä¸­çš„xå€¼æ”¹æˆäº†Longç±»å‹ã€‚<br>
è¿˜è¦æ³¨æ„çš„æ˜¯ï¼ŒObservable.interval()é»˜è®¤è®¢é˜…Schedulers.computationè¿™ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæœ‰UIæ›´æ–°çš„è¯ï¼Œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œè§‚å¯Ÿï¼Œå³è°ƒç”¨observeOn(AndroidSchedulers.mainThread())ã€‚<br>
<strong>ä½†æ˜¯æˆ‘å‘ç°ä¸€ä¸ªå¾ˆç¥å¥‡çš„äº‹ï¼ŒMPAndroidChartå¯ä»¥åœ¨éUIçº¿ç¨‹ä¸­è¿›è¡Œåˆ·æ–°</strong>ã€‚</p>
<p>éš¾é“åªèƒ½ç”¨Observal.interval()å—?å…¶å®ä¸æ˜¯çš„ï¼Œæˆ‘å‘ç°åªè¦ä½¿è¢«è§‚å¯Ÿè€…çº¿ç¨‹ä¼‘çœ ä¸€å°æ®µæ—¶é—´ï¼Œå°±èƒ½è®©æŠ˜çº¿å›¾åˆ·æ–°å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹</p>
<pre><code class="language-java">Observable.create(new ObservableOnSubscribe&lt;Data&gt;() {
            @Override
            public void subscribe(@NonNull ObservableEmitter&lt;Data&gt; e) throws Exception {
                Long x = 0l;
                Random random = new Random();
                while(x &lt; 1000) {
                    int y = random.nextInt(10);
                    Data data = new Data(x, y);
                    e.onNext(data);
                    x++;
                    Thread.sleep(1000);//ä¼‘çœ 1ç§’
                }
                Log.e(TAG, &quot;Observable thread is : &quot; + Thread.currentThread().getName());
            }
        }).subscribeOn(Schedulers.newThread())
            .observeOn(AndroidSchedulers.mainThread())
            .subscribe(data -&gt; {
                Log.i(&quot;onNext(Data data)&quot;, data.toString());
                Log.e(TAG, &quot;Observer thread is :&quot; + Thread.currentThread().getName());
                mEntryList.add(new Entry(data.getX(), data.getY()));
                LineDataSet dataSet = new LineDataSet(mEntryList, &quot;label&quot;);
                LineData lineData = new LineData(dataSet);
                mLineChart.setData(lineData);
                mLineChart.invalidate();
                mTextView.setText(&quot;å½“å‰å€¼ä¸º&quot; + data.getY());
            });
</code></pre>
<p>å…¶å®åœ¨è®¢é˜…è€…çº¿ç¨‹ä¸­ä¼‘çœ ä¹Ÿå¯ä»¥æ­£å¸¸æ¥æ”¶åˆ°æ•°æ®ï¼Œä½†è®¢é˜…è€…çº¿ç¨‹ä¸€èˆ¬æ˜¯UIçº¿ç¨‹ï¼Œä¼‘çœ çš„è¯ï¼ŒUIå°±ä¸ä¼šæ›´æ–°äº†ã€‚<br>
å¦å¤–ï¼Œè¢«è§‚å¯Ÿè€…çš„çº¿ç¨‹æ²¡æœ‰ä¼‘çœ çš„è¯ï¼Œå³ä½¿è¢«è§‚å¯Ÿè€…æ•°æ®å‘é€çš„å¾ˆå¿«ï¼Œè®¢é˜…è€…åœ¨onNext()å³ä½¿è¿›è¡Œäº†çº¿ç¨‹ä¼‘çœ ï¼Œæ•°æ®ä¹Ÿèƒ½å…¨éƒ¨æ¥æ”¶åˆ°ï¼Œä¸ä¼šå‡ºç°äº‹ä»¶ä¸¢å¤±çš„æƒ…å†µï¼Œè¿™ä¸€ç‚¹è®©æˆ‘æ¯”è¾ƒç–‘æƒ‘ã€‚<br>
å¦‚æœè¢«è§‚å¯Ÿè€…çš„çº¿ç¨‹è°ƒç”¨äº†Thread.sleep(1)ï¼Œè€Œè§‚å¯Ÿè€…åœ¨onNext()ä¸­è°ƒç”¨äº†Thread.sleep(1000)ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä¸Šä¸‹æ¸¸äº‹ä»¶å¤„ç†é€Ÿç‡ä¸åŒ¹é…ï¼Œäº‹ä»¶ä¸¢å¤±ï¼ŒOOMç­‰æƒ…å†µã€‚<br>
è¿™ä¸ªæ—¶å€™å°±è¦ç”¨æ”¯æŒèƒŒå‹çš„Flowableäº†ã€‚<br>
å…¶å®ç”¨FlowableåŒæ ·å¯ä»¥å®ç°æŠ˜çº¿å›¾æ›´æ–°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">Flowable.create(new FlowableOnSubscribe&lt;Data&gt;() {
            @Override
            public void subscribe(FlowableEmitter&lt;Data&gt; e) throws Exception{
                Long x = 0l;
                Random random = new Random();
                while(x &lt; 1000) {
                    int y = random.nextInt(10);
                    Data data = new Data(x, y);
                    e.onNext(data);
                    x++;
                    Thread.sleep(1000);
                }
                Log.e(TAG, &quot;Observable thread is : &quot; + Thread.currentThread().getName());
            }
        }, BackpressureStrategy.BUFFER).subscribeOn(Schedulers.newThread())
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(new Subscriber&lt;Data&gt;() {
                    Subscription mSubscription;
                    @Override
                    public void onSubscribe(Subscription s) {
                        mSubscription = s;
                        s.request(1);
                    }

                    @Override
                    public void onNext(Data data) {
                        Log.i(&quot;onNext(Data data)&quot;, data.toString());
                        Log.e(TAG, &quot;Observer thread is :&quot; + Thread.currentThread().getName());
                        mEntryList.add(new Entry(data.getX(), data.getY()));
                        LineDataSet dataSet = new LineDataSet(mEntryList, &quot;label&quot;);
                        LineData lineData = new LineData(dataSet);
                        mLineChart.setData(lineData);
                        mLineChart.invalidate();
                        mTextView.setText(&quot;å½“å‰å€¼ä¸º&quot; + data.getY());

                        mSubscription.request(1);
                    }

                    @Override
                    public void onError(Throwable t) {

                    }

                    @Override
                    public void onComplete() {

                    }
                });
</code></pre>
]]></content>
    </entry>
</feed>